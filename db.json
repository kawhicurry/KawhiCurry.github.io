{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"themes/hexo-3/source/img/article-list-background.jpeg","path":"img/article-list-background.jpeg","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/img/alipay.jpg","path":"img/alipay.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/img/brown-papersq.png","path":"img/brown-papersq.png","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/img/gov.png","path":"img/gov.png","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/img/school-book.png","path":"img/school-book.png","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/img/weixin.jpg","path":"img/weixin.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/gitalk.css","path":"css/gitalk.css","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/mobile.styl","path":"css/mobile.styl","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/style.styl","path":"css/style.styl","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/js/gitment.js","path":"js/gitment.js","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/js/gitalk.js","path":"js/gitalk.js","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/js/jquery.pjax.js","path":"js/jquery.pjax.js","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/js/iconfont.js","path":"js/iconfont.js","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/js/script.js","path":"js/script.js","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/js/search.js","path":"js/search.js","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/js/titleTip.js","path":"js/titleTip.js","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/fonts/icomoon.svg","path":"css/fonts/icomoon.svg","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/fonts/icomoon.eot","path":"css/fonts/icomoon.eot","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/fonts/icomoon.woff","path":"css/fonts/icomoon.woff","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/fonts/icomoon.ttf","path":"css/fonts/icomoon.ttf","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/fonts/iconfont.eot","path":"css/fonts/iconfont.eot","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/fonts/iconfont.svg","path":"css/fonts/iconfont.svg","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/fonts/iconfont.ttf","path":"css/fonts/iconfont.ttf","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/fonts/iconfont.woff","path":"css/fonts/iconfont.woff","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/fonts/iconfont.woff2","path":"css/fonts/iconfont.woff2","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/fonts/selection.json","path":"css/fonts/selection.json","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/hl_theme/atom-light.styl","path":"css/hl_theme/atom-light.styl","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/hl_theme/atom-dark.styl","path":"css/hl_theme/atom-dark.styl","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/hl_theme/brown-paper.styl","path":"css/hl_theme/brown-paper.styl","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/hl_theme/darcula.styl","path":"css/hl_theme/darcula.styl","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/hl_theme/github-gist.styl","path":"css/hl_theme/github-gist.styl","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/hl_theme/github.styl","path":"css/hl_theme/github.styl","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/hl_theme/gruvbox-dark.styl","path":"css/hl_theme/gruvbox-dark.styl","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/hl_theme/gruvbox-light.styl","path":"css/hl_theme/gruvbox-light.styl","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/hl_theme/kimbie-dark.styl","path":"css/hl_theme/kimbie-dark.styl","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/hl_theme/kimbie-light.styl","path":"css/hl_theme/kimbie-light.styl","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/hl_theme/railscasts.styl","path":"css/hl_theme/railscasts.styl","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/hl_theme/rainbow.styl","path":"css/hl_theme/rainbow.styl","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/hl_theme/sublime.styl","path":"css/hl_theme/sublime.styl","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/hl_theme/school-book.styl","path":"css/hl_theme/school-book.styl","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/hl_theme/sunburst.styl","path":"css/hl_theme/sunburst.styl","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/css/hl_theme/zenbum.styl","path":"css/hl_theme/zenbum.styl","modified":0,"renderable":1},{"_id":"themes/hexo-3/source/img/avatar.jpg","path":"img/avatar.jpg","modified":0,"renderable":1}],"Cache":[{"_id":"source/_posts/Daily-10-27.md","hash":"75cb01384c62a4758f32c009d4b53d45439006ef","modified":1635335425587},{"_id":"source/_posts/New-Start.md","hash":"ab9f6ae435bee0a8afaa6277d72154ade48d1d5c","modified":1635311491990},{"_id":"source/_posts/auto_fly.md","hash":"4a4ff4fe845080da38877049eeb9d0cfb1dac391","modified":1635311585876},{"_id":"source/_posts/hello-world.md","hash":"35d90c7899006361c0ef17642a2d69daa06fc7b6","modified":1635336855419},{"_id":"source/_posts/Qingyou-1.md","hash":"ac0e451439bf336b632bfbb970dfa6f7d170bc9f","modified":1635311580307},{"_id":"themes/hexo-3/README.md","hash":"19b8cfe6690c28427492f342e74dda5ed49a1664","modified":1635311491991},{"_id":"themes/hexo-3/LICENSE","hash":"b04140c5f682db2b300428f97bb164fd7f5f18bd","modified":1635311491991},{"_id":"themes/hexo-3/.gitignore","hash":"46eca80fe689a00cbe4d015c094702af54119021","modified":1635311491991},{"_id":"themes/hexo-3/_config.yml","hash":"aec9ba888d4bab18397b3ad914d7a85cd362c51e","modified":1635336904656},{"_id":"themes/hexo-3/languages/en.yml","hash":"616e02c035c86033ab4a97c5ae9e0a9e5f0b8ea3","modified":1635311491992},{"_id":"themes/hexo-3/languages/zh-CN.yml","hash":"83633d45420c96dfac41333aeac3f3616dca5286","modified":1635311491992},{"_id":"themes/hexo-3/layout/indexs.md","hash":"fefedd2be084fdd578be32aa886a6c7247835802","modified":1635338088687},{"_id":"themes/hexo-3/layout/index.ejs","hash":"1c185288c2925a652d577965626718e12df07f65","modified":1635311491999},{"_id":"themes/hexo-3/layout/post.ejs","hash":"a0eaba41e7ec9db5843af482470a45531049b457","modified":1635311491999},{"_id":"themes/hexo-3/layout/_partial/article.ejs","hash":"9e5afcc26f47f93c165072b0a2b5cbf72efb7ef9","modified":1635311491993},{"_id":"themes/hexo-3/layout/_partial/article_copyright.ejs","hash":"9e1cdec49d5b9b44399348d96ecd7331f3ee7d85","modified":1635311491993},{"_id":"themes/hexo-3/layout/_partial/comment.ejs","hash":"d18f94e04ef0cf7abb432a8e707ccb3abc7fe435","modified":1635311491993},{"_id":"themes/hexo-3/layout/_partial/copyright.ejs","hash":"4c09f47e899fe36bfe36d92b12996219c2b5f622","modified":1635311491996},{"_id":"themes/hexo-3/layout/_partial/dashang.ejs","hash":"b2a01cc1f0326965f0a186ce3c9b3c991fd4e2c9","modified":1635311491996},{"_id":"themes/hexo-3/layout/_partial/footer.ejs","hash":"9087af9647a87c3fa9ef87632de5427ba4abe9c4","modified":1635311491996},{"_id":"themes/hexo-3/layout/_partial/friends.ejs","hash":"e6dd90be668195016d6e1c51a6baefb50676e6ab","modified":1635311491996},{"_id":"themes/hexo-3/layout/_partial/full-toc.ejs","hash":"60a085fab3165ea1fc6370abac0bd6ab1b2f2510","modified":1635311491997},{"_id":"themes/hexo-3/layout/_partial/mathjax.ejs","hash":"e2be0e37f3d48e63e65a47d819bfb800b9aa3784","modified":1635311491997},{"_id":"themes/hexo-3/layout/_partial/header.ejs","hash":"1e04b617fe38acca8b3d3774c5dbfcb74a02db6b","modified":1635311491997},{"_id":"themes/hexo-3/layout/_partial/meta.ejs","hash":"ab6329ddd908b0567c18f39ac6a8553c6fec67c5","modified":1635311491997},{"_id":"themes/hexo-3/layout/_partial/nav-left.ejs","hash":"f3cc395fbb4e308776a38e369faefbc9e5891807","modified":1635311491998},{"_id":"themes/hexo-3/layout/_partial/nav-right.ejs","hash":"7942c661b48e15fced4a97acf86fac7fea013378","modified":1635311491998},{"_id":"themes/hexo-3/layout/_partial/toc-ref.ejs","hash":"33f7a4bfca1bb9835ec8f0d1e73188d1f56cc8b9","modified":1635311491998},{"_id":"themes/hexo-3/source/img/article-list-background.jpeg","hash":"4fdf8b3e53dd02d6ee6360aebfadb0cba1fb5633","modified":1635311492013},{"_id":"themes/hexo-3/layout/_partial/tag.ejs","hash":"8704e6bd833d270cc6a494d4e7cf1dfeddedba40","modified":1635311491998},{"_id":"themes/hexo-3/source/img/alipay.jpg","hash":"e457d1d3dfefbbd824d154cf756a2c6d10b812a2","modified":1635311492012},{"_id":"themes/hexo-3/source/img/brown-papersq.png","hash":"3a1332ede3a75a3d24f60b6ed69035b72da5e182","modified":1635311492014},{"_id":"themes/hexo-3/source/img/avatar.jpg","hash":"dae70e53f4eb5efd8f5bc8be7d5a8be9c49434e1","modified":1635338267981},{"_id":"themes/hexo-3/source/img/gov.png","hash":"f31c9f47faedf7f33b9580d6284ab891fb697560","modified":1635311492014},{"_id":"themes/hexo-3/source/img/school-book.png","hash":"711ec983c874e093bb89eb77afcbdf6741fa61ee","modified":1635311492015},{"_id":"themes/hexo-3/source/css/gitalk.css","hash":"3dc58e9a3fd63a3144d5fe850eb55e3dc885c9fb","modified":1635311492007},{"_id":"themes/hexo-3/source/css/mobile.styl","hash":"1c2f8b7d7cf46f219adb3a628bdf380f29ff4a6b","modified":1635311492011},{"_id":"themes/hexo-3/source/css/style.styl","hash":"29fa7f6619519c2dcfec4efac4314c5af659a92a","modified":1635311492012},{"_id":"themes/hexo-3/source/js/jquery.pjax.js","hash":"8c2a4f10a4da3d9615a3a81542494c6d21479b3d","modified":1635311492022},{"_id":"themes/hexo-3/source/js/iconfont.js","hash":"3a0869ca1b09af07d82987e343a3bc4cb9558ecb","modified":1635311492021},{"_id":"themes/hexo-3/source/js/script.js","hash":"36275888d57fecb6afd2c6f9291c46c2b3894ac5","modified":1635311492022},{"_id":"themes/hexo-3/source/js/search.js","hash":"788c610149a5f9361295f9f0207c8523f37ddb8b","modified":1635311492022},{"_id":"themes/hexo-3/source/js/titleTip.js","hash":"7299ac046ddd6e6a4267d435f7b4c8198baaaccc","modified":1635311492023},{"_id":"themes/hexo-3/layout/_partial/comments/disqus.ejs","hash":"32ce7b48d366b9c888ff2ceb911a3cd82f864537","modified":1635311491994},{"_id":"themes/hexo-3/layout/_partial/comments/gitment.ejs","hash":"eaf2b6f297282606b630ad55fb9e38af7e2829dc","modified":1635311491995},{"_id":"themes/hexo-3/layout/_partial/comments/click2show.ejs","hash":"05b09c45b379ffeb4f48c1604044d88829f90799","modified":1635311491994},{"_id":"themes/hexo-3/layout/_partial/comments/gitalk.ejs","hash":"01567e010cf4f2dd141fe2019490d3f0d5aa2529","modified":1635311491994},{"_id":"themes/hexo-3/layout/_partial/comments/livere.ejs","hash":"2d115e79cadedc2d5d8f4b5618559640d986e01f","modified":1635311491995},{"_id":"themes/hexo-3/layout/_partial/comments/utteranc.ejs","hash":"8f2d4f42fbad351677c82e72420224587a5bd666","modified":1635311491995},{"_id":"themes/hexo-3/source/css/fonts/icomoon.svg","hash":"b5e7562c8494b0ddb3a70ecc5545ef7340d8e971","modified":1635311492003},{"_id":"themes/hexo-3/source/css/fonts/icomoon.eot","hash":"b6195bedc1cb2f9cfcb26cc27021f2e94be2ab0a","modified":1635311492003},{"_id":"themes/hexo-3/source/css/fonts/icomoon.woff","hash":"3985d29416bb9b19f50a2f20f2bbbce47f10af8d","modified":1635311492004},{"_id":"themes/hexo-3/source/css/fonts/icomoon.ttf","hash":"eb976d8b8559fcddfc2658a03a4350cb566fc06b","modified":1635311492003},{"_id":"themes/hexo-3/source/css/fonts/iconfont.eot","hash":"b14b8624988ff069aff3145f88c0d7ac49052bd3","modified":1635311492004},{"_id":"themes/hexo-3/source/css/fonts/iconfont.svg","hash":"3630aabf2f9c0417f483ebd03d9e429dbc2594e0","modified":1635311492005},{"_id":"themes/hexo-3/source/css/fonts/iconfont.ttf","hash":"140829ecf12d30c6e18d8dc6dc0c188a66addd25","modified":1635311492005},{"_id":"themes/hexo-3/source/css/fonts/iconfont.woff","hash":"0d2d4559f1ac4fa801eb8cc099fa5bf9dcf955ef","modified":1635311492006},{"_id":"themes/hexo-3/source/css/fonts/iconfont.woff2","hash":"b0317a0b2ebb1181a8bf5a97d03556dd54538645","modified":1635311492006},{"_id":"themes/hexo-3/source/css/fonts/selection.json","hash":"b6456a4eabcffd95e822d1d7adce96da524d481a","modified":1635311492006},{"_id":"themes/hexo-3/source/css/_partial/dashang.styl","hash":"f0eac1dc1f5dbed1769d032bb5fd5f002faaee26","modified":1635311492000},{"_id":"themes/hexo-3/source/css/_partial/comment.styl","hash":"d5fa333970a2eac66937d42eeb16fdb362e121ed","modified":1635311492000},{"_id":"themes/hexo-3/source/css/_partial/fade.styl","hash":"02c7510a26f306e240f23ddbf772a69be2c890dd","modified":1635311492000},{"_id":"themes/hexo-3/source/css/_partial/font.styl","hash":"3db01e603985e6dbcacb6b0f13dbd804f5849e3c","modified":1635311492001},{"_id":"themes/hexo-3/source/css/_partial/full-toc.styl","hash":"9a732af065d0a80c9e420934be0f3582bf0129dc","modified":1635311492001},{"_id":"themes/hexo-3/source/css/_partial/nav-left.styl","hash":"0a067ced25025000aa33c8f5017c87fff0971378","modified":1635311492001},{"_id":"themes/hexo-3/source/css/_partial/nav-right.styl","hash":"588b75e3b83ed95e526154bf3c0336c6f33e2be7","modified":1635311492001},{"_id":"themes/hexo-3/source/css/_partial/nprogress.styl","hash":"2620a02169a6aeb75137fd368eac2c36423d8498","modified":1635311492002},{"_id":"themes/hexo-3/source/css/_partial/num-load.styl","hash":"f7ef35459ece22e1da950b86126be1c2bfe97fcf","modified":1635311492002},{"_id":"themes/hexo-3/source/css/_partial/post.styl","hash":"f1251e2a3b5334af3a22b51fc0293c2456568b50","modified":1635311492002},{"_id":"themes/hexo-3/source/css/hl_theme/atom-light.styl","hash":"553987211d3323a7dfc0b08786b183a3435978c9","modified":1635311492007},{"_id":"themes/hexo-3/source/css/hl_theme/atom-dark.styl","hash":"f3eb4e5feda9cbd6242ccf44ca064e2979b5d719","modified":1635311492007},{"_id":"themes/hexo-3/source/css/hl_theme/brown-paper.styl","hash":"03af387edcc1cf8c18d12e9c440fd51b6cf425b6","modified":1635311492008},{"_id":"themes/hexo-3/source/css/hl_theme/darcula.styl","hash":"2bfc14f27ccca108b4b3755782de8366e8bd001e","modified":1635311492008},{"_id":"themes/hexo-3/source/css/hl_theme/github-gist.styl","hash":"5e05b19832c1099bd9d284bc3ed00dc8a3d7ee23","modified":1635311492008},{"_id":"themes/hexo-3/source/css/hl_theme/github.styl","hash":"53276ff1f224f691dfe811e82c0af7f4476abf5d","modified":1635311492008},{"_id":"themes/hexo-3/source/css/hl_theme/gruvbox-dark.styl","hash":"315ad610d303caba9eac80a7d51002193a15478a","modified":1635311492009},{"_id":"themes/hexo-3/source/css/hl_theme/gruvbox-light.styl","hash":"1bece084b1dbbbd4af064f05feffd8c332b96a48","modified":1635311492009},{"_id":"themes/hexo-3/source/css/hl_theme/kimbie-dark.styl","hash":"e9c190f9ffc37a13cac430512e4e0c760205be4a","modified":1635311492009},{"_id":"themes/hexo-3/source/css/hl_theme/kimbie-light.styl","hash":"0c3ccd0d64e7504c7061d246dc32737f502f64e4","modified":1635311492009},{"_id":"themes/hexo-3/source/css/hl_theme/railscasts.styl","hash":"a6e8cfd2202afd7893f5268f3437421e35066e7b","modified":1635311492010},{"_id":"themes/hexo-3/source/css/hl_theme/rainbow.styl","hash":"e5c37646a9d9c1094f9aab7a7c65a4b242e8db00","modified":1635311492010},{"_id":"themes/hexo-3/source/css/hl_theme/sublime.styl","hash":"501d75ef0f4385bea24d9b9b4cc434ba68d4be27","modified":1635311492010},{"_id":"themes/hexo-3/source/css/hl_theme/school-book.styl","hash":"51659351b391a2be5c68728bb51b7ad467c5e0db","modified":1635311492010},{"_id":"themes/hexo-3/source/css/hl_theme/sunburst.styl","hash":"2aa9817e68fb2ed216781ea04b733039ebe18214","modified":1635311492011},{"_id":"themes/hexo-3/source/css/hl_theme/zenbum.styl","hash":"92941a6ae73b74f44ad7c559c5548c44073c644a","modified":1635311492011},{"_id":"themes/hexo-3/source/img/weixin.jpg","hash":"8dafb22561698d0758fba9ea2a45abf6ad3512a2","modified":1635311492016},{"_id":"themes/hexo-3/source/js/gitment.js","hash":"67984b83cd46ff4300d4fd959bf6c17dd66b4136","modified":1635311492021},{"_id":"themes/hexo-3/source/js/gitalk.js","hash":"3e2e0cf9caa6b8d07b9c5e0733a1ccb3e244259f","modified":1635311492019},{"_id":"public/2021/10/27/auto_fly/index.html","hash":"1c0aa3ab01691a8f0b0a1f3669abbee8cc9c1593","modified":1635336437569},{"_id":"public/2021/10/25/New-Start/index.html","hash":"4f32539b055003c13726fc5c97b35087cd17997c","modified":1638093489228},{"_id":"public/categories/life/index.html","hash":"cec8b0f2ef68a0e88cd426a53f138ec7410f0e7a","modified":1638093489228},{"_id":"public/archives/index.html","hash":"cec8b0f2ef68a0e88cd426a53f138ec7410f0e7a","modified":1638093489228},{"_id":"public/archives/2021/index.html","hash":"cec8b0f2ef68a0e88cd426a53f138ec7410f0e7a","modified":1638093489228},{"_id":"public/archives/2021/10/index.html","hash":"cec8b0f2ef68a0e88cd426a53f138ec7410f0e7a","modified":1638093489228},{"_id":"public/index.html","hash":"cec8b0f2ef68a0e88cd426a53f138ec7410f0e7a","modified":1638093489228},{"_id":"public/2021/10/27/Daily-10-27/index.html","hash":"a2afa407d451d1c8611ac3eafcfe5e7c75ce22a8","modified":1638093489228},{"_id":"public/2021/10/27/hello-world/index.html","hash":"7e6b96d000204a8c48baae1c791739b6e45764ac","modified":1635336437569},{"_id":"public/2021/10/27/Qingyou-1/index.html","hash":"6a21fecc32c4d393d8822c96a7b69245ce765793","modified":1638093489228},{"_id":"public/tags/Daily/index.html","hash":"cec8b0f2ef68a0e88cd426a53f138ec7410f0e7a","modified":1638093489228},{"_id":"public/img/article-list-background.jpeg","hash":"4fdf8b3e53dd02d6ee6360aebfadb0cba1fb5633","modified":1635336437569},{"_id":"public/img/alipay.jpg","hash":"e457d1d3dfefbbd824d154cf756a2c6d10b812a2","modified":1635336437569},{"_id":"public/img/avatar.jpg","hash":"dae70e53f4eb5efd8f5bc8be7d5a8be9c49434e1","modified":1635338285438},{"_id":"public/img/brown-papersq.png","hash":"3a1332ede3a75a3d24f60b6ed69035b72da5e182","modified":1635336437569},{"_id":"public/img/gov.png","hash":"f31c9f47faedf7f33b9580d6284ab891fb697560","modified":1635336437569},{"_id":"public/img/school-book.png","hash":"711ec983c874e093bb89eb77afcbdf6741fa61ee","modified":1635336437569},{"_id":"public/css/fonts/icomoon.svg","hash":"b5e7562c8494b0ddb3a70ecc5545ef7340d8e971","modified":1635336437569},{"_id":"public/css/fonts/icomoon.woff","hash":"3985d29416bb9b19f50a2f20f2bbbce47f10af8d","modified":1635336437569},{"_id":"public/css/fonts/icomoon.eot","hash":"b6195bedc1cb2f9cfcb26cc27021f2e94be2ab0a","modified":1635336437569},{"_id":"public/css/fonts/icomoon.ttf","hash":"eb976d8b8559fcddfc2658a03a4350cb566fc06b","modified":1635336437569},{"_id":"public/css/fonts/iconfont.eot","hash":"b14b8624988ff069aff3145f88c0d7ac49052bd3","modified":1635336437569},{"_id":"public/css/fonts/iconfont.svg","hash":"3630aabf2f9c0417f483ebd03d9e429dbc2594e0","modified":1635336437569},{"_id":"public/css/fonts/iconfont.ttf","hash":"140829ecf12d30c6e18d8dc6dc0c188a66addd25","modified":1635336437569},{"_id":"public/css/fonts/iconfont.woff","hash":"0d2d4559f1ac4fa801eb8cc099fa5bf9dcf955ef","modified":1635336437569},{"_id":"public/css/fonts/iconfont.woff2","hash":"b0317a0b2ebb1181a8bf5a97d03556dd54538645","modified":1635336437569},{"_id":"public/img/weixin.jpg","hash":"8dafb22561698d0758fba9ea2a45abf6ad3512a2","modified":1635336437569},{"_id":"public/css/mobile.css","hash":"5998f6fc27998596beb1e40e4bc3c43be2ed764c","modified":1635336437569},{"_id":"public/js/search.js","hash":"c80c9a231ee040c7adc07a477793873fb85ce8bc","modified":1635336437569},{"_id":"public/js/titleTip.js","hash":"81dca549063e29ba3a4a278f0f4388eba8a2167b","modified":1635336437569},{"_id":"public/css/hl_theme/atom-light.css","hash":"d31edb9816dae6b01410028bceb91757a962f780","modified":1635336437569},{"_id":"public/css/hl_theme/brown-paper.css","hash":"500c8e750373f6656ff49a7857c871ceedcf8777","modified":1635336437569},{"_id":"public/css/hl_theme/atom-dark.css","hash":"88d11052a24e8100af6248eb4dbe1ce7b0e96408","modified":1635336437569},{"_id":"public/css/hl_theme/github-gist.css","hash":"7a41c1c479d09df875f99f1f6d94aac42e9e2ad0","modified":1635336437569},{"_id":"public/css/hl_theme/darcula.css","hash":"4341074bae4bc9f0b86e32b623e27babc0159b6e","modified":1635336437569},{"_id":"public/css/hl_theme/github.css","hash":"e05a0806a508a26b9f3f3794b6b588ec6504ad3f","modified":1635336437569},{"_id":"public/css/hl_theme/kimbie-dark.css","hash":"728527fcc308da454722c119b89e6da3025bd1e3","modified":1635336437569},{"_id":"public/css/hl_theme/kimbie-light.css","hash":"0c61926c989163faefb031d27bce3e287d6e10f2","modified":1635336437569},{"_id":"public/css/hl_theme/gruvbox-dark.css","hash":"8c440d9b4ee19ac03eaee3c6af78ba52e5ba5535","modified":1635336437569},{"_id":"public/css/hl_theme/gruvbox-light.css","hash":"30514aaa242a34647aa666cfca4fc74c595ea8f2","modified":1635336437569},{"_id":"public/css/hl_theme/railscasts.css","hash":"511f2fd2a84d426e5da5cb17880cc08f73beb002","modified":1635336437569},{"_id":"public/css/hl_theme/rainbow.css","hash":"7ff4251938076ddb7e4e49413db82653e5b61321","modified":1635336437569},{"_id":"public/css/hl_theme/sublime.css","hash":"f65c5b116d9213afb9c324384a2f3bc86cb71121","modified":1635336437569},{"_id":"public/css/hl_theme/sunburst.css","hash":"8a135abac1512cf430d1d1ad2304b79afa1a4d6e","modified":1635336437569},{"_id":"public/css/hl_theme/school-book.css","hash":"ffbbcd13a74ac2404262c50b7a43053dfd0096ff","modified":1635336437569},{"_id":"public/css/hl_theme/zenbum.css","hash":"0a78f74a93568e20b32ca7427c719e9bae9a0b55","modified":1635336437569},{"_id":"public/css/style.css","hash":"db3b1cc156de2bd7563399cf74eeabf9abde50a7","modified":1635336437569},{"_id":"public/css/gitalk.css","hash":"58177ce227c50ee359fbf99a4fdd26058887afc5","modified":1635336437569},{"_id":"public/js/jquery.pjax.js","hash":"191c49fdb40dff115a49cfd2b30dffb888d86550","modified":1635336437569},{"_id":"public/css/fonts/selection.json","hash":"047b615ea32dc48dae5b964061427d41feaaafdf","modified":1635336437569},{"_id":"public/js/script.js","hash":"d7efd27ade371c6e50d0d7481ffc0ec47018bad2","modified":1635336437569},{"_id":"public/js/iconfont.js","hash":"3a0869ca1b09af07d82987e343a3bc4cb9558ecb","modified":1635336437569},{"_id":"public/js/gitment.js","hash":"59a1e03f2b0ce61dd9bd405d3c52d3e07cc10dec","modified":1635336437569},{"_id":"public/js/gitalk.js","hash":"26ba4841dcb4b178f730f53a8d1f4a7c89442b4f","modified":1635336437569},{"_id":"public/2021/10/25/hello-world/index.html","hash":"bd4f4ecdd61e5c033c7b8a3e20e0c4459a3fd2cb","modified":1638093489228},{"_id":"themes/hexo-3/source/img/avatar.jpeg","hash":"dae70e53f4eb5efd8f5bc8be7d5a8be9c49434e1","modified":1635337221362},{"_id":"public/img/avatar.jpeg","hash":"dae70e53f4eb5efd8f5bc8be7d5a8be9c49434e1","modified":1635338099687},{"_id":"source/_posts/Magic-Macro.md","hash":"8e5507170c3d9d429faa0ba328332931e764e4b0","modified":1636290868751},{"_id":"public/archives/2021/11/index.html","hash":"cec8b0f2ef68a0e88cd426a53f138ec7410f0e7a","modified":1638093489228},{"_id":"public/categories/Language/index.html","hash":"cec8b0f2ef68a0e88cd426a53f138ec7410f0e7a","modified":1638093489228},{"_id":"public/tags/C/index.html","hash":"cec8b0f2ef68a0e88cd426a53f138ec7410f0e7a","modified":1638093489228},{"_id":"public/2021/11/07/Magic-Macro/index.html","hash":"edf0241322db761df0913ea408b5197f169c8022","modified":1638093489228},{"_id":"public/categories/Language/C/index.html","hash":"7812607275034d0bb90a6eeb3911022e05fe44c3","modified":1636290850429},{"_id":"source/_posts/log-a-git-error.md","hash":"34dd9bd705c9139997ca37ffbf2aeef094a11d93","modified":1636546305333},{"_id":"public/2021/11/10/log-a-git-error/index.html","hash":"c9ce231c0fb337f757a1ce7ed918c08fb7451ab8","modified":1638093489228},{"_id":"public/categories/tool/index.html","hash":"cec8b0f2ef68a0e88cd426a53f138ec7410f0e7a","modified":1638093489228},{"_id":"public/tags/git/index.html","hash":"cec8b0f2ef68a0e88cd426a53f138ec7410f0e7a","modified":1638093489228},{"_id":"source/_posts/123.md","hash":"cfa8a3ef12d790aec49b97a43d098dea5027d0a4","modified":1636855279499},{"_id":"source/_posts/net-server-0.md","hash":"68f04b323ff2f60e0d078bbe5df5bd802784edf5","modified":1636855016035},{"_id":"source/_posts/qyauto.md","hash":"3cf9969d118568c53c4143536829259599c241b3","modified":1636812599091},{"_id":"public/2021/11/13/net-server-0/index.html","hash":"7734680dbe0dbf372141cb0b87ebacf3ece06889","modified":1638093489228},{"_id":"public/2021/11/13/123/index.html","hash":"938876493936e8aefce16656960877b99c096de0","modified":1636854814401},{"_id":"public/tags/cloud/index.html","hash":"9ceba1a2cc58976cb4184ff8c8dd469ffe35d27f","modified":1636816880156},{"_id":"public/categories/uncategorized/index.html","hash":"cec8b0f2ef68a0e88cd426a53f138ec7410f0e7a","modified":1638093489228},{"_id":"source/_scraft/qyauto.md","hash":"3cf9969d118568c53c4143536829259599c241b3","modified":1636816916914},{"_id":"public/categories/operation/index.html","hash":"cec8b0f2ef68a0e88cd426a53f138ec7410f0e7a","modified":1638093489228},{"_id":"source/_posts/UAV.md","hash":"445836534d515f846ec459736cd536a3be077e67","modified":1637070966951},{"_id":"public/2021/11/16/UAV/index.html","hash":"51e6b724f9e2e16903fc5a6e18c49ea80eb9da6e","modified":1638093489228},{"_id":"public/2021/11/14/123/index.html","hash":"f9e7e976988425ae94793559077a65c1b2d10352","modified":1638091966914},{"_id":"public/tags/auto/index.html","hash":"cec8b0f2ef68a0e88cd426a53f138ec7410f0e7a","modified":1638093489228},{"_id":"source/_posts/oop.md","hash":"dc5401c6f1e6a8181d726461c486a8b82296c90a","modified":1637493738841},{"_id":"public/2021/11/21/oop/index.html","hash":"b2b9f141baa48892e270d3de25e7f8ff6fec4eb5","modified":1638093489228},{"_id":"source/_scraft/qyauto1.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1637493832188},{"_id":"source/_posts/0xCalculator-md.md","hash":"faf36c53a7ec5af691bf94b3e29a139febc76ac5","modified":1638091934551},{"_id":"source/_scraft/0xCalculator.md","hash":"523614c9f9500cd755907ead391bff4ea0a2c773","modified":1638088097203},{"_id":"source/_scraft/程序设计.md","hash":"0581a3e2eed781965a9b8e5f45f99b934a8d4a45","modified":1637774473411},{"_id":"public/2021/11/28/0xCalculator-md/index.html","hash":"b1d60b97d790ea92817fd802dd87356677beb9b8","modified":1638093295418},{"_id":"public/archives/page/2/index.html","hash":"a89b17733e2525be91dc9507803785655186081c","modified":1638091966914},{"_id":"public/archives/2021/page/2/index.html","hash":"a89b17733e2525be91dc9507803785655186081c","modified":1638091966914},{"_id":"public/page/2/index.html","hash":"a89b17733e2525be91dc9507803785655186081c","modified":1638091966914},{"_id":"public/tags/cpp/index.html","hash":"cec8b0f2ef68a0e88cd426a53f138ec7410f0e7a","modified":1638093489228},{"_id":"source/_posts/0xCalculator.md","hash":"23588003a7d305b2070d86a1fd8a80460f8f421a","modified":1638093484318},{"_id":"public/2021/11/28/0xCalculator/index.html","hash":"abe50d7cb0ec60d1ad31c6edcd9ec50d9a7492c5","modified":1638093489228}],"Category":[{"name":"life","_id":"ckv9h3bhm0007e0ul1maa6qdr"},{"name":"Language","_id":"ckvp97s130001a4ulg84g3g0u"},{"name":"C","parent":"ckvp97s130001a4ulg84g3g0u","_id":"ckvp9bp0x0000youl6z5yd2nk"},{"name":"tool","_id":"ckvthffer0001bkulfdvge9xx"},{"name":"uncategorized","_id":"ckvxyic7a0002e0ulf852d98u"},{"name":"operation","_id":"ckvyl7w510000ooula7ke7209"}],"Data":[],"Page":[],"Post":[{"title":"Daily-10-27","date":"2021-10-27T10:57:04.000Z","_content":"\n# Daily-10-27\n\n谁都想不到第一次挑战会来的这么快，前两天还在悠哉游哉的看镜像站，今天就遇到了空前绝后大危机。学校的服务器似乎遇上了arp广播风暴，信息办和青柚几乎所有的服务都down了。两位后端学长带着我去了信息办，用了一下午来试着恢复所有service，顺便还参观了一下信息办的机房。\n\n今天早上才写了{% post_link Qingyou-1 %}这篇文章，说到同时加班我摸鱼。这个摸鱼确实没得办法，毕竟是业务处理方面的事情，但今天这个服务器down了，可就是彻彻底底要运维干活了（然后我还是在摸鱼）。早上本来在开开心心的在github上搭自己的blog，本来很开心的发现hexo的源代码和deploy用的现成文件可以直接用`git branch`分开来。结果到了中午，突然说学校的内部网络出了超级大问题，连食堂都刷不上卡。中午两位后端学长都到了，然后带着我去了信息办，坐在某个开会的桌子边重启服务。主要是两位学长在做，我最多起一个记录的作用。下面是一些印象深刻的记录。\n\n1. 最主要的两台服务器，理论是完全一样的，但一台可以正常运行，另一台卡死，reboot都卡死。并且tomcat父进程为1，无法kill，同时其log文件夹无法打开，无法ls、du，free显示内存占满，swap分区16g全满。最后只能物理重启，重启后可以正常使用了，从另一台服务器上copy过来了配置。\n2. 搭载某部门服务的服务器，80+443端口都无法使用，但ssh连接正常，redis没有设置登录密码，但是手动登录时要求密码了，reboot之后可以正常使用了，但是证书似乎还有问题，两个学长也没解决。\n3. 搭载另一部门服务的服务器，服务down了，重启服务后可正常使用。\n\n除此之外还有各种容器需要重启，有的是学长搭建的，如果不及时记录的话，还真不一定记得住他们的作用。\n\n本来下午约了去飞无人机，果断推到明天了，不过无人机的代码倒是早就写好了。本以为明天没课的，约时间调试无人机的时候才想起来明天还有个实验课。又是不想上课的一天。\n\n不管怎么说，今天下午还是多多少少学到了点nouns，也深刻意识到一个了解服务的运维的重要性，此前的服务都是后端同学手动搭的，幸好他们还记得相关信息，不然我现在的能力可做不到完美恢复。除此之外，我对网络、数据库的了解还是差的太多。\n\n对于未来的话，希望能早点上云吧，服务也希望能够系统化一点，文档可以多写一点。\n\n以上。\n\n","source":"_posts/Daily-10-27.md","raw":"---\ntitle: Daily-10-27\ndate: 2021-10-27 18:57:04\ntags: Daily\n---\n\n# Daily-10-27\n\n谁都想不到第一次挑战会来的这么快，前两天还在悠哉游哉的看镜像站，今天就遇到了空前绝后大危机。学校的服务器似乎遇上了arp广播风暴，信息办和青柚几乎所有的服务都down了。两位后端学长带着我去了信息办，用了一下午来试着恢复所有service，顺便还参观了一下信息办的机房。\n\n今天早上才写了{% post_link Qingyou-1 %}这篇文章，说到同时加班我摸鱼。这个摸鱼确实没得办法，毕竟是业务处理方面的事情，但今天这个服务器down了，可就是彻彻底底要运维干活了（然后我还是在摸鱼）。早上本来在开开心心的在github上搭自己的blog，本来很开心的发现hexo的源代码和deploy用的现成文件可以直接用`git branch`分开来。结果到了中午，突然说学校的内部网络出了超级大问题，连食堂都刷不上卡。中午两位后端学长都到了，然后带着我去了信息办，坐在某个开会的桌子边重启服务。主要是两位学长在做，我最多起一个记录的作用。下面是一些印象深刻的记录。\n\n1. 最主要的两台服务器，理论是完全一样的，但一台可以正常运行，另一台卡死，reboot都卡死。并且tomcat父进程为1，无法kill，同时其log文件夹无法打开，无法ls、du，free显示内存占满，swap分区16g全满。最后只能物理重启，重启后可以正常使用了，从另一台服务器上copy过来了配置。\n2. 搭载某部门服务的服务器，80+443端口都无法使用，但ssh连接正常，redis没有设置登录密码，但是手动登录时要求密码了，reboot之后可以正常使用了，但是证书似乎还有问题，两个学长也没解决。\n3. 搭载另一部门服务的服务器，服务down了，重启服务后可正常使用。\n\n除此之外还有各种容器需要重启，有的是学长搭建的，如果不及时记录的话，还真不一定记得住他们的作用。\n\n本来下午约了去飞无人机，果断推到明天了，不过无人机的代码倒是早就写好了。本以为明天没课的，约时间调试无人机的时候才想起来明天还有个实验课。又是不想上课的一天。\n\n不管怎么说，今天下午还是多多少少学到了点nouns，也深刻意识到一个了解服务的运维的重要性，此前的服务都是后端同学手动搭的，幸好他们还记得相关信息，不然我现在的能力可做不到完美恢复。除此之外，我对网络、数据库的了解还是差的太多。\n\n对于未来的话，希望能早点上云吧，服务也希望能够系统化一点，文档可以多写一点。\n\n以上。\n\n","slug":"Daily-10-27","published":1,"updated":"2021-10-27T11:50:25.587Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckv9h3bh40000e0ula1dfa3j2","content":"<h1 id=\"Daily-10-27\"><a href=\"#Daily-10-27\" class=\"headerlink\" title=\"Daily-10-27\"></a>Daily-10-27</h1><p>谁都想不到第一次挑战会来的这么快，前两天还在悠哉游哉的看镜像站，今天就遇到了空前绝后大危机。学校的服务器似乎遇上了arp广播风暴，信息办和青柚几乎所有的服务都down了。两位后端学长带着我去了信息办，用了一下午来试着恢复所有service，顺便还参观了一下信息办的机房。</p>\n<p>今天早上才写了<a href=\"/2021/10/27/Qingyou-1/\" title=\"Qingyou_1\">Qingyou_1</a>这篇文章，说到同时加班我摸鱼。这个摸鱼确实没得办法，毕竟是业务处理方面的事情，但今天这个服务器down了，可就是彻彻底底要运维干活了（然后我还是在摸鱼）。早上本来在开开心心的在github上搭自己的blog，本来很开心的发现hexo的源代码和deploy用的现成文件可以直接用<code>git branch</code>分开来。结果到了中午，突然说学校的内部网络出了超级大问题，连食堂都刷不上卡。中午两位后端学长都到了，然后带着我去了信息办，坐在某个开会的桌子边重启服务。主要是两位学长在做，我最多起一个记录的作用。下面是一些印象深刻的记录。</p>\n<ol>\n<li>最主要的两台服务器，理论是完全一样的，但一台可以正常运行，另一台卡死，reboot都卡死。并且tomcat父进程为1，无法kill，同时其log文件夹无法打开，无法ls、du，free显示内存占满，swap分区16g全满。最后只能物理重启，重启后可以正常使用了，从另一台服务器上copy过来了配置。</li>\n<li>搭载某部门服务的服务器，80+443端口都无法使用，但ssh连接正常，redis没有设置登录密码，但是手动登录时要求密码了，reboot之后可以正常使用了，但是证书似乎还有问题，两个学长也没解决。</li>\n<li>搭载另一部门服务的服务器，服务down了，重启服务后可正常使用。</li>\n</ol>\n<p>除此之外还有各种容器需要重启，有的是学长搭建的，如果不及时记录的话，还真不一定记得住他们的作用。</p>\n<p>本来下午约了去飞无人机，果断推到明天了，不过无人机的代码倒是早就写好了。本以为明天没课的，约时间调试无人机的时候才想起来明天还有个实验课。又是不想上课的一天。</p>\n<p>不管怎么说，今天下午还是多多少少学到了点nouns，也深刻意识到一个了解服务的运维的重要性，此前的服务都是后端同学手动搭的，幸好他们还记得相关信息，不然我现在的能力可做不到完美恢复。除此之外，我对网络、数据库的了解还是差的太多。</p>\n<p>对于未来的话，希望能早点上云吧，服务也希望能够系统化一点，文档可以多写一点。</p>\n<p>以上。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Daily-10-27\"><a href=\"#Daily-10-27\" class=\"headerlink\" title=\"Daily-10-27\"></a>Daily-10-27</h1><p>谁都想不到第一次挑战会来的这么快，前两天还在悠哉游哉的看镜像站，今天就遇到了空前绝后大危机。学校的服务器似乎遇上了arp广播风暴，信息办和青柚几乎所有的服务都down了。两位后端学长带着我去了信息办，用了一下午来试着恢复所有service，顺便还参观了一下信息办的机房。</p>\n<p>今天早上才写了<a href=\"/2021/10/27/Qingyou-1/\" title=\"Qingyou_1\">Qingyou_1</a>这篇文章，说到同时加班我摸鱼。这个摸鱼确实没得办法，毕竟是业务处理方面的事情，但今天这个服务器down了，可就是彻彻底底要运维干活了（然后我还是在摸鱼）。早上本来在开开心心的在github上搭自己的blog，本来很开心的发现hexo的源代码和deploy用的现成文件可以直接用<code>git branch</code>分开来。结果到了中午，突然说学校的内部网络出了超级大问题，连食堂都刷不上卡。中午两位后端学长都到了，然后带着我去了信息办，坐在某个开会的桌子边重启服务。主要是两位学长在做，我最多起一个记录的作用。下面是一些印象深刻的记录。</p>\n<ol>\n<li>最主要的两台服务器，理论是完全一样的，但一台可以正常运行，另一台卡死，reboot都卡死。并且tomcat父进程为1，无法kill，同时其log文件夹无法打开，无法ls、du，free显示内存占满，swap分区16g全满。最后只能物理重启，重启后可以正常使用了，从另一台服务器上copy过来了配置。</li>\n<li>搭载某部门服务的服务器，80+443端口都无法使用，但ssh连接正常，redis没有设置登录密码，但是手动登录时要求密码了，reboot之后可以正常使用了，但是证书似乎还有问题，两个学长也没解决。</li>\n<li>搭载另一部门服务的服务器，服务down了，重启服务后可正常使用。</li>\n</ol>\n<p>除此之外还有各种容器需要重启，有的是学长搭建的，如果不及时记录的话，还真不一定记得住他们的作用。</p>\n<p>本来下午约了去飞无人机，果断推到明天了，不过无人机的代码倒是早就写好了。本以为明天没课的，约时间调试无人机的时候才想起来明天还有个实验课。又是不想上课的一天。</p>\n<p>不管怎么说，今天下午还是多多少少学到了点nouns，也深刻意识到一个了解服务的运维的重要性，此前的服务都是后端同学手动搭的，幸好他们还记得相关信息，不然我现在的能力可做不到完美恢复。除此之外，我对网络、数据库的了解还是差的太多。</p>\n<p>对于未来的话，希望能早点上云吧，服务也希望能够系统化一点，文档可以多写一点。</p>\n<p>以上。</p>\n"},{"title":"Hello World","date":"2021-10-25T01:01:06.000Z","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","source":"_posts/hello-world.md","raw":"---\ntitle: Hello World\ndate: 2021-10-25 09:01:06\ncategories:\ntags:\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","slug":"hello-world","published":1,"updated":"2021-10-27T12:14:15.419Z","_id":"ckv9h3bha0001e0ul5i8w8x67","comments":1,"layout":"post","photos":[],"link":"","content":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n"},{"title":"New-Start","date":"2021-10-25T09:45:59.000Z","_content":"\n# New Start\n\nToday I start a new blog with domain: [kawhicurry.shuihua.top](kawhicurry.shuihua.top).\n\nI hope I can keep the anything I meet after now.\n\nRecord the things that refresh, happy, knowledgeable or miserable, sad, terrible.","source":"_posts/New-Start.md","raw":"---\ntitle: New-Start\ndate: 2021-10-25 17:45:59\ntags:\n---\n\n# New Start\n\nToday I start a new blog with domain: [kawhicurry.shuihua.top](kawhicurry.shuihua.top).\n\nI hope I can keep the anything I meet after now.\n\nRecord the things that refresh, happy, knowledgeable or miserable, sad, terrible.","slug":"New-Start","published":1,"updated":"2021-10-27T05:11:31.990Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckv9h3bhi0003e0ul3w9d9330","content":"<h1 id=\"New-Start\"><a href=\"#New-Start\" class=\"headerlink\" title=\"New Start\"></a>New Start</h1><p>Today I start a new blog with domain: <a href=\"kawhicurry.shuihua.top\">kawhicurry.shuihua.top</a>.</p>\n<p>I hope I can keep the anything I meet after now.</p>\n<p>Record the things that refresh, happy, knowledgeable or miserable, sad, terrible.</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"New-Start\"><a href=\"#New-Start\" class=\"headerlink\" title=\"New Start\"></a>New Start</h1><p>Today I start a new blog with domain: <a href=\"kawhicurry.shuihua.top\">kawhicurry.shuihua.top</a>.</p>\n<p>I hope I can keep the anything I meet after now.</p>\n<p>Record the things that refresh, happy, knowledgeable or miserable, sad, terrible.</p>\n"},{"title":"Qingyou_1","date":"2021-10-27T01:01:06.000Z","_content":"# 青柚的这点事（1）\n\n大一开学的时候被学校拉去听优秀学生讲座。然后青柚的指导老师上去宣传了一波，我就记得两件事：\n\n1. 学校的小程序是青柚管的\n2. 不招零基础\n\n说是不招，还是抱着试一试的心态，去投了个ui岗，毕竟当时恰好在学原型。结果石沉大海，冒得回应。\n\n大一上死命学会c之后，大一下堕落了起来，直到有天看到阿里云服务器打折，心血来潮，和好基友Roc买了一台49一年的小服务器，搭博客玩。\n\n没服务器的时候就在折腾jekyll和各种pages了，有了服务器之后终于上了心心念的wordpress，然后就是折腾wp各种奇奇怪怪的东西，然后发现有个好东西叫docker，于是又拿docker部署各种各样的服务。我记得最多的时候，部署了博客，gitee，一个ftp服务器，还连了163邮箱发报警。对于一个1核心2m带宽的服务器来说，压力还是很大了哈哈哈。对了，一开始是用宝塔面板，开始还觉得挺方便的，后来lnmp的p就开始出各种各样的问题。这时候就发现了自动部署忽视细节是个多么难搞的问题。从此决定手动搭各种环境。然后又经历了几次服务器重置之后，我和Roc决定还是把网页部署到gitlab page上，毕竟写好md文档然后直接push，确实比wp舒服多了。\n\n接下来在大一结束的那个暑假，我又一次想起了青柚的招新，这次我决定报个运维岗位试试。本想着会遇到各种可能的高难度问题，还提心吊胆地做了各种准备，结果似乎没有遇到太大困难就进来了。进来之后才发现青柚已经很久没有运维了。上一届的运维是一位后端，再往前是一位运营。也确实，运维这份活在小公司本就是可有可无的，更何况这么个工作室呢？不过我还是很喜欢这份活的，毕竟能看着各种软件稳稳的运行，不用想破脑袋实现各种奇奇怪怪的需求，其实也不错（手动狗头）。\n\n就在今天，学校的出入校小程序上线了。这个项目一个月前就开始了，当时我也被拉进了这个项目的群里，然后被告知学校找了外面的运维，用了大公司的serverless。这一个月以来都是平稳推进，直到前天，突然改了需求，又要求昨天就要上线，整个工作室的人都被拉了进来，并且核心人员从前天晚上七点一直加班到昨天中午十一二点。当所有人都在加班的时候，一个运维坐在工作室的正中间，写着自己满是bug的minishell（狗头）。\n\n好吧，其实几天前我几天前刚接到了要管理学校镜像站的任务，一个python+nginx的小组合，拉取镜像用了python写的mirrord工具，好像是北京外国语还是北京交大的（我估计再往上查一下会发现是清华的，此时，清华用的go），然后再在nginx里面配置下转发就行。但是仔细考虑下自己吧，好像python不咋熟练（那必然），go吧肯定不会，最要命的是线程相关的问题，基本是只知道概念（甚至不清楚），略知一二那种。所以想写出点什么，一时半会恐怕没办法，所以现在抓紧学操作系统，把线程方面搞清楚了，再找个趁手的工具，把镜像站的任务系统化一点，争取做成一个平台。\n\n我又想起前天晚上加班的场景，虽然我啥都没干，但我还是挺喜欢这种氛围的。希望能在这里写点什么，写点什么，最后再写点什么。（老谜语人了）\n\n","source":"_posts/Qingyou-1.md","raw":"---\ntitle: Qingyou_1\ndate: 2021-10-27 09:01:06\ncategories: life\ntags:\n---\n# 青柚的这点事（1）\n\n大一开学的时候被学校拉去听优秀学生讲座。然后青柚的指导老师上去宣传了一波，我就记得两件事：\n\n1. 学校的小程序是青柚管的\n2. 不招零基础\n\n说是不招，还是抱着试一试的心态，去投了个ui岗，毕竟当时恰好在学原型。结果石沉大海，冒得回应。\n\n大一上死命学会c之后，大一下堕落了起来，直到有天看到阿里云服务器打折，心血来潮，和好基友Roc买了一台49一年的小服务器，搭博客玩。\n\n没服务器的时候就在折腾jekyll和各种pages了，有了服务器之后终于上了心心念的wordpress，然后就是折腾wp各种奇奇怪怪的东西，然后发现有个好东西叫docker，于是又拿docker部署各种各样的服务。我记得最多的时候，部署了博客，gitee，一个ftp服务器，还连了163邮箱发报警。对于一个1核心2m带宽的服务器来说，压力还是很大了哈哈哈。对了，一开始是用宝塔面板，开始还觉得挺方便的，后来lnmp的p就开始出各种各样的问题。这时候就发现了自动部署忽视细节是个多么难搞的问题。从此决定手动搭各种环境。然后又经历了几次服务器重置之后，我和Roc决定还是把网页部署到gitlab page上，毕竟写好md文档然后直接push，确实比wp舒服多了。\n\n接下来在大一结束的那个暑假，我又一次想起了青柚的招新，这次我决定报个运维岗位试试。本想着会遇到各种可能的高难度问题，还提心吊胆地做了各种准备，结果似乎没有遇到太大困难就进来了。进来之后才发现青柚已经很久没有运维了。上一届的运维是一位后端，再往前是一位运营。也确实，运维这份活在小公司本就是可有可无的，更何况这么个工作室呢？不过我还是很喜欢这份活的，毕竟能看着各种软件稳稳的运行，不用想破脑袋实现各种奇奇怪怪的需求，其实也不错（手动狗头）。\n\n就在今天，学校的出入校小程序上线了。这个项目一个月前就开始了，当时我也被拉进了这个项目的群里，然后被告知学校找了外面的运维，用了大公司的serverless。这一个月以来都是平稳推进，直到前天，突然改了需求，又要求昨天就要上线，整个工作室的人都被拉了进来，并且核心人员从前天晚上七点一直加班到昨天中午十一二点。当所有人都在加班的时候，一个运维坐在工作室的正中间，写着自己满是bug的minishell（狗头）。\n\n好吧，其实几天前我几天前刚接到了要管理学校镜像站的任务，一个python+nginx的小组合，拉取镜像用了python写的mirrord工具，好像是北京外国语还是北京交大的（我估计再往上查一下会发现是清华的，此时，清华用的go），然后再在nginx里面配置下转发就行。但是仔细考虑下自己吧，好像python不咋熟练（那必然），go吧肯定不会，最要命的是线程相关的问题，基本是只知道概念（甚至不清楚），略知一二那种。所以想写出点什么，一时半会恐怕没办法，所以现在抓紧学操作系统，把线程方面搞清楚了，再找个趁手的工具，把镜像站的任务系统化一点，争取做成一个平台。\n\n我又想起前天晚上加班的场景，虽然我啥都没干，但我还是挺喜欢这种氛围的。希望能在这里写点什么，写点什么，最后再写点什么。（老谜语人了）\n\n","slug":"Qingyou-1","published":1,"updated":"2021-10-27T05:13:00.307Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckv9h3bhl0005e0ul6ox31j9y","content":"<h1 id=\"青柚的这点事（1）\"><a href=\"#青柚的这点事（1）\" class=\"headerlink\" title=\"青柚的这点事（1）\"></a>青柚的这点事（1）</h1><p>大一开学的时候被学校拉去听优秀学生讲座。然后青柚的指导老师上去宣传了一波，我就记得两件事：</p>\n<ol>\n<li>学校的小程序是青柚管的</li>\n<li>不招零基础</li>\n</ol>\n<p>说是不招，还是抱着试一试的心态，去投了个ui岗，毕竟当时恰好在学原型。结果石沉大海，冒得回应。</p>\n<p>大一上死命学会c之后，大一下堕落了起来，直到有天看到阿里云服务器打折，心血来潮，和好基友Roc买了一台49一年的小服务器，搭博客玩。</p>\n<p>没服务器的时候就在折腾jekyll和各种pages了，有了服务器之后终于上了心心念的wordpress，然后就是折腾wp各种奇奇怪怪的东西，然后发现有个好东西叫docker，于是又拿docker部署各种各样的服务。我记得最多的时候，部署了博客，gitee，一个ftp服务器，还连了163邮箱发报警。对于一个1核心2m带宽的服务器来说，压力还是很大了哈哈哈。对了，一开始是用宝塔面板，开始还觉得挺方便的，后来lnmp的p就开始出各种各样的问题。这时候就发现了自动部署忽视细节是个多么难搞的问题。从此决定手动搭各种环境。然后又经历了几次服务器重置之后，我和Roc决定还是把网页部署到gitlab page上，毕竟写好md文档然后直接push，确实比wp舒服多了。</p>\n<p>接下来在大一结束的那个暑假，我又一次想起了青柚的招新，这次我决定报个运维岗位试试。本想着会遇到各种可能的高难度问题，还提心吊胆地做了各种准备，结果似乎没有遇到太大困难就进来了。进来之后才发现青柚已经很久没有运维了。上一届的运维是一位后端，再往前是一位运营。也确实，运维这份活在小公司本就是可有可无的，更何况这么个工作室呢？不过我还是很喜欢这份活的，毕竟能看着各种软件稳稳的运行，不用想破脑袋实现各种奇奇怪怪的需求，其实也不错（手动狗头）。</p>\n<p>就在今天，学校的出入校小程序上线了。这个项目一个月前就开始了，当时我也被拉进了这个项目的群里，然后被告知学校找了外面的运维，用了大公司的serverless。这一个月以来都是平稳推进，直到前天，突然改了需求，又要求昨天就要上线，整个工作室的人都被拉了进来，并且核心人员从前天晚上七点一直加班到昨天中午十一二点。当所有人都在加班的时候，一个运维坐在工作室的正中间，写着自己满是bug的minishell（狗头）。</p>\n<p>好吧，其实几天前我几天前刚接到了要管理学校镜像站的任务，一个python+nginx的小组合，拉取镜像用了python写的mirrord工具，好像是北京外国语还是北京交大的（我估计再往上查一下会发现是清华的，此时，清华用的go），然后再在nginx里面配置下转发就行。但是仔细考虑下自己吧，好像python不咋熟练（那必然），go吧肯定不会，最要命的是线程相关的问题，基本是只知道概念（甚至不清楚），略知一二那种。所以想写出点什么，一时半会恐怕没办法，所以现在抓紧学操作系统，把线程方面搞清楚了，再找个趁手的工具，把镜像站的任务系统化一点，争取做成一个平台。</p>\n<p>我又想起前天晚上加班的场景，虽然我啥都没干，但我还是挺喜欢这种氛围的。希望能在这里写点什么，写点什么，最后再写点什么。（老谜语人了）</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"青柚的这点事（1）\"><a href=\"#青柚的这点事（1）\" class=\"headerlink\" title=\"青柚的这点事（1）\"></a>青柚的这点事（1）</h1><p>大一开学的时候被学校拉去听优秀学生讲座。然后青柚的指导老师上去宣传了一波，我就记得两件事：</p>\n<ol>\n<li>学校的小程序是青柚管的</li>\n<li>不招零基础</li>\n</ol>\n<p>说是不招，还是抱着试一试的心态，去投了个ui岗，毕竟当时恰好在学原型。结果石沉大海，冒得回应。</p>\n<p>大一上死命学会c之后，大一下堕落了起来，直到有天看到阿里云服务器打折，心血来潮，和好基友Roc买了一台49一年的小服务器，搭博客玩。</p>\n<p>没服务器的时候就在折腾jekyll和各种pages了，有了服务器之后终于上了心心念的wordpress，然后就是折腾wp各种奇奇怪怪的东西，然后发现有个好东西叫docker，于是又拿docker部署各种各样的服务。我记得最多的时候，部署了博客，gitee，一个ftp服务器，还连了163邮箱发报警。对于一个1核心2m带宽的服务器来说，压力还是很大了哈哈哈。对了，一开始是用宝塔面板，开始还觉得挺方便的，后来lnmp的p就开始出各种各样的问题。这时候就发现了自动部署忽视细节是个多么难搞的问题。从此决定手动搭各种环境。然后又经历了几次服务器重置之后，我和Roc决定还是把网页部署到gitlab page上，毕竟写好md文档然后直接push，确实比wp舒服多了。</p>\n<p>接下来在大一结束的那个暑假，我又一次想起了青柚的招新，这次我决定报个运维岗位试试。本想着会遇到各种可能的高难度问题，还提心吊胆地做了各种准备，结果似乎没有遇到太大困难就进来了。进来之后才发现青柚已经很久没有运维了。上一届的运维是一位后端，再往前是一位运营。也确实，运维这份活在小公司本就是可有可无的，更何况这么个工作室呢？不过我还是很喜欢这份活的，毕竟能看着各种软件稳稳的运行，不用想破脑袋实现各种奇奇怪怪的需求，其实也不错（手动狗头）。</p>\n<p>就在今天，学校的出入校小程序上线了。这个项目一个月前就开始了，当时我也被拉进了这个项目的群里，然后被告知学校找了外面的运维，用了大公司的serverless。这一个月以来都是平稳推进，直到前天，突然改了需求，又要求昨天就要上线，整个工作室的人都被拉了进来，并且核心人员从前天晚上七点一直加班到昨天中午十一二点。当所有人都在加班的时候，一个运维坐在工作室的正中间，写着自己满是bug的minishell（狗头）。</p>\n<p>好吧，其实几天前我几天前刚接到了要管理学校镜像站的任务，一个python+nginx的小组合，拉取镜像用了python写的mirrord工具，好像是北京外国语还是北京交大的（我估计再往上查一下会发现是清华的，此时，清华用的go），然后再在nginx里面配置下转发就行。但是仔细考虑下自己吧，好像python不咋熟练（那必然），go吧肯定不会，最要命的是线程相关的问题，基本是只知道概念（甚至不清楚），略知一二那种。所以想写出点什么，一时半会恐怕没办法，所以现在抓紧学操作系统，把线程方面搞清楚了，再找个趁手的工具，把镜像站的任务系统化一点，争取做成一个平台。</p>\n<p>我又想起前天晚上加班的场景，虽然我啥都没干，但我还是挺喜欢这种氛围的。希望能在这里写点什么，写点什么，最后再写点什么。（老谜语人了）</p>\n"},{"author":"kawhicurry","title":"Magic-Macro","date":"2021-11-07T12:28:58.000Z","_content":"\n# The magic of macro\n最近在写c，遇到了这样一段逻辑，要根据接受的字符串\n```\n# The magic of macro\n\n最近在写c，遇到了这样一段逻辑，根据要接受的字符串，比如`name=ubuntu`来在结构体mirror中找到对应的mirror.name进行赋值，一开始是这样设计的：\n\n```c\nstatic const char* PARA_LIST[MAX_ARG_NUM] = {\"name\", \"cmd\", \"arg\", \"url\", \"timeout\"};\n//然后对'='前的值与上述值匹配，得到一个id，如name的id为0\nswitch(i){\n    case 0:\n      if (para_len > MAX_NAME_LEN) {\n        printf(\"name too long!\");\n        return;\n      }\n      memcpy(mirror->name, parameter + 1, MAX_NAME_LEN);\n      break;\n    case 1:\n      //...\n    case 4:\n      //...  \n}\n//然后switch进行匹配，在switch中都需要先做长度判断，再给结构体mirror赋值\n```\n\n对于每个case来说，这样的事情都要做一遍，而其中除了struct中的元素不同之外，其他基本都完全一致（除了最后一个timeout），于是我就想简化这个过程。一开始，我想到了写n个不同的函数，这样我就可以在每个case中用一个函数替换，但仔细一想，这样还不是要给每个case写一个函数。这时候我想起了宏，上网查找一番后发现的宏的拼接功能。于是我写出了这个：\n\n```c\n#define set_mirror(the_mirror, element, parameter)            \\\n  {                                                           \\\n    if (!strcmp(#element, \"timeout\")) {                       \\\n      the_mirror.timeout_len = strlen(parameter);             \\\n    }                                                         \\\n    memset(the_mirror.element, 0, strlen(parameter) + 1);     \\\n    memcpy(the_mirror.element, parameter, sizeof(parameter)); \\\n  }\n```\n\n其中的`#element`,会讲element替换成字符串，而`##`可以将set_mirror的参数和后面的内容进行拼接（在后面的版本有示范）。上面这个版本已经可以替换赋值的功能了，但还没对长度进行考察。然后我脑子一抽，写了个`#define len_set_mirror` 其实就是上面`set_mirror`加一个参数，然后再调用`set_mirror`的宏。当时是记住了宏的一种“延迟”的机制，可以在有限次数内对宏进行一个嵌套。后面发现length可以直接从parameter获取，于是就将两个宏合并成了一个：\n\n```c\n#define set_mirror(p_mirror, element, parameter, id)               \\\n  do {                                                             \\\n    if (length(parameter) > MAX_##element##_LEN) {                 \\\n      printf(\"##element too long!\");                               \\\n      return 0;                                                    \\\n    }                                                              \\\n    if (!strcmp(#element, \"timeout\")) {                            \\\n      (p_mirror)->timeout_len = length(parameter);                 \\\n    }                                                              \\\n    memset((p_mirror)->element, '\\0', length(parameter) + 1);      \\\n    memcpy((p_mirror)->element, parameter, length(parameter) - 1); \\\n    ((p_mirror)->available) << id;                                 \\\n  } while (0)\n\n```\n\n这次成功将所有功能合并了，并且学到了用do...while(0)来提高宏的安全性（其实我也想到了用大括号的方法来避免，但确实do...while(0)是一个更好的方案。这种写法之后我只需在case中写两行：\n\n```c\n    case 0:\n      set_mirror(p_mirror, name, parameter, id);\n      break;//break还是老老实实写吧，方便set_mirror复用\n```\n\n其实在第一个宏之前，我还写了个在宏中构造变量来接受值的做法，但我发现完全没有必要，毕竟传递进来的值都应该可以被直接操作的（宏展开后直接获得变量）。由此也引出一条经验，大可不必在宏中定义新变量来处理数据。\n\n我对宏最大的印象就是文本替换，关于上面这段逻辑，switch还可以进一步优化。而对于整个c来说，宏是底层库的基础，我后面试图去实现一个strlen函数时，发现这玩意就是靠宏和汇编来实现的，而像c中的attribute，__VA_ARGS__(可变参数)，更有一片天地。甚至可以做逻辑运算，过于离谱了。\n\n结论：宏是魔法，这是我第一次真正近距离接触它，它真的是c的魔法。","source":"_posts/Magic-Macro.md","raw":"---\nauthor: kawhicurry\ntitle: Magic-Macro\ncategories:\n- Language\ndate: 2021-11-07 20:28:58\ntags: C\n---\n\n# The magic of macro\n最近在写c，遇到了这样一段逻辑，要根据接受的字符串\n```\n# The magic of macro\n\n最近在写c，遇到了这样一段逻辑，根据要接受的字符串，比如`name=ubuntu`来在结构体mirror中找到对应的mirror.name进行赋值，一开始是这样设计的：\n\n```c\nstatic const char* PARA_LIST[MAX_ARG_NUM] = {\"name\", \"cmd\", \"arg\", \"url\", \"timeout\"};\n//然后对'='前的值与上述值匹配，得到一个id，如name的id为0\nswitch(i){\n    case 0:\n      if (para_len > MAX_NAME_LEN) {\n        printf(\"name too long!\");\n        return;\n      }\n      memcpy(mirror->name, parameter + 1, MAX_NAME_LEN);\n      break;\n    case 1:\n      //...\n    case 4:\n      //...  \n}\n//然后switch进行匹配，在switch中都需要先做长度判断，再给结构体mirror赋值\n```\n\n对于每个case来说，这样的事情都要做一遍，而其中除了struct中的元素不同之外，其他基本都完全一致（除了最后一个timeout），于是我就想简化这个过程。一开始，我想到了写n个不同的函数，这样我就可以在每个case中用一个函数替换，但仔细一想，这样还不是要给每个case写一个函数。这时候我想起了宏，上网查找一番后发现的宏的拼接功能。于是我写出了这个：\n\n```c\n#define set_mirror(the_mirror, element, parameter)            \\\n  {                                                           \\\n    if (!strcmp(#element, \"timeout\")) {                       \\\n      the_mirror.timeout_len = strlen(parameter);             \\\n    }                                                         \\\n    memset(the_mirror.element, 0, strlen(parameter) + 1);     \\\n    memcpy(the_mirror.element, parameter, sizeof(parameter)); \\\n  }\n```\n\n其中的`#element`,会讲element替换成字符串，而`##`可以将set_mirror的参数和后面的内容进行拼接（在后面的版本有示范）。上面这个版本已经可以替换赋值的功能了，但还没对长度进行考察。然后我脑子一抽，写了个`#define len_set_mirror` 其实就是上面`set_mirror`加一个参数，然后再调用`set_mirror`的宏。当时是记住了宏的一种“延迟”的机制，可以在有限次数内对宏进行一个嵌套。后面发现length可以直接从parameter获取，于是就将两个宏合并成了一个：\n\n```c\n#define set_mirror(p_mirror, element, parameter, id)               \\\n  do {                                                             \\\n    if (length(parameter) > MAX_##element##_LEN) {                 \\\n      printf(\"##element too long!\");                               \\\n      return 0;                                                    \\\n    }                                                              \\\n    if (!strcmp(#element, \"timeout\")) {                            \\\n      (p_mirror)->timeout_len = length(parameter);                 \\\n    }                                                              \\\n    memset((p_mirror)->element, '\\0', length(parameter) + 1);      \\\n    memcpy((p_mirror)->element, parameter, length(parameter) - 1); \\\n    ((p_mirror)->available) << id;                                 \\\n  } while (0)\n\n```\n\n这次成功将所有功能合并了，并且学到了用do...while(0)来提高宏的安全性（其实我也想到了用大括号的方法来避免，但确实do...while(0)是一个更好的方案。这种写法之后我只需在case中写两行：\n\n```c\n    case 0:\n      set_mirror(p_mirror, name, parameter, id);\n      break;//break还是老老实实写吧，方便set_mirror复用\n```\n\n其实在第一个宏之前，我还写了个在宏中构造变量来接受值的做法，但我发现完全没有必要，毕竟传递进来的值都应该可以被直接操作的（宏展开后直接获得变量）。由此也引出一条经验，大可不必在宏中定义新变量来处理数据。\n\n我对宏最大的印象就是文本替换，关于上面这段逻辑，switch还可以进一步优化。而对于整个c来说，宏是底层库的基础，我后面试图去实现一个strlen函数时，发现这玩意就是靠宏和汇编来实现的，而像c中的attribute，__VA_ARGS__(可变参数)，更有一片天地。甚至可以做逻辑运算，过于离谱了。\n\n结论：宏是魔法，这是我第一次真正近距离接触它，它真的是c的魔法。","slug":"Magic-Macro","published":1,"updated":"2021-11-07T13:14:28.751Z","_id":"ckvp97s0y0000a4ul9ha3c995","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"The-magic-of-macro\"><a href=\"#The-magic-of-macro\" class=\"headerlink\" title=\"The magic of macro\"></a>The magic of macro</h1><p>最近在写c，遇到了这样一段逻辑，要根据接受的字符串</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># The magic of macro</span><br><span class=\"line\"></span><br><span class=\"line\">最近在写c，遇到了这样一段逻辑，根据要接受的字符串，比如`name=ubuntu`来在结构体mirror中找到对应的mirror.name进行赋值，一开始是这样设计的：</span><br><span class=\"line\"></span><br><span class=\"line\">```c</span><br><span class=\"line\">static const char* PARA_LIST[MAX_ARG_NUM] = &#123;&quot;name&quot;, &quot;cmd&quot;, &quot;arg&quot;, &quot;url&quot;, &quot;timeout&quot;&#125;;</span><br><span class=\"line\">//然后对&#x27;=&#x27;前的值与上述值匹配，得到一个id，如name的id为0</span><br><span class=\"line\">switch(i)&#123;</span><br><span class=\"line\">    case 0:</span><br><span class=\"line\">      if (para_len &gt; MAX_NAME_LEN) &#123;</span><br><span class=\"line\">        printf(&quot;name too long!&quot;);</span><br><span class=\"line\">        return;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      memcpy(mirror-&gt;name, parameter + 1, MAX_NAME_LEN);</span><br><span class=\"line\">      break;</span><br><span class=\"line\">    case 1:</span><br><span class=\"line\">      //...</span><br><span class=\"line\">    case 4:</span><br><span class=\"line\">      //...  </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">//然后switch进行匹配，在switch中都需要先做长度判断，再给结构体mirror赋值</span><br></pre></td></tr></table></figure>\n\n<p>对于每个case来说，这样的事情都要做一遍，而其中除了struct中的元素不同之外，其他基本都完全一致（除了最后一个timeout），于是我就想简化这个过程。一开始，我想到了写n个不同的函数，这样我就可以在每个case中用一个函数替换，但仔细一想，这样还不是要给每个case写一个函数。这时候我想起了宏，上网查找一番后发现的宏的拼接功能。于是我写出了这个：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> set_mirror(the_mirror, element, parameter)            \\</span></span><br><span class=\"line\"><span class=\"meta\">  &#123;                                                           \\</span></span><br><span class=\"line\"><span class=\"meta\">    <span class=\"meta-keyword\">if</span> (!strcmp(#element, <span class=\"meta-string\">&quot;timeout&quot;</span>)) &#123;                       \\</span></span><br><span class=\"line\"><span class=\"meta\">      the_mirror.timeout_len = strlen(parameter);             \\</span></span><br><span class=\"line\"><span class=\"meta\">    &#125;                                                         \\</span></span><br><span class=\"line\"><span class=\"meta\">    memset(the_mirror.element, 0, strlen(parameter) + 1);     \\</span></span><br><span class=\"line\"><span class=\"meta\">    memcpy(the_mirror.element, parameter, sizeof(parameter)); \\</span></span><br><span class=\"line\"><span class=\"meta\">  &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>其中的<code>#element</code>,会讲element替换成字符串，而<code>##</code>可以将set_mirror的参数和后面的内容进行拼接（在后面的版本有示范）。上面这个版本已经可以替换赋值的功能了，但还没对长度进行考察。然后我脑子一抽，写了个<code>#define len_set_mirror</code> 其实就是上面<code>set_mirror</code>加一个参数，然后再调用<code>set_mirror</code>的宏。当时是记住了宏的一种“延迟”的机制，可以在有限次数内对宏进行一个嵌套。后面发现length可以直接从parameter获取，于是就将两个宏合并成了一个：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> set_mirror(p_mirror, element, parameter, id)               \\</span></span><br><span class=\"line\"><span class=\"meta\">  do &#123;                                                             \\</span></span><br><span class=\"line\"><span class=\"meta\">    <span class=\"meta-keyword\">if</span> (length(parameter) &gt; MAX_##element##_LEN) &#123;                 \\</span></span><br><span class=\"line\"><span class=\"meta\">      printf(<span class=\"meta-string\">&quot;##element too long!&quot;</span>);                               \\</span></span><br><span class=\"line\"><span class=\"meta\">      return 0;                                                    \\</span></span><br><span class=\"line\"><span class=\"meta\">    &#125;                                                              \\</span></span><br><span class=\"line\"><span class=\"meta\">    <span class=\"meta-keyword\">if</span> (!strcmp(#element, <span class=\"meta-string\">&quot;timeout&quot;</span>)) &#123;                            \\</span></span><br><span class=\"line\"><span class=\"meta\">      (p_mirror)-&gt;timeout_len = length(parameter);                 \\</span></span><br><span class=\"line\"><span class=\"meta\">    &#125;                                                              \\</span></span><br><span class=\"line\"><span class=\"meta\">    memset((p_mirror)-&gt;element, <span class=\"meta-string\">&#x27;\\0&#x27;</span>, length(parameter) + 1);      \\</span></span><br><span class=\"line\"><span class=\"meta\">    memcpy((p_mirror)-&gt;element, parameter, length(parameter) - 1); \\</span></span><br><span class=\"line\"><span class=\"meta\">    ((p_mirror)-&gt;available) &lt;&lt; id;                                 \\</span></span><br><span class=\"line\"><span class=\"meta\">  &#125; while (0)</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>这次成功将所有功能合并了，并且学到了用do…while(0)来提高宏的安全性（其实我也想到了用大括号的方法来避免，但确实do…while(0)是一个更好的方案。这种写法之后我只需在case中写两行：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">case</span> <span class=\"number\">0</span>:</span><br><span class=\"line\">  set_mirror(p_mirror, name, parameter, id);</span><br><span class=\"line\">  <span class=\"keyword\">break</span>;<span class=\"comment\">//break还是老老实实写吧，方便set_mirror复用</span></span><br></pre></td></tr></table></figure>\n\n<p>其实在第一个宏之前，我还写了个在宏中构造变量来接受值的做法，但我发现完全没有必要，毕竟传递进来的值都应该可以被直接操作的（宏展开后直接获得变量）。由此也引出一条经验，大可不必在宏中定义新变量来处理数据。</p>\n<p>我对宏最大的印象就是文本替换，关于上面这段逻辑，switch还可以进一步优化。而对于整个c来说，宏是底层库的基础，我后面试图去实现一个strlen函数时，发现这玩意就是靠宏和汇编来实现的，而像c中的attribute，<strong>VA_ARGS</strong>(可变参数)，更有一片天地。甚至可以做逻辑运算，过于离谱了。</p>\n<p>结论：宏是魔法，这是我第一次真正近距离接触它，它真的是c的魔法。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"The-magic-of-macro\"><a href=\"#The-magic-of-macro\" class=\"headerlink\" title=\"The magic of macro\"></a>The magic of macro</h1><p>最近在写c，遇到了这样一段逻辑，要根据接受的字符串</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># The magic of macro</span><br><span class=\"line\"></span><br><span class=\"line\">最近在写c，遇到了这样一段逻辑，根据要接受的字符串，比如`name=ubuntu`来在结构体mirror中找到对应的mirror.name进行赋值，一开始是这样设计的：</span><br><span class=\"line\"></span><br><span class=\"line\">```c</span><br><span class=\"line\">static const char* PARA_LIST[MAX_ARG_NUM] = &#123;&quot;name&quot;, &quot;cmd&quot;, &quot;arg&quot;, &quot;url&quot;, &quot;timeout&quot;&#125;;</span><br><span class=\"line\">//然后对&#x27;=&#x27;前的值与上述值匹配，得到一个id，如name的id为0</span><br><span class=\"line\">switch(i)&#123;</span><br><span class=\"line\">    case 0:</span><br><span class=\"line\">      if (para_len &gt; MAX_NAME_LEN) &#123;</span><br><span class=\"line\">        printf(&quot;name too long!&quot;);</span><br><span class=\"line\">        return;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      memcpy(mirror-&gt;name, parameter + 1, MAX_NAME_LEN);</span><br><span class=\"line\">      break;</span><br><span class=\"line\">    case 1:</span><br><span class=\"line\">      //...</span><br><span class=\"line\">    case 4:</span><br><span class=\"line\">      //...  </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">//然后switch进行匹配，在switch中都需要先做长度判断，再给结构体mirror赋值</span><br></pre></td></tr></table></figure>\n\n<p>对于每个case来说，这样的事情都要做一遍，而其中除了struct中的元素不同之外，其他基本都完全一致（除了最后一个timeout），于是我就想简化这个过程。一开始，我想到了写n个不同的函数，这样我就可以在每个case中用一个函数替换，但仔细一想，这样还不是要给每个case写一个函数。这时候我想起了宏，上网查找一番后发现的宏的拼接功能。于是我写出了这个：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> set_mirror(the_mirror, element, parameter)            \\</span></span><br><span class=\"line\"><span class=\"meta\">  &#123;                                                           \\</span></span><br><span class=\"line\"><span class=\"meta\">    <span class=\"meta-keyword\">if</span> (!strcmp(#element, <span class=\"meta-string\">&quot;timeout&quot;</span>)) &#123;                       \\</span></span><br><span class=\"line\"><span class=\"meta\">      the_mirror.timeout_len = strlen(parameter);             \\</span></span><br><span class=\"line\"><span class=\"meta\">    &#125;                                                         \\</span></span><br><span class=\"line\"><span class=\"meta\">    memset(the_mirror.element, 0, strlen(parameter) + 1);     \\</span></span><br><span class=\"line\"><span class=\"meta\">    memcpy(the_mirror.element, parameter, sizeof(parameter)); \\</span></span><br><span class=\"line\"><span class=\"meta\">  &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>其中的<code>#element</code>,会讲element替换成字符串，而<code>##</code>可以将set_mirror的参数和后面的内容进行拼接（在后面的版本有示范）。上面这个版本已经可以替换赋值的功能了，但还没对长度进行考察。然后我脑子一抽，写了个<code>#define len_set_mirror</code> 其实就是上面<code>set_mirror</code>加一个参数，然后再调用<code>set_mirror</code>的宏。当时是记住了宏的一种“延迟”的机制，可以在有限次数内对宏进行一个嵌套。后面发现length可以直接从parameter获取，于是就将两个宏合并成了一个：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> set_mirror(p_mirror, element, parameter, id)               \\</span></span><br><span class=\"line\"><span class=\"meta\">  do &#123;                                                             \\</span></span><br><span class=\"line\"><span class=\"meta\">    <span class=\"meta-keyword\">if</span> (length(parameter) &gt; MAX_##element##_LEN) &#123;                 \\</span></span><br><span class=\"line\"><span class=\"meta\">      printf(<span class=\"meta-string\">&quot;##element too long!&quot;</span>);                               \\</span></span><br><span class=\"line\"><span class=\"meta\">      return 0;                                                    \\</span></span><br><span class=\"line\"><span class=\"meta\">    &#125;                                                              \\</span></span><br><span class=\"line\"><span class=\"meta\">    <span class=\"meta-keyword\">if</span> (!strcmp(#element, <span class=\"meta-string\">&quot;timeout&quot;</span>)) &#123;                            \\</span></span><br><span class=\"line\"><span class=\"meta\">      (p_mirror)-&gt;timeout_len = length(parameter);                 \\</span></span><br><span class=\"line\"><span class=\"meta\">    &#125;                                                              \\</span></span><br><span class=\"line\"><span class=\"meta\">    memset((p_mirror)-&gt;element, <span class=\"meta-string\">&#x27;\\0&#x27;</span>, length(parameter) + 1);      \\</span></span><br><span class=\"line\"><span class=\"meta\">    memcpy((p_mirror)-&gt;element, parameter, length(parameter) - 1); \\</span></span><br><span class=\"line\"><span class=\"meta\">    ((p_mirror)-&gt;available) &lt;&lt; id;                                 \\</span></span><br><span class=\"line\"><span class=\"meta\">  &#125; while (0)</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>这次成功将所有功能合并了，并且学到了用do…while(0)来提高宏的安全性（其实我也想到了用大括号的方法来避免，但确实do…while(0)是一个更好的方案。这种写法之后我只需在case中写两行：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">case</span> <span class=\"number\">0</span>:</span><br><span class=\"line\">  set_mirror(p_mirror, name, parameter, id);</span><br><span class=\"line\">  <span class=\"keyword\">break</span>;<span class=\"comment\">//break还是老老实实写吧，方便set_mirror复用</span></span><br></pre></td></tr></table></figure>\n\n<p>其实在第一个宏之前，我还写了个在宏中构造变量来接受值的做法，但我发现完全没有必要，毕竟传递进来的值都应该可以被直接操作的（宏展开后直接获得变量）。由此也引出一条经验，大可不必在宏中定义新变量来处理数据。</p>\n<p>我对宏最大的印象就是文本替换，关于上面这段逻辑，switch还可以进一步优化。而对于整个c来说，宏是底层库的基础，我后面试图去实现一个strlen函数时，发现这玩意就是靠宏和汇编来实现的，而像c中的attribute，<strong>VA_ARGS</strong>(可变参数)，更有一片天地。甚至可以做逻辑运算，过于离谱了。</p>\n<p>结论：宏是魔法，这是我第一次真正近距离接触它，它真的是c的魔法。</p>\n"},{"author":"kawhicurry","title":"log-a-git-error","date":"2021-11-10T12:01:01.000Z","_content":"\nWhen I tried to clone a repo from self-built gitlab. I met a error like this：\n\n```bash\n$> git clone https://git.qingyou.ren/KawhiCurry/ansible.git  Cloning into 'ansible'...\nfatal: unable to access 'https://git.qingyou.ren/KawhiCurry/ansible.git/': Failed to connect to 127.0.0.1 port 7890: Connection refused\n```\n\nAnyway, 7890 refuse me. Finally, I got this: [cnblogs](https://www.cnblogs.com/lfri/p/15377383.html)\n\nSeems my proxy(or vpn?)ruin it. It leads my git somewhere strange.\n\nrecord the operation here.\n\n```bash\ngit config --global -l\ngit config --global -e\n//delete or comment on the lines about port\n```\n\n","source":"_posts/log-a-git-error.md","raw":"---\nauthor: kawhicurry\ntitle: log-a-git-error\ncategories: tool\ndate: 2021-11-10 20:01:01\ntags: git\n---\n\nWhen I tried to clone a repo from self-built gitlab. I met a error like this：\n\n```bash\n$> git clone https://git.qingyou.ren/KawhiCurry/ansible.git  Cloning into 'ansible'...\nfatal: unable to access 'https://git.qingyou.ren/KawhiCurry/ansible.git/': Failed to connect to 127.0.0.1 port 7890: Connection refused\n```\n\nAnyway, 7890 refuse me. Finally, I got this: [cnblogs](https://www.cnblogs.com/lfri/p/15377383.html)\n\nSeems my proxy(or vpn?)ruin it. It leads my git somewhere strange.\n\nrecord the operation here.\n\n```bash\ngit config --global -l\ngit config --global -e\n//delete or comment on the lines about port\n```\n\n","slug":"log-a-git-error","published":1,"updated":"2021-11-10T12:11:45.333Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckvthffej0000bkul3r911bwx","content":"<p>When I tried to clone a repo from self-built gitlab. I met a error like this：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$&gt; git <span class=\"built_in\">clone</span> https://git.qingyou.ren/KawhiCurry/ansible.git  Cloning into <span class=\"string\">&#x27;ansible&#x27;</span>...</span><br><span class=\"line\">fatal: unable to access <span class=\"string\">&#x27;https://git.qingyou.ren/KawhiCurry/ansible.git/&#x27;</span>: Failed to connect to 127.0.0.1 port 7890: Connection refused</span><br></pre></td></tr></table></figure>\n\n<p>Anyway, 7890 refuse me. Finally, I got this: <a href=\"https://www.cnblogs.com/lfri/p/15377383.html\">cnblogs</a></p>\n<p>Seems my proxy(or vpn?)ruin it. It leads my git somewhere strange.</p>\n<p>record the operation here.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --global -l</span><br><span class=\"line\">git config --global -e</span><br><span class=\"line\">//delete or comment on the lines about port</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<p>When I tried to clone a repo from self-built gitlab. I met a error like this：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$&gt; git <span class=\"built_in\">clone</span> https://git.qingyou.ren/KawhiCurry/ansible.git  Cloning into <span class=\"string\">&#x27;ansible&#x27;</span>...</span><br><span class=\"line\">fatal: unable to access <span class=\"string\">&#x27;https://git.qingyou.ren/KawhiCurry/ansible.git/&#x27;</span>: Failed to connect to 127.0.0.1 port 7890: Connection refused</span><br></pre></td></tr></table></figure>\n\n<p>Anyway, 7890 refuse me. Finally, I got this: <a href=\"https://www.cnblogs.com/lfri/p/15377383.html\">cnblogs</a></p>\n<p>Seems my proxy(or vpn?)ruin it. It leads my git somewhere strange.</p>\n<p>record the operation here.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --global -l</span><br><span class=\"line\">git config --global -e</span><br><span class=\"line\">//delete or comment on the lines about port</span><br></pre></td></tr></table></figure>\n\n"},{"author":"kawhicurry","title":"Situation of operation technology","date":"2021-11-13T12:01:01.000Z","_content":"# 一个软件的诞生\n\n## 开发过程\n\n准备：市场调查、需求分析……\n\n确定方案：技术，平台\n\n开发：\n\n- 设计&前端：界面\n- 后端：业务逻辑\n\n上线：\n\n- 运营：宣传\n- 运维：服务器维护\n\n# 传统的运维方式\n\n把写好的软件部署到服务器上，跑就完事了。\n\n## 如果业务量大了呢？\n\n用一样的方式部署到很多服务器上，跑就完事了。\n\n## 有什么问题？\n\n- **必须时刻以最大业务量安排服务器数量**，成本高。\n- 每个公司都要有专职运维人员，招人难\n- 运维人员无论水平高低，所能管理的服务器数量有上限\n- 遇到突发状况，所需运维人员数量陡增，而保持一个大量运维团队需要高成本\n\n# 一种趋势\n\n所需管理的服务器数量庞大，但大部分工作都是重复的。所以……\n\n## CI/CD\n\n持续集成，持续交付，持续部署。让后端开发人员（数量庞大，不乏牛人）来完成运维工作\n\n## Devops\n\n运维开发，专门开发运维工具的人。试图将运维工作尽可能的自动化。\n\n# 另一种趋势\n\n## 虚拟化技术的进步\n\n最初的虚拟化：让windows的应用在mac上跑起来（纯举例），虚拟化的环境具有完整的系统，可以在另一个操作系统上跑起来。在性能上具有极大的开销（就是会很慢）\n\n容器化：让一个应用在一个容器中运行，该容器具有该应用所需的全部环境。一个容器就是一个进程，开销较小，与操作系统兼容良好（主要指linux）\n\n## 容器时代\n\n不再关注各式各样的环境问题，所需要的环境都可以打包成容器，并且可以使用别人打包好的容器。\n\n**docker**:第一个开源容器技术的公司，现在仍然是王者。\n\ndocker的开源使得任何人都可以轻松部署各式各样的服务，因为环境的配置已经不是难题。但是对于企业来说，问题仍然存在：每个服务器上都可以跑好几个容器，就像以前一个服务器上可以跑好几个应用一样。如果有几千台呢？几万台呢？\n\n## 容器编排\n\n能不能让不同的服务器上的容器连成一个整体？或者自动编排容器，让它们在合适的时间或者位置提供服务？\n\n**kubernetes**:来自google，简称k8s，容器编排唯一的标准，生态的中心。\n\n允许将多个提供同一服务的容器打包成一个pod（豆荚），将多个服务器设置为一个cluster（集群），由k8s来决定pod在哪台服务器上运行。并且k8s可以在不同服务器上启动相同的pod，当一台服务器出现故障时，k8s迅速在其他服务器上添加故障服务器上运行的pod，从而保证了服务的稳定性。\n\n即成事实：**k8s是生态的中心**\n\n围绕k8s的生态：监控，流水线部署，自动预警，网格化网关，容器化数据库以及**serverless**\n\n*k8s标志着云时代的正式开始*\n\n## 再进一步\n\n如果容器可以方便的创建和销毁，能不能更进一步？\n\n当有请求时才创建容器进行服务（而不是一直等着），请求结束就销毁容器，这便是**Serverless**，来自Amazon（亚马逊）\n\n**Serverless**，无服务器技术，只有有需求的时候才服务。\n\n试想一个秒杀系统，在短暂的几秒内，服务器收到了数以亿记的请求，服务器立刻反应，创建大量容器进行服务，每服务完就立即销毁，把资源留给下一个创建的容器。而在几秒前或几秒后，服务器也许还处于一个“清闲”的状态。当前的serverless按照请求数计费，小公司无需按最大并发量购置服务器，只需直接购买serverless服务。\n\n# 云服务现状\n\n自k8s被推出以后，大公司们成立了CNCF（云原生计算基金会）。示例成员：google、AWS（亚马逊，世界最大的云服务供应商，serverless的领头羊）、RedHat（红帽，世界上最大的服务器软件公司，负责的centos操作系统跑在世界上百分之五十以上，中国百分之八十以上的服务器上）、docker、apache基金会（最成熟的服务器软件apache拥有者）、github、gitlab（二者分别为最大的代码托管网站和最大的开源私有git服务提供商）、华为（独立的鲲鹏架构）。\n\n## 国内环境\n\n- 阿里云：全国最大的云服务供应商，对内为淘宝等提供服务，对外为各类企业提供云服务。\n- 腾讯云：对内有qq、微信、微信小程序等业务。拥有独立的小程序平台。\n- 华为云：有自产鲲鹏服务器，使用与绝大多数服务器不一样的arm架构（大部分服务器包括个人电脑都是amd64，也叫x86-64，但苹果的自研芯片M1是arm）。\n- 七牛云：阿里云出走大佬创办，有一定实力。\n- 青云：一个k8s开源集群管理系统的国内主导者。\n\n现状分析：\n\n> 一方面，围绕容器和容器编排的标准已经制定完成，但基于标准的各项指标仍有提升空间，各大公司仍然在试图在这些标准下做出更好的工具，比如容器和容器的构建工具。另一方面，围绕生态的工具也有许多不完善之处，比如一个让不懂运维的人也能轻松部署的自动部署平台，或是一个完善的部署到监控的工具链。这些被统称为“云基础设施”，云基础设施仍然有许多待完善之处。对于互联网行业来说，传统的运维会越来越少（但绝对不会消失），更多企业倾向于请云服务供应商来构建自己的服务，甚至直接将自身服务交给云供应商。反过来，云供应商也要开发更好的云平台给企业使用。\n\n# 一些其他的机会\n\n## 云与AI\n\n当服务器闲下来可以做什么？挖矿（划掉）。服务器被设计成可以不间断的运行，但很显然它并不会真的时刻运行，当它闲下来时，其算力就有大用途，比如用于机器学习。当然，对于专业的ai公司，他们也有自己的服务器集群，如何利用互联网的云服务来管理自己的集群，也成了一个不错的方向。\n\n## 云与物联网\n\n专业的物联网后端早就有了，尤其是近年来通信行业的进步，更加促进了“计算不一定非要在本地完成”这种概念的推广。对于传统控制行业来说，大多数计算会在嵌入式设备（看作是一个低性能的计算机）上完成，底层工程师们不得不想尽办法优化性能，确保其服务能稳定的运行在嵌入式设备中。而现在，这些计算有望在很远的云服务器上完成。（当然，嵌入式设备工程师并不会消失）\n\n这就是我对这个行业的一些了解。","source":"_posts/net-server-0.md","raw":"---\nauthor: kawhicurry\ntitle: Situation of operation technology\ncategories: operation\ndate: 2021-11-13 20:01:01\ntags: git\n---\n# 一个软件的诞生\n\n## 开发过程\n\n准备：市场调查、需求分析……\n\n确定方案：技术，平台\n\n开发：\n\n- 设计&前端：界面\n- 后端：业务逻辑\n\n上线：\n\n- 运营：宣传\n- 运维：服务器维护\n\n# 传统的运维方式\n\n把写好的软件部署到服务器上，跑就完事了。\n\n## 如果业务量大了呢？\n\n用一样的方式部署到很多服务器上，跑就完事了。\n\n## 有什么问题？\n\n- **必须时刻以最大业务量安排服务器数量**，成本高。\n- 每个公司都要有专职运维人员，招人难\n- 运维人员无论水平高低，所能管理的服务器数量有上限\n- 遇到突发状况，所需运维人员数量陡增，而保持一个大量运维团队需要高成本\n\n# 一种趋势\n\n所需管理的服务器数量庞大，但大部分工作都是重复的。所以……\n\n## CI/CD\n\n持续集成，持续交付，持续部署。让后端开发人员（数量庞大，不乏牛人）来完成运维工作\n\n## Devops\n\n运维开发，专门开发运维工具的人。试图将运维工作尽可能的自动化。\n\n# 另一种趋势\n\n## 虚拟化技术的进步\n\n最初的虚拟化：让windows的应用在mac上跑起来（纯举例），虚拟化的环境具有完整的系统，可以在另一个操作系统上跑起来。在性能上具有极大的开销（就是会很慢）\n\n容器化：让一个应用在一个容器中运行，该容器具有该应用所需的全部环境。一个容器就是一个进程，开销较小，与操作系统兼容良好（主要指linux）\n\n## 容器时代\n\n不再关注各式各样的环境问题，所需要的环境都可以打包成容器，并且可以使用别人打包好的容器。\n\n**docker**:第一个开源容器技术的公司，现在仍然是王者。\n\ndocker的开源使得任何人都可以轻松部署各式各样的服务，因为环境的配置已经不是难题。但是对于企业来说，问题仍然存在：每个服务器上都可以跑好几个容器，就像以前一个服务器上可以跑好几个应用一样。如果有几千台呢？几万台呢？\n\n## 容器编排\n\n能不能让不同的服务器上的容器连成一个整体？或者自动编排容器，让它们在合适的时间或者位置提供服务？\n\n**kubernetes**:来自google，简称k8s，容器编排唯一的标准，生态的中心。\n\n允许将多个提供同一服务的容器打包成一个pod（豆荚），将多个服务器设置为一个cluster（集群），由k8s来决定pod在哪台服务器上运行。并且k8s可以在不同服务器上启动相同的pod，当一台服务器出现故障时，k8s迅速在其他服务器上添加故障服务器上运行的pod，从而保证了服务的稳定性。\n\n即成事实：**k8s是生态的中心**\n\n围绕k8s的生态：监控，流水线部署，自动预警，网格化网关，容器化数据库以及**serverless**\n\n*k8s标志着云时代的正式开始*\n\n## 再进一步\n\n如果容器可以方便的创建和销毁，能不能更进一步？\n\n当有请求时才创建容器进行服务（而不是一直等着），请求结束就销毁容器，这便是**Serverless**，来自Amazon（亚马逊）\n\n**Serverless**，无服务器技术，只有有需求的时候才服务。\n\n试想一个秒杀系统，在短暂的几秒内，服务器收到了数以亿记的请求，服务器立刻反应，创建大量容器进行服务，每服务完就立即销毁，把资源留给下一个创建的容器。而在几秒前或几秒后，服务器也许还处于一个“清闲”的状态。当前的serverless按照请求数计费，小公司无需按最大并发量购置服务器，只需直接购买serverless服务。\n\n# 云服务现状\n\n自k8s被推出以后，大公司们成立了CNCF（云原生计算基金会）。示例成员：google、AWS（亚马逊，世界最大的云服务供应商，serverless的领头羊）、RedHat（红帽，世界上最大的服务器软件公司，负责的centos操作系统跑在世界上百分之五十以上，中国百分之八十以上的服务器上）、docker、apache基金会（最成熟的服务器软件apache拥有者）、github、gitlab（二者分别为最大的代码托管网站和最大的开源私有git服务提供商）、华为（独立的鲲鹏架构）。\n\n## 国内环境\n\n- 阿里云：全国最大的云服务供应商，对内为淘宝等提供服务，对外为各类企业提供云服务。\n- 腾讯云：对内有qq、微信、微信小程序等业务。拥有独立的小程序平台。\n- 华为云：有自产鲲鹏服务器，使用与绝大多数服务器不一样的arm架构（大部分服务器包括个人电脑都是amd64，也叫x86-64，但苹果的自研芯片M1是arm）。\n- 七牛云：阿里云出走大佬创办，有一定实力。\n- 青云：一个k8s开源集群管理系统的国内主导者。\n\n现状分析：\n\n> 一方面，围绕容器和容器编排的标准已经制定完成，但基于标准的各项指标仍有提升空间，各大公司仍然在试图在这些标准下做出更好的工具，比如容器和容器的构建工具。另一方面，围绕生态的工具也有许多不完善之处，比如一个让不懂运维的人也能轻松部署的自动部署平台，或是一个完善的部署到监控的工具链。这些被统称为“云基础设施”，云基础设施仍然有许多待完善之处。对于互联网行业来说，传统的运维会越来越少（但绝对不会消失），更多企业倾向于请云服务供应商来构建自己的服务，甚至直接将自身服务交给云供应商。反过来，云供应商也要开发更好的云平台给企业使用。\n\n# 一些其他的机会\n\n## 云与AI\n\n当服务器闲下来可以做什么？挖矿（划掉）。服务器被设计成可以不间断的运行，但很显然它并不会真的时刻运行，当它闲下来时，其算力就有大用途，比如用于机器学习。当然，对于专业的ai公司，他们也有自己的服务器集群，如何利用互联网的云服务来管理自己的集群，也成了一个不错的方向。\n\n## 云与物联网\n\n专业的物联网后端早就有了，尤其是近年来通信行业的进步，更加促进了“计算不一定非要在本地完成”这种概念的推广。对于传统控制行业来说，大多数计算会在嵌入式设备（看作是一个低性能的计算机）上完成，底层工程师们不得不想尽办法优化性能，确保其服务能稳定的运行在嵌入式设备中。而现在，这些计算有望在很远的云服务器上完成。（当然，嵌入式设备工程师并不会消失）\n\n这就是我对这个行业的一些了解。","slug":"net-server-0","published":1,"updated":"2021-11-14T01:56:56.035Z","_id":"ckvxyic780001e0ul55zv0y4y","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"一个软件的诞生\"><a href=\"#一个软件的诞生\" class=\"headerlink\" title=\"一个软件的诞生\"></a>一个软件的诞生</h1><h2 id=\"开发过程\"><a href=\"#开发过程\" class=\"headerlink\" title=\"开发过程\"></a>开发过程</h2><p>准备：市场调查、需求分析……</p>\n<p>确定方案：技术，平台</p>\n<p>开发：</p>\n<ul>\n<li>设计&amp;前端：界面</li>\n<li>后端：业务逻辑</li>\n</ul>\n<p>上线：</p>\n<ul>\n<li>运营：宣传</li>\n<li>运维：服务器维护</li>\n</ul>\n<h1 id=\"传统的运维方式\"><a href=\"#传统的运维方式\" class=\"headerlink\" title=\"传统的运维方式\"></a>传统的运维方式</h1><p>把写好的软件部署到服务器上，跑就完事了。</p>\n<h2 id=\"如果业务量大了呢？\"><a href=\"#如果业务量大了呢？\" class=\"headerlink\" title=\"如果业务量大了呢？\"></a>如果业务量大了呢？</h2><p>用一样的方式部署到很多服务器上，跑就完事了。</p>\n<h2 id=\"有什么问题？\"><a href=\"#有什么问题？\" class=\"headerlink\" title=\"有什么问题？\"></a>有什么问题？</h2><ul>\n<li><strong>必须时刻以最大业务量安排服务器数量</strong>，成本高。</li>\n<li>每个公司都要有专职运维人员，招人难</li>\n<li>运维人员无论水平高低，所能管理的服务器数量有上限</li>\n<li>遇到突发状况，所需运维人员数量陡增，而保持一个大量运维团队需要高成本</li>\n</ul>\n<h1 id=\"一种趋势\"><a href=\"#一种趋势\" class=\"headerlink\" title=\"一种趋势\"></a>一种趋势</h1><p>所需管理的服务器数量庞大，但大部分工作都是重复的。所以……</p>\n<h2 id=\"CI-CD\"><a href=\"#CI-CD\" class=\"headerlink\" title=\"CI/CD\"></a>CI/CD</h2><p>持续集成，持续交付，持续部署。让后端开发人员（数量庞大，不乏牛人）来完成运维工作</p>\n<h2 id=\"Devops\"><a href=\"#Devops\" class=\"headerlink\" title=\"Devops\"></a>Devops</h2><p>运维开发，专门开发运维工具的人。试图将运维工作尽可能的自动化。</p>\n<h1 id=\"另一种趋势\"><a href=\"#另一种趋势\" class=\"headerlink\" title=\"另一种趋势\"></a>另一种趋势</h1><h2 id=\"虚拟化技术的进步\"><a href=\"#虚拟化技术的进步\" class=\"headerlink\" title=\"虚拟化技术的进步\"></a>虚拟化技术的进步</h2><p>最初的虚拟化：让windows的应用在mac上跑起来（纯举例），虚拟化的环境具有完整的系统，可以在另一个操作系统上跑起来。在性能上具有极大的开销（就是会很慢）</p>\n<p>容器化：让一个应用在一个容器中运行，该容器具有该应用所需的全部环境。一个容器就是一个进程，开销较小，与操作系统兼容良好（主要指linux）</p>\n<h2 id=\"容器时代\"><a href=\"#容器时代\" class=\"headerlink\" title=\"容器时代\"></a>容器时代</h2><p>不再关注各式各样的环境问题，所需要的环境都可以打包成容器，并且可以使用别人打包好的容器。</p>\n<p><strong>docker</strong>:第一个开源容器技术的公司，现在仍然是王者。</p>\n<p>docker的开源使得任何人都可以轻松部署各式各样的服务，因为环境的配置已经不是难题。但是对于企业来说，问题仍然存在：每个服务器上都可以跑好几个容器，就像以前一个服务器上可以跑好几个应用一样。如果有几千台呢？几万台呢？</p>\n<h2 id=\"容器编排\"><a href=\"#容器编排\" class=\"headerlink\" title=\"容器编排\"></a>容器编排</h2><p>能不能让不同的服务器上的容器连成一个整体？或者自动编排容器，让它们在合适的时间或者位置提供服务？</p>\n<p><strong>kubernetes</strong>:来自google，简称k8s，容器编排唯一的标准，生态的中心。</p>\n<p>允许将多个提供同一服务的容器打包成一个pod（豆荚），将多个服务器设置为一个cluster（集群），由k8s来决定pod在哪台服务器上运行。并且k8s可以在不同服务器上启动相同的pod，当一台服务器出现故障时，k8s迅速在其他服务器上添加故障服务器上运行的pod，从而保证了服务的稳定性。</p>\n<p>即成事实：<strong>k8s是生态的中心</strong></p>\n<p>围绕k8s的生态：监控，流水线部署，自动预警，网格化网关，容器化数据库以及<strong>serverless</strong></p>\n<p><em>k8s标志着云时代的正式开始</em></p>\n<h2 id=\"再进一步\"><a href=\"#再进一步\" class=\"headerlink\" title=\"再进一步\"></a>再进一步</h2><p>如果容器可以方便的创建和销毁，能不能更进一步？</p>\n<p>当有请求时才创建容器进行服务（而不是一直等着），请求结束就销毁容器，这便是<strong>Serverless</strong>，来自Amazon（亚马逊）</p>\n<p><strong>Serverless</strong>，无服务器技术，只有有需求的时候才服务。</p>\n<p>试想一个秒杀系统，在短暂的几秒内，服务器收到了数以亿记的请求，服务器立刻反应，创建大量容器进行服务，每服务完就立即销毁，把资源留给下一个创建的容器。而在几秒前或几秒后，服务器也许还处于一个“清闲”的状态。当前的serverless按照请求数计费，小公司无需按最大并发量购置服务器，只需直接购买serverless服务。</p>\n<h1 id=\"云服务现状\"><a href=\"#云服务现状\" class=\"headerlink\" title=\"云服务现状\"></a>云服务现状</h1><p>自k8s被推出以后，大公司们成立了CNCF（云原生计算基金会）。示例成员：google、AWS（亚马逊，世界最大的云服务供应商，serverless的领头羊）、RedHat（红帽，世界上最大的服务器软件公司，负责的centos操作系统跑在世界上百分之五十以上，中国百分之八十以上的服务器上）、docker、apache基金会（最成熟的服务器软件apache拥有者）、github、gitlab（二者分别为最大的代码托管网站和最大的开源私有git服务提供商）、华为（独立的鲲鹏架构）。</p>\n<h2 id=\"国内环境\"><a href=\"#国内环境\" class=\"headerlink\" title=\"国内环境\"></a>国内环境</h2><ul>\n<li>阿里云：全国最大的云服务供应商，对内为淘宝等提供服务，对外为各类企业提供云服务。</li>\n<li>腾讯云：对内有qq、微信、微信小程序等业务。拥有独立的小程序平台。</li>\n<li>华为云：有自产鲲鹏服务器，使用与绝大多数服务器不一样的arm架构（大部分服务器包括个人电脑都是amd64，也叫x86-64，但苹果的自研芯片M1是arm）。</li>\n<li>七牛云：阿里云出走大佬创办，有一定实力。</li>\n<li>青云：一个k8s开源集群管理系统的国内主导者。</li>\n</ul>\n<p>现状分析：</p>\n<blockquote>\n<p>一方面，围绕容器和容器编排的标准已经制定完成，但基于标准的各项指标仍有提升空间，各大公司仍然在试图在这些标准下做出更好的工具，比如容器和容器的构建工具。另一方面，围绕生态的工具也有许多不完善之处，比如一个让不懂运维的人也能轻松部署的自动部署平台，或是一个完善的部署到监控的工具链。这些被统称为“云基础设施”，云基础设施仍然有许多待完善之处。对于互联网行业来说，传统的运维会越来越少（但绝对不会消失），更多企业倾向于请云服务供应商来构建自己的服务，甚至直接将自身服务交给云供应商。反过来，云供应商也要开发更好的云平台给企业使用。</p>\n</blockquote>\n<h1 id=\"一些其他的机会\"><a href=\"#一些其他的机会\" class=\"headerlink\" title=\"一些其他的机会\"></a>一些其他的机会</h1><h2 id=\"云与AI\"><a href=\"#云与AI\" class=\"headerlink\" title=\"云与AI\"></a>云与AI</h2><p>当服务器闲下来可以做什么？挖矿（划掉）。服务器被设计成可以不间断的运行，但很显然它并不会真的时刻运行，当它闲下来时，其算力就有大用途，比如用于机器学习。当然，对于专业的ai公司，他们也有自己的服务器集群，如何利用互联网的云服务来管理自己的集群，也成了一个不错的方向。</p>\n<h2 id=\"云与物联网\"><a href=\"#云与物联网\" class=\"headerlink\" title=\"云与物联网\"></a>云与物联网</h2><p>专业的物联网后端早就有了，尤其是近年来通信行业的进步，更加促进了“计算不一定非要在本地完成”这种概念的推广。对于传统控制行业来说，大多数计算会在嵌入式设备（看作是一个低性能的计算机）上完成，底层工程师们不得不想尽办法优化性能，确保其服务能稳定的运行在嵌入式设备中。而现在，这些计算有望在很远的云服务器上完成。（当然，嵌入式设备工程师并不会消失）</p>\n<p>这就是我对这个行业的一些了解。</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"一个软件的诞生\"><a href=\"#一个软件的诞生\" class=\"headerlink\" title=\"一个软件的诞生\"></a>一个软件的诞生</h1><h2 id=\"开发过程\"><a href=\"#开发过程\" class=\"headerlink\" title=\"开发过程\"></a>开发过程</h2><p>准备：市场调查、需求分析……</p>\n<p>确定方案：技术，平台</p>\n<p>开发：</p>\n<ul>\n<li>设计&amp;前端：界面</li>\n<li>后端：业务逻辑</li>\n</ul>\n<p>上线：</p>\n<ul>\n<li>运营：宣传</li>\n<li>运维：服务器维护</li>\n</ul>\n<h1 id=\"传统的运维方式\"><a href=\"#传统的运维方式\" class=\"headerlink\" title=\"传统的运维方式\"></a>传统的运维方式</h1><p>把写好的软件部署到服务器上，跑就完事了。</p>\n<h2 id=\"如果业务量大了呢？\"><a href=\"#如果业务量大了呢？\" class=\"headerlink\" title=\"如果业务量大了呢？\"></a>如果业务量大了呢？</h2><p>用一样的方式部署到很多服务器上，跑就完事了。</p>\n<h2 id=\"有什么问题？\"><a href=\"#有什么问题？\" class=\"headerlink\" title=\"有什么问题？\"></a>有什么问题？</h2><ul>\n<li><strong>必须时刻以最大业务量安排服务器数量</strong>，成本高。</li>\n<li>每个公司都要有专职运维人员，招人难</li>\n<li>运维人员无论水平高低，所能管理的服务器数量有上限</li>\n<li>遇到突发状况，所需运维人员数量陡增，而保持一个大量运维团队需要高成本</li>\n</ul>\n<h1 id=\"一种趋势\"><a href=\"#一种趋势\" class=\"headerlink\" title=\"一种趋势\"></a>一种趋势</h1><p>所需管理的服务器数量庞大，但大部分工作都是重复的。所以……</p>\n<h2 id=\"CI-CD\"><a href=\"#CI-CD\" class=\"headerlink\" title=\"CI/CD\"></a>CI/CD</h2><p>持续集成，持续交付，持续部署。让后端开发人员（数量庞大，不乏牛人）来完成运维工作</p>\n<h2 id=\"Devops\"><a href=\"#Devops\" class=\"headerlink\" title=\"Devops\"></a>Devops</h2><p>运维开发，专门开发运维工具的人。试图将运维工作尽可能的自动化。</p>\n<h1 id=\"另一种趋势\"><a href=\"#另一种趋势\" class=\"headerlink\" title=\"另一种趋势\"></a>另一种趋势</h1><h2 id=\"虚拟化技术的进步\"><a href=\"#虚拟化技术的进步\" class=\"headerlink\" title=\"虚拟化技术的进步\"></a>虚拟化技术的进步</h2><p>最初的虚拟化：让windows的应用在mac上跑起来（纯举例），虚拟化的环境具有完整的系统，可以在另一个操作系统上跑起来。在性能上具有极大的开销（就是会很慢）</p>\n<p>容器化：让一个应用在一个容器中运行，该容器具有该应用所需的全部环境。一个容器就是一个进程，开销较小，与操作系统兼容良好（主要指linux）</p>\n<h2 id=\"容器时代\"><a href=\"#容器时代\" class=\"headerlink\" title=\"容器时代\"></a>容器时代</h2><p>不再关注各式各样的环境问题，所需要的环境都可以打包成容器，并且可以使用别人打包好的容器。</p>\n<p><strong>docker</strong>:第一个开源容器技术的公司，现在仍然是王者。</p>\n<p>docker的开源使得任何人都可以轻松部署各式各样的服务，因为环境的配置已经不是难题。但是对于企业来说，问题仍然存在：每个服务器上都可以跑好几个容器，就像以前一个服务器上可以跑好几个应用一样。如果有几千台呢？几万台呢？</p>\n<h2 id=\"容器编排\"><a href=\"#容器编排\" class=\"headerlink\" title=\"容器编排\"></a>容器编排</h2><p>能不能让不同的服务器上的容器连成一个整体？或者自动编排容器，让它们在合适的时间或者位置提供服务？</p>\n<p><strong>kubernetes</strong>:来自google，简称k8s，容器编排唯一的标准，生态的中心。</p>\n<p>允许将多个提供同一服务的容器打包成一个pod（豆荚），将多个服务器设置为一个cluster（集群），由k8s来决定pod在哪台服务器上运行。并且k8s可以在不同服务器上启动相同的pod，当一台服务器出现故障时，k8s迅速在其他服务器上添加故障服务器上运行的pod，从而保证了服务的稳定性。</p>\n<p>即成事实：<strong>k8s是生态的中心</strong></p>\n<p>围绕k8s的生态：监控，流水线部署，自动预警，网格化网关，容器化数据库以及<strong>serverless</strong></p>\n<p><em>k8s标志着云时代的正式开始</em></p>\n<h2 id=\"再进一步\"><a href=\"#再进一步\" class=\"headerlink\" title=\"再进一步\"></a>再进一步</h2><p>如果容器可以方便的创建和销毁，能不能更进一步？</p>\n<p>当有请求时才创建容器进行服务（而不是一直等着），请求结束就销毁容器，这便是<strong>Serverless</strong>，来自Amazon（亚马逊）</p>\n<p><strong>Serverless</strong>，无服务器技术，只有有需求的时候才服务。</p>\n<p>试想一个秒杀系统，在短暂的几秒内，服务器收到了数以亿记的请求，服务器立刻反应，创建大量容器进行服务，每服务完就立即销毁，把资源留给下一个创建的容器。而在几秒前或几秒后，服务器也许还处于一个“清闲”的状态。当前的serverless按照请求数计费，小公司无需按最大并发量购置服务器，只需直接购买serverless服务。</p>\n<h1 id=\"云服务现状\"><a href=\"#云服务现状\" class=\"headerlink\" title=\"云服务现状\"></a>云服务现状</h1><p>自k8s被推出以后，大公司们成立了CNCF（云原生计算基金会）。示例成员：google、AWS（亚马逊，世界最大的云服务供应商，serverless的领头羊）、RedHat（红帽，世界上最大的服务器软件公司，负责的centos操作系统跑在世界上百分之五十以上，中国百分之八十以上的服务器上）、docker、apache基金会（最成熟的服务器软件apache拥有者）、github、gitlab（二者分别为最大的代码托管网站和最大的开源私有git服务提供商）、华为（独立的鲲鹏架构）。</p>\n<h2 id=\"国内环境\"><a href=\"#国内环境\" class=\"headerlink\" title=\"国内环境\"></a>国内环境</h2><ul>\n<li>阿里云：全国最大的云服务供应商，对内为淘宝等提供服务，对外为各类企业提供云服务。</li>\n<li>腾讯云：对内有qq、微信、微信小程序等业务。拥有独立的小程序平台。</li>\n<li>华为云：有自产鲲鹏服务器，使用与绝大多数服务器不一样的arm架构（大部分服务器包括个人电脑都是amd64，也叫x86-64，但苹果的自研芯片M1是arm）。</li>\n<li>七牛云：阿里云出走大佬创办，有一定实力。</li>\n<li>青云：一个k8s开源集群管理系统的国内主导者。</li>\n</ul>\n<p>现状分析：</p>\n<blockquote>\n<p>一方面，围绕容器和容器编排的标准已经制定完成，但基于标准的各项指标仍有提升空间，各大公司仍然在试图在这些标准下做出更好的工具，比如容器和容器的构建工具。另一方面，围绕生态的工具也有许多不完善之处，比如一个让不懂运维的人也能轻松部署的自动部署平台，或是一个完善的部署到监控的工具链。这些被统称为“云基础设施”，云基础设施仍然有许多待完善之处。对于互联网行业来说，传统的运维会越来越少（但绝对不会消失），更多企业倾向于请云服务供应商来构建自己的服务，甚至直接将自身服务交给云供应商。反过来，云供应商也要开发更好的云平台给企业使用。</p>\n</blockquote>\n<h1 id=\"一些其他的机会\"><a href=\"#一些其他的机会\" class=\"headerlink\" title=\"一些其他的机会\"></a>一些其他的机会</h1><h2 id=\"云与AI\"><a href=\"#云与AI\" class=\"headerlink\" title=\"云与AI\"></a>云与AI</h2><p>当服务器闲下来可以做什么？挖矿（划掉）。服务器被设计成可以不间断的运行，但很显然它并不会真的时刻运行，当它闲下来时，其算力就有大用途，比如用于机器学习。当然，对于专业的ai公司，他们也有自己的服务器集群，如何利用互联网的云服务来管理自己的集群，也成了一个不错的方向。</p>\n<h2 id=\"云与物联网\"><a href=\"#云与物联网\" class=\"headerlink\" title=\"云与物联网\"></a>云与物联网</h2><p>专业的物联网后端早就有了，尤其是近年来通信行业的进步，更加促进了“计算不一定非要在本地完成”这种概念的推广。对于传统控制行业来说，大多数计算会在嵌入式设备（看作是一个低性能的计算机）上完成，底层工程师们不得不想尽办法优化性能，确保其服务能稳定的运行在嵌入式设备中。而现在，这些计算有望在很远的云服务器上完成。（当然，嵌入式设备工程师并不会消失）</p>\n<p>这就是我对这个行业的一些了解。</p>\n"},{"author":"kawhicurry","title":"UAV","date":"2021-11-16T12:54:45.000Z","_content":"\n# 记录目前从无人机上学到的东西\n\n*UAV*: Unmanned Aerial Vehicle\n\n## 项目的目的\n\n分为森林救火和森林巡逻，我被分在森林巡逻部分。主要是让飞机按一定轨迹在操场上飞行，以z形路线飞过一个操场。森姐救火则是在上述基础上加上使用视觉识别找到一个红色的正方形。我在该小组中负责通信部分。\n\n## 数传通信\n\n主要的任务是将无人机的xyz及三个偏转角通过数传发到地面站，地面站方面会有同学根据数据进行3d绘图。\n\n一开始读代码思路不对，一心想着找gps的数据，于是找到了Sensor，通过将整个sensor的数据取出来，然后获取其中的数据。后来发现库里有个MeasureSystem，可以直接获取xyz及偏转角。于是改写为直接调取。\n\n获取数据后就是发送，发送是利用飞控的Uart与数传进行连接。库中提供了Uart_Send函数，接受一个数组和一个长度作为参数，但是该数组只接受字符，因此要将实际数据转为字符后再发送，思路是将 原始数据%10+‘0’ 从而得到其ascii码值，同时用switch来遍历xyz和三个偏转角。每6个数据作为一组，一组中的数据之间使用‘，’分割，不同组之间使用‘@’分割。期间对原数据进行处理时要记得将得到的某个数据进行数组反转（再看一眼上面对原始数据处理的思路），因为这个问题还出过bug……。\n\n再具体一点，原始数据都是double 或者 float类型，单位都为厘米。一开始我在将获取的数据传到中间的handler时，将其转为（int），然后再直接处理，后面我在转为（int）前，让原始数据的右值*PRESION，设定一个精度，精度取100，从而获得了0.1mm级别的精度。但后面发现这个精度的意义不大了，于是又改回了1。\n\n再记录一下硬件的问题：\n\n1. 电调插反了，折磨了搞硬件的兄弟一下午\n2. 图传始终没有图像，一直以为是电源线的问题，后面发现是插在电脑上的输入线没有插稳\n3. 飞到一半炸机了，排查半天发现是当时调试的太久，没有注意到电量。\n4. 几乎相同的坐标发送代码（除了版本问题外，对数据处理的方式相同）在A9上正常运行，在TI上发出的数据是乱码，改用发送固定值之后，电脑端收到了稳定的乱码。更换数传和数传连接线之后问题仍然存在。直到写下此文时依然未解决。\n","source":"_posts/UAV.md","raw":"---\nauthor: kawhicurry\ntitle: UAV\ncategories: uncategorized\ndate: 2021-11-16 20:54:45\ntags: auto\n---\n\n# 记录目前从无人机上学到的东西\n\n*UAV*: Unmanned Aerial Vehicle\n\n## 项目的目的\n\n分为森林救火和森林巡逻，我被分在森林巡逻部分。主要是让飞机按一定轨迹在操场上飞行，以z形路线飞过一个操场。森姐救火则是在上述基础上加上使用视觉识别找到一个红色的正方形。我在该小组中负责通信部分。\n\n## 数传通信\n\n主要的任务是将无人机的xyz及三个偏转角通过数传发到地面站，地面站方面会有同学根据数据进行3d绘图。\n\n一开始读代码思路不对，一心想着找gps的数据，于是找到了Sensor，通过将整个sensor的数据取出来，然后获取其中的数据。后来发现库里有个MeasureSystem，可以直接获取xyz及偏转角。于是改写为直接调取。\n\n获取数据后就是发送，发送是利用飞控的Uart与数传进行连接。库中提供了Uart_Send函数，接受一个数组和一个长度作为参数，但是该数组只接受字符，因此要将实际数据转为字符后再发送，思路是将 原始数据%10+‘0’ 从而得到其ascii码值，同时用switch来遍历xyz和三个偏转角。每6个数据作为一组，一组中的数据之间使用‘，’分割，不同组之间使用‘@’分割。期间对原数据进行处理时要记得将得到的某个数据进行数组反转（再看一眼上面对原始数据处理的思路），因为这个问题还出过bug……。\n\n再具体一点，原始数据都是double 或者 float类型，单位都为厘米。一开始我在将获取的数据传到中间的handler时，将其转为（int），然后再直接处理，后面我在转为（int）前，让原始数据的右值*PRESION，设定一个精度，精度取100，从而获得了0.1mm级别的精度。但后面发现这个精度的意义不大了，于是又改回了1。\n\n再记录一下硬件的问题：\n\n1. 电调插反了，折磨了搞硬件的兄弟一下午\n2. 图传始终没有图像，一直以为是电源线的问题，后面发现是插在电脑上的输入线没有插稳\n3. 飞到一半炸机了，排查半天发现是当时调试的太久，没有注意到电量。\n4. 几乎相同的坐标发送代码（除了版本问题外，对数据处理的方式相同）在A9上正常运行，在TI上发出的数据是乱码，改用发送固定值之后，电脑端收到了稳定的乱码。更换数传和数传连接线之后问题仍然存在。直到写下此文时依然未解决。\n","slug":"UAV","published":1,"updated":"2021-11-16T13:56:06.951Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckw25zgeq000120ula1of9cfe","content":"<h1 id=\"记录目前从无人机上学到的东西\"><a href=\"#记录目前从无人机上学到的东西\" class=\"headerlink\" title=\"记录目前从无人机上学到的东西\"></a>记录目前从无人机上学到的东西</h1><p><em>UAV</em>: Unmanned Aerial Vehicle</p>\n<h2 id=\"项目的目的\"><a href=\"#项目的目的\" class=\"headerlink\" title=\"项目的目的\"></a>项目的目的</h2><p>分为森林救火和森林巡逻，我被分在森林巡逻部分。主要是让飞机按一定轨迹在操场上飞行，以z形路线飞过一个操场。森姐救火则是在上述基础上加上使用视觉识别找到一个红色的正方形。我在该小组中负责通信部分。</p>\n<h2 id=\"数传通信\"><a href=\"#数传通信\" class=\"headerlink\" title=\"数传通信\"></a>数传通信</h2><p>主要的任务是将无人机的xyz及三个偏转角通过数传发到地面站，地面站方面会有同学根据数据进行3d绘图。</p>\n<p>一开始读代码思路不对，一心想着找gps的数据，于是找到了Sensor，通过将整个sensor的数据取出来，然后获取其中的数据。后来发现库里有个MeasureSystem，可以直接获取xyz及偏转角。于是改写为直接调取。</p>\n<p>获取数据后就是发送，发送是利用飞控的Uart与数传进行连接。库中提供了Uart_Send函数，接受一个数组和一个长度作为参数，但是该数组只接受字符，因此要将实际数据转为字符后再发送，思路是将 原始数据%10+‘0’ 从而得到其ascii码值，同时用switch来遍历xyz和三个偏转角。每6个数据作为一组，一组中的数据之间使用‘，’分割，不同组之间使用‘@’分割。期间对原数据进行处理时要记得将得到的某个数据进行数组反转（再看一眼上面对原始数据处理的思路），因为这个问题还出过bug……。</p>\n<p>再具体一点，原始数据都是double 或者 float类型，单位都为厘米。一开始我在将获取的数据传到中间的handler时，将其转为（int），然后再直接处理，后面我在转为（int）前，让原始数据的右值*PRESION，设定一个精度，精度取100，从而获得了0.1mm级别的精度。但后面发现这个精度的意义不大了，于是又改回了1。</p>\n<p>再记录一下硬件的问题：</p>\n<ol>\n<li>电调插反了，折磨了搞硬件的兄弟一下午</li>\n<li>图传始终没有图像，一直以为是电源线的问题，后面发现是插在电脑上的输入线没有插稳</li>\n<li>飞到一半炸机了，排查半天发现是当时调试的太久，没有注意到电量。</li>\n<li>几乎相同的坐标发送代码（除了版本问题外，对数据处理的方式相同）在A9上正常运行，在TI上发出的数据是乱码，改用发送固定值之后，电脑端收到了稳定的乱码。更换数传和数传连接线之后问题仍然存在。直到写下此文时依然未解决。</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"记录目前从无人机上学到的东西\"><a href=\"#记录目前从无人机上学到的东西\" class=\"headerlink\" title=\"记录目前从无人机上学到的东西\"></a>记录目前从无人机上学到的东西</h1><p><em>UAV</em>: Unmanned Aerial Vehicle</p>\n<h2 id=\"项目的目的\"><a href=\"#项目的目的\" class=\"headerlink\" title=\"项目的目的\"></a>项目的目的</h2><p>分为森林救火和森林巡逻，我被分在森林巡逻部分。主要是让飞机按一定轨迹在操场上飞行，以z形路线飞过一个操场。森姐救火则是在上述基础上加上使用视觉识别找到一个红色的正方形。我在该小组中负责通信部分。</p>\n<h2 id=\"数传通信\"><a href=\"#数传通信\" class=\"headerlink\" title=\"数传通信\"></a>数传通信</h2><p>主要的任务是将无人机的xyz及三个偏转角通过数传发到地面站，地面站方面会有同学根据数据进行3d绘图。</p>\n<p>一开始读代码思路不对，一心想着找gps的数据，于是找到了Sensor，通过将整个sensor的数据取出来，然后获取其中的数据。后来发现库里有个MeasureSystem，可以直接获取xyz及偏转角。于是改写为直接调取。</p>\n<p>获取数据后就是发送，发送是利用飞控的Uart与数传进行连接。库中提供了Uart_Send函数，接受一个数组和一个长度作为参数，但是该数组只接受字符，因此要将实际数据转为字符后再发送，思路是将 原始数据%10+‘0’ 从而得到其ascii码值，同时用switch来遍历xyz和三个偏转角。每6个数据作为一组，一组中的数据之间使用‘，’分割，不同组之间使用‘@’分割。期间对原数据进行处理时要记得将得到的某个数据进行数组反转（再看一眼上面对原始数据处理的思路），因为这个问题还出过bug……。</p>\n<p>再具体一点，原始数据都是double 或者 float类型，单位都为厘米。一开始我在将获取的数据传到中间的handler时，将其转为（int），然后再直接处理，后面我在转为（int）前，让原始数据的右值*PRESION，设定一个精度，精度取100，从而获得了0.1mm级别的精度。但后面发现这个精度的意义不大了，于是又改回了1。</p>\n<p>再记录一下硬件的问题：</p>\n<ol>\n<li>电调插反了，折磨了搞硬件的兄弟一下午</li>\n<li>图传始终没有图像，一直以为是电源线的问题，后面发现是插在电脑上的输入线没有插稳</li>\n<li>飞到一半炸机了，排查半天发现是当时调试的太久，没有注意到电量。</li>\n<li>几乎相同的坐标发送代码（除了版本问题外，对数据处理的方式相同）在A9上正常运行，在TI上发出的数据是乱码，改用发送固定值之后，电脑端收到了稳定的乱码。更换数传和数传连接线之后问题仍然存在。直到写下此文时依然未解决。</li>\n</ol>\n"},{"author":"kawhicurry","title":"oop","date":"2021-11-21T11:21:13.000Z","_content":"\n# 课前提醒（给我自己的）\n\n1. 打开vscode，准备源码\n2. 准备好使用g++\n\n# 多文件编程\n\n## Why\n\n非结构化与结构化：`goto`满天飞的后果\n\n## How\n\n```cpp\n//fun.h\nvoid func();\n\n//fun.cpp\n#include \"fun.h\"\nvoid func(){\n\tstd::cout<<\"hello\"<<std::endl;//?\n}\n\n//main.cpp\n#include <stdio.h>\n#inlcude \"fun.h\"\nusing namespace std;\nint main(){\n    printf(\"hi\\n\");\n\tfunc();\n\treturn 0;\n}\n```\n\n**提问**：`iostream`头文件应该放在哪？\n\n```c++\n//fun.h\n#include <iostream>\n```\n\n**提问**：`main.cpp` 如何找到func()的实现？\n\nVS（IDE）的编译过程：\n\n- 预处理\n- 编译，生成中间可执行文件\n- **链接**\n- 生成最终可执行文件\n\n---\n\n演示：https://zhuanlan.zhihu.com/p/106781089\n\n---\n\n更进一步：Make\n\n**提问**：如果把上面的`stdio.h`改成`iostream`，会怎么样\n\n```c++\n//fun.h\n#ifndef _fun\n#define _fun\n\n#include <iostream>\n\n#endif\n```\n\n# 面对对象\n\n**提问**：计算机是用来干啥的？为何计算机今天能为我们带来如此多好处？一个词语，两个汉字。\n\n1. 面向过程：我让机器干啥就干啥\n2. 面向对象：以对象为中心，把问题分解成对象\n\n*举例*：卖书\n\n## C的对象\n\n```c\nstruct book{\n    char name[10];\n    char ISBN[20];\n    double price;\n}\n\ndouble getPrice(struct book* theBook){\n    return theBook->price;\n}\nvoid showPrice(struct book* theBook){\n    printf(\"%lf\",theBook->price);\n}\n```\n\n**提问**：考虑一另一把剑🗡\n\n```c\nstruct sword{\n    char name[10];\n    double price;\n}\ndouble getPrice(struct sword* theSword){\n    return theSword->price;\n}\nvoid showPrice(struct book* theSword){\n    printf(\"%lf\",theSword->price);\n}\n```\n\nC不允许同名函数，即使允许，你也不知道show了谁的price。如何解决这个问题？（其实可以同名，在后面的重载会讲到）\n\n把函数写在struct里面，让函数成为struct的“专属函数”。C不许我们这么做，但是C++可以\n\n```c++\nstruct Book{\n    char name[10];\n    char ISBN[20];\n    double price;\n    \n    double getPrice(){\n    \treturn price;\n\t}\n\tvoid showPrice(){\n    \tprintf(\"%lf\",price);\n\t}\n    //...\n};\n\nstruct Book theBook=/*...*/;\ntheBook.showPrice();\n```\n\n**提问**：考虑price的合理性，如何正确的为price赋值？（price>0)\n\n```c++\n//考虑这种用法\ntheBook.price=100;\n\nint setPrice(double value){\n    if(value<0){\n        return -1;\n    }else{\n        price=value;\n        return 0;\n    }\n}\n//还是没有解决问题，依然可以\ntheBook.price=100;\n```\n\n封装的必要性\n\n```c++\nclass Book{\nprivate:\n    char name[10];\n    char ISBN[20];\n    double price;\npublic:\n\tint setPrice(double value){\n    \tif(value<0){\n        \treturn -1;\n    \t}else{\n        \tprice=value;\n    \t}\n\t}\n    double getPrice(){\n    \treturn price;\n\t}\n\tvoid showPrice(){\n    \tprintf(\"%lf\",price);\n\t}\n    //...\n};\n\n//无法直接修改price，必须通过公共成员函数\n```\n\n## 构造函数\n\nC中的`struct`如何创建对象？\n\n```c\ntypedef struct{\n\tint num;\n}Book;\n\nBook b;\n```\n\n考虑 `int a=1`，我们能不能`Book b`？\n\n我们可以如何创建一个对象？我们需要Constructor，构造函数。\n\n```c++\nclass Book{\npublic:\n    Book(){}\n    //Book(double the_price):price(the_price){}\n    Book(double the_price){setPrice(the_price);}\n    Book(double the_price,char* the_name){\n        Book(the_price,the_name,\"0000\");\n    }\n    Book(double the_price=10.0,char* the_name=\"none\",char* ISBN){\n        setPrice(the_price);\n        memcpy(name,the_name,10);\n        memcpy(ISBN,the_ISBN,20);\n    }\n    \nprivate:\n    double price;\n    char name[10];\n    char ISBN[20];\n    //...\n};\n\nBook b0;\nBook b1(10);\nBook b2(10,\"Apollo\");\n```\n\n参考：\n\n1. 拷贝构造\n2. 移动构造\n3. 合成构造\n\n## 继承与多态\n\n**提问**：我希望有一个科幻书，科幻书有一个别人没有的成员：科幻程度(depth)。同时有一种传记，有一个独有的值来记录传记主人公的名字(person)。\n\n```c++\nclass Book{\npublic:\n    //...\nprivate:\n    double price;\n    char name[10];\n    char ISBN[20];\n    int depth;\n    char* person;\n    //...\n    \n    //...\n};\n```\n\n有公共属性，也有独有的属性(attribute)\n\n```c++\nclass Fiction:public Book{\npublic:\n    Fiction();\n    \n    int setPrice(double value){\n    \tif(value<10){\n        \treturn -1;\n    \t}else{\n        \tprice=value;\n    \t}\n\t}\nprivate:\n    //不用写，都继承过来了\n    //...\n};\nclass biography:public Book{\n  //现场要求写一个  \n};\n```\n\n继承的方式有三种：\n\n>当一个类派生自基类，该基类可以被继承为 **public、protected** 或 **private** 几种类型。继承类型是通过上面讲解的访问修饰符 access-specifier 来指定的。\n>\n>我们几乎不使用 **protected** 或 **private** 继承，通常使用 **public** 继承。当使用不同类型的继承时，遵循以下几个规则：\n>\n>- **公有继承（public）：**当一个类派生自**公有**基类时，基类的**公有**成员也是派生类的**公有**成员，基类的**保护**成员也是派生类的**保护**成员，基类的**私有**成员不能直接被派生类访问，但是可以通过调用基类的**公有**和**保护**成员来访问。\n>- **保护继承（protected）：** 当一个类派生自**保护**基类时，基类的**公有**和**保护**成员将成为派生类的**保护**成员。\n>- **私有继承（private）：**当一个类派生自**私有**基类时，基类的**公有**和**保护**成员将成为派生类的**私有**成员。\n\n现在，我希望所有书都是被分了类的（如果不知道怎么分，就分到“未知分类”里面去），我们现在不允许直接创建一个Book对象，必须要先从Book继承一个专门的分类，再创建该分类的对象。\n\n```c++\nclass Book{\npublic:\n    virtual Book();\n    virtual Book(double the_price);\n    virtual Book(double the_price);\n    \n    virtual int setPrice(double value);\n    \nprivate:\n    char name[10];\n    char ISBN[20];\n    double price;\n    //...\n};\n```\n\n`virtual`意味着必须由子类来实现这些函数。这叫纯虚函数，关于virtual，还有更多用法。\n\n## 重载\n\n`virtual`要求必须由子类来实现，这就是重载。重载允许同名，但必须接受不同参数。\n\n```c++\n#include <iostream>\nusing namespace std;\n\nvoid func(int a) { cout << \"1\" << endl; }\nvoid func(char b) { cout << \"2\" << endl; }\n\nint main() {\n  func(1);\n  func('a');\n}\n```\n\n**提问**：\n\n```c++\n//已经有了这个函数\nBook(double the_price,char* the_name){\n   setPrice(the_price);\n   memcpy(name,the_name,10);\n}\n//又有了这个\nBook(double the_price,char* the_ISBN){\n   setPrice(the_price);\n   memcpy(name,the_ISBN,10);\n}\n\nBook b3(10,\"Apollo\");\n//Apollo 会变成name还是ISBN？\n```\n\nC++编译器不允许这样的事情发生，会出现redefinition报错，编译器认为这两个是同一函数。因此，参数的类型应该有所区别。\n\n更进一步，考虑Book==Book\n\n```c++\nBook a(1,\"apollo\");\nBook b(10,\"apollo\");\n\n//a.equal(b);\nif(a==b){}\n\nclass Book{\npublic:\n    //...\n    bool operator==(const Book) {\n      if (this->name == Book::name)\n        return true;\n      else\n        return false;\n    }\n    \nprivate:\n    char name[10];\n    char ISBN[20];\n    double price;\n    //...\n};\n//写一个重载+，当两本书相同时，价格相加\n```\n\n## 析构函数\n\n一个对象创建完成后，也要销毁，我们应当定义它如何被销毁。\n\n## 两种风格的对象\n\n- 使这个对象像个“东西”，示例如上\n- 使这个对象像个“指针”，先看看内存管理\n\n# 内存管理\n\n**提问**：a+b中的内存是如何分配的？\n\n>**栈区（stack）：**指那些由编译器在需要的时候分配，不需要时自动清除的变量所在的储存区，如函数执行时，函数的形参以及函数内的局部变量分配在栈区，函数运行结束后，形参和局部变量去栈（自动释放）。栈内存分配运算内置与处理器的指令集中，效率高但是分配的内存空间有限。\n>\n>**堆区（heap）：**指哪些由程序员手动分配释放的储存区，如果程序员不释放这块内存，内存将一直被占用，直到程序运行结束由系统自动收回，c语言中使用malloc，free申请和释放空间。\n>\n>**静态储存区（static）：**全局变量和静态变量的储存是放在一块的，其中初始化的全局变量和静态变量在一个区域，这块空间当程序运行结束后由系统释放。\n>\n>**常量储存区（const）：**常量字符串就是储存在这里的，如“ABC”字符串就储存在常量区，储存在常量区的只读不可写。const修饰的全局变量也储存在常量区，const修饰的局部变量依然在栈上。\n>\n>**程序代码区：**存放源程序的二进制代码。\n\n**提问**：如何创建一个长度不定的数组\n\n错误示范：\n\n```c\nint main(void) {\n    int N = 0;\n\n    printf(\"请输入数组的大小\\n\");\n    scanf(\"%d\", &N);\n    int arr[N] = { 0 };\n}\n```\n\n正确示范：\n\n```c\nint main(void) {\n\n    int arr[1000] = { 0 };\n    int N = 0;\n    int i = 0;\n\n    printf(\"请输入数组的大小\\n\");\n    scanf(\"%d\", &N);\n\n    printf(\"请输入%d个数\\n\", N);\n    for (i = 0; i < N; i++)\n        scanf(\"%d\", &arr[i]);\n\n    return 0;\n}\n```\n\n## 手动内存管理\n\nC 使用malloc 分配内存和 free释放内存。\n\n```c\n#include<stdlib.h>\n\nint main(void) {\n\n    int i = 0;\n    int N = 0;\n    int* arr;\n\n    printf(\"请输入数组的大小\\n\");\n    scanf(\"%d\", &N);\n\n    arr = (int*)malloc(sizeof(int) * N);\n\n    printf(\"请输入%d个数\\n\", N);\n    for (i = 0; i < N; i++)\n        scanf(\"%d\", &arr[i]);\n\n    free(arr);\n    return 0;\n}\n```\n\nC++ 使用封装好的new 和delete\n\n```c++\nint main(void) {\n\n    int i = 0;\n    int N = 0;\n\n    printf(\"请输入数组的大小\\n\");\n    cin<<N;\n\n    int *arr = new int[N];\n\n    cin<<\"请输入%d个数\\n\"<<endl;\n    for (i = 0; i < N; i++)\n        cin<< arr[i]);\n\n    delete[] p;\n    return 0;\n}\n```\n\n **提问**：为什么不是delete p?\n\n## 内存泄漏\n\n画图\n\n*share_ptr* 的原理：对指针进行计数\n\n# 使用STL库\n\n## String\n\n- 创建string\n- string+\n- insert\n- substr\n\n## Vector\n\n- 创建vector\n- size\n- begin\n- end\n- resize\n\n## Algorithm\n\n- find\n- rotate\n- sort\n- min\n- max\n\n## Utility\n\n- swap\n- pari\n- tuple\n\n# 完整示例\n\n```c++\n//book.h\n#ifndef _book\n#define _book\n\n#include <string>\n#include \"show.hpp\"\n\nclass Book{\npublic:\n    Book(){init();};\n    //Book(double the_price):price(the_price){}\n    Book(double the_price);\n    Book(std::string the_name)=delete;\n    //Book(double the_price,std::string the_name);\n    Book(double the_price,std::string the_name,std::string ISBN);\n    \n    Book(Book);\n    \n    Book(Book b);\n    \n    int set_price();\n    int set_name();\n    int set_ISBN();\n    \n    friend void show_price(Book);\n    \nprivate:\n    double price;\n    std::string name;\n    std::string ISBN;\n    \n    int init(double the_price=0,std::string the_name=\"\",std::string ISBN=\"\");\n};\n#endif\n```\n\n```c++\n//book.cpp\n#include \"book.h\"\n\nBook::Book(double the_price){Book()}\n//Book::Book(double the_price=0,std::string the_name):Book(the_price,the_name,\"\"){}\nBook::Book(double the_price=0,std::string the_name=\"\",std::string the_ISBN=\"\"){\n    Book::init(the_price,the_name,the_ISBN);\n}\nBook::Book(Book the_book){}\n\nint Book::init(double the_price,std::string the_name,std::string the_ISBN){\n    return set_price(the_price) && set_name(the_name) && set_ISBN(the_ISBN);\n}\nint Book::set_price(double the_price){\n    if(the_price>=0){\n        this->price=the_price;\n        return 1;\n    }else{\n        return 0;\n    }\n}\n//set_name 和 set_ISBN 略\n```\n\n```c++\n//show.hpp\nvoid show_price(Book the_book){\n    std::cout<<the_book.price<<std::endl;\n}\n```\n\n```c++\n//main.cpp\n#include \"book.hpp\"\n\nint main(){\n    Book b;\n    b.set_price(10);\n    show_price(b);\n    Book bb(b);\n    //Book bb=b;\n    //Book bb{b};\n}\n```\n\n\n\n# Apollo2D\n\n//这里是Agent2d中的WorldModel","source":"_posts/oop.md","raw":"---\nauthor: kawhicurry\ntitle: oop\ncategories: uncategorized\ndate: 2021-11-21 19:21:13\ntags:\n---\n\n# 课前提醒（给我自己的）\n\n1. 打开vscode，准备源码\n2. 准备好使用g++\n\n# 多文件编程\n\n## Why\n\n非结构化与结构化：`goto`满天飞的后果\n\n## How\n\n```cpp\n//fun.h\nvoid func();\n\n//fun.cpp\n#include \"fun.h\"\nvoid func(){\n\tstd::cout<<\"hello\"<<std::endl;//?\n}\n\n//main.cpp\n#include <stdio.h>\n#inlcude \"fun.h\"\nusing namespace std;\nint main(){\n    printf(\"hi\\n\");\n\tfunc();\n\treturn 0;\n}\n```\n\n**提问**：`iostream`头文件应该放在哪？\n\n```c++\n//fun.h\n#include <iostream>\n```\n\n**提问**：`main.cpp` 如何找到func()的实现？\n\nVS（IDE）的编译过程：\n\n- 预处理\n- 编译，生成中间可执行文件\n- **链接**\n- 生成最终可执行文件\n\n---\n\n演示：https://zhuanlan.zhihu.com/p/106781089\n\n---\n\n更进一步：Make\n\n**提问**：如果把上面的`stdio.h`改成`iostream`，会怎么样\n\n```c++\n//fun.h\n#ifndef _fun\n#define _fun\n\n#include <iostream>\n\n#endif\n```\n\n# 面对对象\n\n**提问**：计算机是用来干啥的？为何计算机今天能为我们带来如此多好处？一个词语，两个汉字。\n\n1. 面向过程：我让机器干啥就干啥\n2. 面向对象：以对象为中心，把问题分解成对象\n\n*举例*：卖书\n\n## C的对象\n\n```c\nstruct book{\n    char name[10];\n    char ISBN[20];\n    double price;\n}\n\ndouble getPrice(struct book* theBook){\n    return theBook->price;\n}\nvoid showPrice(struct book* theBook){\n    printf(\"%lf\",theBook->price);\n}\n```\n\n**提问**：考虑一另一把剑🗡\n\n```c\nstruct sword{\n    char name[10];\n    double price;\n}\ndouble getPrice(struct sword* theSword){\n    return theSword->price;\n}\nvoid showPrice(struct book* theSword){\n    printf(\"%lf\",theSword->price);\n}\n```\n\nC不允许同名函数，即使允许，你也不知道show了谁的price。如何解决这个问题？（其实可以同名，在后面的重载会讲到）\n\n把函数写在struct里面，让函数成为struct的“专属函数”。C不许我们这么做，但是C++可以\n\n```c++\nstruct Book{\n    char name[10];\n    char ISBN[20];\n    double price;\n    \n    double getPrice(){\n    \treturn price;\n\t}\n\tvoid showPrice(){\n    \tprintf(\"%lf\",price);\n\t}\n    //...\n};\n\nstruct Book theBook=/*...*/;\ntheBook.showPrice();\n```\n\n**提问**：考虑price的合理性，如何正确的为price赋值？（price>0)\n\n```c++\n//考虑这种用法\ntheBook.price=100;\n\nint setPrice(double value){\n    if(value<0){\n        return -1;\n    }else{\n        price=value;\n        return 0;\n    }\n}\n//还是没有解决问题，依然可以\ntheBook.price=100;\n```\n\n封装的必要性\n\n```c++\nclass Book{\nprivate:\n    char name[10];\n    char ISBN[20];\n    double price;\npublic:\n\tint setPrice(double value){\n    \tif(value<0){\n        \treturn -1;\n    \t}else{\n        \tprice=value;\n    \t}\n\t}\n    double getPrice(){\n    \treturn price;\n\t}\n\tvoid showPrice(){\n    \tprintf(\"%lf\",price);\n\t}\n    //...\n};\n\n//无法直接修改price，必须通过公共成员函数\n```\n\n## 构造函数\n\nC中的`struct`如何创建对象？\n\n```c\ntypedef struct{\n\tint num;\n}Book;\n\nBook b;\n```\n\n考虑 `int a=1`，我们能不能`Book b`？\n\n我们可以如何创建一个对象？我们需要Constructor，构造函数。\n\n```c++\nclass Book{\npublic:\n    Book(){}\n    //Book(double the_price):price(the_price){}\n    Book(double the_price){setPrice(the_price);}\n    Book(double the_price,char* the_name){\n        Book(the_price,the_name,\"0000\");\n    }\n    Book(double the_price=10.0,char* the_name=\"none\",char* ISBN){\n        setPrice(the_price);\n        memcpy(name,the_name,10);\n        memcpy(ISBN,the_ISBN,20);\n    }\n    \nprivate:\n    double price;\n    char name[10];\n    char ISBN[20];\n    //...\n};\n\nBook b0;\nBook b1(10);\nBook b2(10,\"Apollo\");\n```\n\n参考：\n\n1. 拷贝构造\n2. 移动构造\n3. 合成构造\n\n## 继承与多态\n\n**提问**：我希望有一个科幻书，科幻书有一个别人没有的成员：科幻程度(depth)。同时有一种传记，有一个独有的值来记录传记主人公的名字(person)。\n\n```c++\nclass Book{\npublic:\n    //...\nprivate:\n    double price;\n    char name[10];\n    char ISBN[20];\n    int depth;\n    char* person;\n    //...\n    \n    //...\n};\n```\n\n有公共属性，也有独有的属性(attribute)\n\n```c++\nclass Fiction:public Book{\npublic:\n    Fiction();\n    \n    int setPrice(double value){\n    \tif(value<10){\n        \treturn -1;\n    \t}else{\n        \tprice=value;\n    \t}\n\t}\nprivate:\n    //不用写，都继承过来了\n    //...\n};\nclass biography:public Book{\n  //现场要求写一个  \n};\n```\n\n继承的方式有三种：\n\n>当一个类派生自基类，该基类可以被继承为 **public、protected** 或 **private** 几种类型。继承类型是通过上面讲解的访问修饰符 access-specifier 来指定的。\n>\n>我们几乎不使用 **protected** 或 **private** 继承，通常使用 **public** 继承。当使用不同类型的继承时，遵循以下几个规则：\n>\n>- **公有继承（public）：**当一个类派生自**公有**基类时，基类的**公有**成员也是派生类的**公有**成员，基类的**保护**成员也是派生类的**保护**成员，基类的**私有**成员不能直接被派生类访问，但是可以通过调用基类的**公有**和**保护**成员来访问。\n>- **保护继承（protected）：** 当一个类派生自**保护**基类时，基类的**公有**和**保护**成员将成为派生类的**保护**成员。\n>- **私有继承（private）：**当一个类派生自**私有**基类时，基类的**公有**和**保护**成员将成为派生类的**私有**成员。\n\n现在，我希望所有书都是被分了类的（如果不知道怎么分，就分到“未知分类”里面去），我们现在不允许直接创建一个Book对象，必须要先从Book继承一个专门的分类，再创建该分类的对象。\n\n```c++\nclass Book{\npublic:\n    virtual Book();\n    virtual Book(double the_price);\n    virtual Book(double the_price);\n    \n    virtual int setPrice(double value);\n    \nprivate:\n    char name[10];\n    char ISBN[20];\n    double price;\n    //...\n};\n```\n\n`virtual`意味着必须由子类来实现这些函数。这叫纯虚函数，关于virtual，还有更多用法。\n\n## 重载\n\n`virtual`要求必须由子类来实现，这就是重载。重载允许同名，但必须接受不同参数。\n\n```c++\n#include <iostream>\nusing namespace std;\n\nvoid func(int a) { cout << \"1\" << endl; }\nvoid func(char b) { cout << \"2\" << endl; }\n\nint main() {\n  func(1);\n  func('a');\n}\n```\n\n**提问**：\n\n```c++\n//已经有了这个函数\nBook(double the_price,char* the_name){\n   setPrice(the_price);\n   memcpy(name,the_name,10);\n}\n//又有了这个\nBook(double the_price,char* the_ISBN){\n   setPrice(the_price);\n   memcpy(name,the_ISBN,10);\n}\n\nBook b3(10,\"Apollo\");\n//Apollo 会变成name还是ISBN？\n```\n\nC++编译器不允许这样的事情发生，会出现redefinition报错，编译器认为这两个是同一函数。因此，参数的类型应该有所区别。\n\n更进一步，考虑Book==Book\n\n```c++\nBook a(1,\"apollo\");\nBook b(10,\"apollo\");\n\n//a.equal(b);\nif(a==b){}\n\nclass Book{\npublic:\n    //...\n    bool operator==(const Book) {\n      if (this->name == Book::name)\n        return true;\n      else\n        return false;\n    }\n    \nprivate:\n    char name[10];\n    char ISBN[20];\n    double price;\n    //...\n};\n//写一个重载+，当两本书相同时，价格相加\n```\n\n## 析构函数\n\n一个对象创建完成后，也要销毁，我们应当定义它如何被销毁。\n\n## 两种风格的对象\n\n- 使这个对象像个“东西”，示例如上\n- 使这个对象像个“指针”，先看看内存管理\n\n# 内存管理\n\n**提问**：a+b中的内存是如何分配的？\n\n>**栈区（stack）：**指那些由编译器在需要的时候分配，不需要时自动清除的变量所在的储存区，如函数执行时，函数的形参以及函数内的局部变量分配在栈区，函数运行结束后，形参和局部变量去栈（自动释放）。栈内存分配运算内置与处理器的指令集中，效率高但是分配的内存空间有限。\n>\n>**堆区（heap）：**指哪些由程序员手动分配释放的储存区，如果程序员不释放这块内存，内存将一直被占用，直到程序运行结束由系统自动收回，c语言中使用malloc，free申请和释放空间。\n>\n>**静态储存区（static）：**全局变量和静态变量的储存是放在一块的，其中初始化的全局变量和静态变量在一个区域，这块空间当程序运行结束后由系统释放。\n>\n>**常量储存区（const）：**常量字符串就是储存在这里的，如“ABC”字符串就储存在常量区，储存在常量区的只读不可写。const修饰的全局变量也储存在常量区，const修饰的局部变量依然在栈上。\n>\n>**程序代码区：**存放源程序的二进制代码。\n\n**提问**：如何创建一个长度不定的数组\n\n错误示范：\n\n```c\nint main(void) {\n    int N = 0;\n\n    printf(\"请输入数组的大小\\n\");\n    scanf(\"%d\", &N);\n    int arr[N] = { 0 };\n}\n```\n\n正确示范：\n\n```c\nint main(void) {\n\n    int arr[1000] = { 0 };\n    int N = 0;\n    int i = 0;\n\n    printf(\"请输入数组的大小\\n\");\n    scanf(\"%d\", &N);\n\n    printf(\"请输入%d个数\\n\", N);\n    for (i = 0; i < N; i++)\n        scanf(\"%d\", &arr[i]);\n\n    return 0;\n}\n```\n\n## 手动内存管理\n\nC 使用malloc 分配内存和 free释放内存。\n\n```c\n#include<stdlib.h>\n\nint main(void) {\n\n    int i = 0;\n    int N = 0;\n    int* arr;\n\n    printf(\"请输入数组的大小\\n\");\n    scanf(\"%d\", &N);\n\n    arr = (int*)malloc(sizeof(int) * N);\n\n    printf(\"请输入%d个数\\n\", N);\n    for (i = 0; i < N; i++)\n        scanf(\"%d\", &arr[i]);\n\n    free(arr);\n    return 0;\n}\n```\n\nC++ 使用封装好的new 和delete\n\n```c++\nint main(void) {\n\n    int i = 0;\n    int N = 0;\n\n    printf(\"请输入数组的大小\\n\");\n    cin<<N;\n\n    int *arr = new int[N];\n\n    cin<<\"请输入%d个数\\n\"<<endl;\n    for (i = 0; i < N; i++)\n        cin<< arr[i]);\n\n    delete[] p;\n    return 0;\n}\n```\n\n **提问**：为什么不是delete p?\n\n## 内存泄漏\n\n画图\n\n*share_ptr* 的原理：对指针进行计数\n\n# 使用STL库\n\n## String\n\n- 创建string\n- string+\n- insert\n- substr\n\n## Vector\n\n- 创建vector\n- size\n- begin\n- end\n- resize\n\n## Algorithm\n\n- find\n- rotate\n- sort\n- min\n- max\n\n## Utility\n\n- swap\n- pari\n- tuple\n\n# 完整示例\n\n```c++\n//book.h\n#ifndef _book\n#define _book\n\n#include <string>\n#include \"show.hpp\"\n\nclass Book{\npublic:\n    Book(){init();};\n    //Book(double the_price):price(the_price){}\n    Book(double the_price);\n    Book(std::string the_name)=delete;\n    //Book(double the_price,std::string the_name);\n    Book(double the_price,std::string the_name,std::string ISBN);\n    \n    Book(Book);\n    \n    Book(Book b);\n    \n    int set_price();\n    int set_name();\n    int set_ISBN();\n    \n    friend void show_price(Book);\n    \nprivate:\n    double price;\n    std::string name;\n    std::string ISBN;\n    \n    int init(double the_price=0,std::string the_name=\"\",std::string ISBN=\"\");\n};\n#endif\n```\n\n```c++\n//book.cpp\n#include \"book.h\"\n\nBook::Book(double the_price){Book()}\n//Book::Book(double the_price=0,std::string the_name):Book(the_price,the_name,\"\"){}\nBook::Book(double the_price=0,std::string the_name=\"\",std::string the_ISBN=\"\"){\n    Book::init(the_price,the_name,the_ISBN);\n}\nBook::Book(Book the_book){}\n\nint Book::init(double the_price,std::string the_name,std::string the_ISBN){\n    return set_price(the_price) && set_name(the_name) && set_ISBN(the_ISBN);\n}\nint Book::set_price(double the_price){\n    if(the_price>=0){\n        this->price=the_price;\n        return 1;\n    }else{\n        return 0;\n    }\n}\n//set_name 和 set_ISBN 略\n```\n\n```c++\n//show.hpp\nvoid show_price(Book the_book){\n    std::cout<<the_book.price<<std::endl;\n}\n```\n\n```c++\n//main.cpp\n#include \"book.hpp\"\n\nint main(){\n    Book b;\n    b.set_price(10);\n    show_price(b);\n    Book bb(b);\n    //Book bb=b;\n    //Book bb{b};\n}\n```\n\n\n\n# Apollo2D\n\n//这里是Agent2d中的WorldModel","slug":"oop","published":1,"updated":"2021-11-21T11:22:18.841Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckw95hxhp00005gul4yis9mv2","content":"<h1 id=\"课前提醒（给我自己的）\"><a href=\"#课前提醒（给我自己的）\" class=\"headerlink\" title=\"课前提醒（给我自己的）\"></a>课前提醒（给我自己的）</h1><ol>\n<li>打开vscode，准备源码</li>\n<li>准备好使用g++</li>\n</ol>\n<h1 id=\"多文件编程\"><a href=\"#多文件编程\" class=\"headerlink\" title=\"多文件编程\"></a>多文件编程</h1><h2 id=\"Why\"><a href=\"#Why\" class=\"headerlink\" title=\"Why\"></a>Why</h2><p>非结构化与结构化：<code>goto</code>满天飞的后果</p>\n<h2 id=\"How\"><a href=\"#How\" class=\"headerlink\" title=\"How\"></a>How</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//fun.h</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//fun.cpp</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;fun.h&quot;</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\tstd::cout&lt;&lt;<span class=\"string\">&quot;hello&quot;</span>&lt;&lt;std::endl;<span class=\"comment\">//?</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//main.cpp</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#inlcude <span class=\"meta-string\">&quot;fun.h&quot;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;hi\\n&quot;</span>);</span><br><span class=\"line\">\t<span class=\"built_in\">func</span>();</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>提问</strong>：<code>iostream</code>头文件应该放在哪？</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//fun.h</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<p><strong>提问</strong>：<code>main.cpp</code> 如何找到func()的实现？</p>\n<p>VS（IDE）的编译过程：</p>\n<ul>\n<li>预处理</li>\n<li>编译，生成中间可执行文件</li>\n<li><strong>链接</strong></li>\n<li>生成最终可执行文件</li>\n</ul>\n<hr>\n<p>演示：<a href=\"https://zhuanlan.zhihu.com/p/106781089\">https://zhuanlan.zhihu.com/p/106781089</a></p>\n<hr>\n<p>更进一步：Make</p>\n<p><strong>提问</strong>：如果把上面的<code>stdio.h</code>改成<code>iostream</code>，会怎么样</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//fun.h</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifndef</span> _fun</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> _fun</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"面对对象\"><a href=\"#面对对象\" class=\"headerlink\" title=\"面对对象\"></a>面对对象</h1><p><strong>提问</strong>：计算机是用来干啥的？为何计算机今天能为我们带来如此多好处？一个词语，两个汉字。</p>\n<ol>\n<li>面向过程：我让机器干啥就干啥</li>\n<li>面向对象：以对象为中心，把问题分解成对象</li>\n</ol>\n<p><em>举例</em>：卖书</p>\n<h2 id=\"C的对象\"><a href=\"#C的对象\" class=\"headerlink\" title=\"C的对象\"></a>C的对象</h2><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">book</span>&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">char</span> name[<span class=\"number\">10</span>];</span><br><span class=\"line\">    <span class=\"keyword\">char</span> ISBN[<span class=\"number\">20</span>];</span><br><span class=\"line\">    <span class=\"keyword\">double</span> price;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">double</span> <span class=\"title\">getPrice</span><span class=\"params\">(struct book* theBook)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> theBook-&gt;price;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">showPrice</span><span class=\"params\">(struct book* theBook)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%lf&quot;</span>,theBook-&gt;price);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>提问</strong>：考虑一另一把剑🗡</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">sword</span>&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">char</span> name[<span class=\"number\">10</span>];</span><br><span class=\"line\">    <span class=\"keyword\">double</span> price;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">double</span> <span class=\"title\">getPrice</span><span class=\"params\">(struct sword* theSword)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> theSword-&gt;price;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">showPrice</span><span class=\"params\">(struct book* theSword)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%lf&quot;</span>,theSword-&gt;price);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>C不允许同名函数，即使允许，你也不知道show了谁的price。如何解决这个问题？（其实可以同名，在后面的重载会讲到）</p>\n<p>把函数写在struct里面，让函数成为struct的“专属函数”。C不许我们这么做，但是C++可以</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Book</span>&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">char</span> name[<span class=\"number\">10</span>];</span><br><span class=\"line\">    <span class=\"keyword\">char</span> ISBN[<span class=\"number\">20</span>];</span><br><span class=\"line\">    <span class=\"keyword\">double</span> price;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">double</span> <span class=\"title\">getPrice</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    \t<span class=\"keyword\">return</span> price;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">showPrice</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    \t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%lf&quot;</span>,price);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Book</span> <span class=\"title\">theBook</span>=</span><span class=\"comment\">/*...*/</span>;</span><br><span class=\"line\">theBook.<span class=\"built_in\">showPrice</span>();</span><br></pre></td></tr></table></figure>\n\n<p><strong>提问</strong>：考虑price的合理性，如何正确的为price赋值？（price&gt;0)</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//考虑这种用法</span></span><br><span class=\"line\">theBook.price=<span class=\"number\">100</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">setPrice</span><span class=\"params\">(<span class=\"keyword\">double</span> value)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(value&lt;<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        price=value;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//还是没有解决问题，依然可以</span></span><br><span class=\"line\">theBook.price=<span class=\"number\">100</span>;</span><br></pre></td></tr></table></figure>\n\n<p>封装的必要性</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Book</span>&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">char</span> name[<span class=\"number\">10</span>];</span><br><span class=\"line\">    <span class=\"keyword\">char</span> ISBN[<span class=\"number\">20</span>];</span><br><span class=\"line\">    <span class=\"keyword\">double</span> price;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">setPrice</span><span class=\"params\">(<span class=\"keyword\">double</span> value)</span></span>&#123;</span><br><span class=\"line\">    \t<span class=\"keyword\">if</span>(value&lt;<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        \t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    \t&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        \tprice=value;</span><br><span class=\"line\">    \t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">double</span> <span class=\"title\">getPrice</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    \t<span class=\"keyword\">return</span> price;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">showPrice</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    \t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%lf&quot;</span>,price);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//无法直接修改price，必须通过公共成员函数</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"构造函数\"><a href=\"#构造函数\" class=\"headerlink\" title=\"构造函数\"></a>构造函数</h2><p>C中的<code>struct</code>如何创建对象？</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span>&#123;</span></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> num;</span><br><span class=\"line\">&#125;Book;</span><br><span class=\"line\"></span><br><span class=\"line\">Book b;</span><br></pre></td></tr></table></figure>\n\n<p>考虑 <code>int a=1</code>，我们能不能<code>Book b</code>？</p>\n<p>我们可以如何创建一个对象？我们需要Constructor，构造函数。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Book</span>&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"built_in\">Book</span>()&#123;&#125;</span><br><span class=\"line\">    <span class=\"comment\">//Book(double the_price):price(the_price)&#123;&#125;</span></span><br><span class=\"line\">    <span class=\"built_in\">Book</span>(<span class=\"keyword\">double</span> the_price)&#123;<span class=\"built_in\">setPrice</span>(the_price);&#125;</span><br><span class=\"line\">    <span class=\"built_in\">Book</span>(<span class=\"keyword\">double</span> the_price,<span class=\"keyword\">char</span>* the_name)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">Book</span>(the_price,the_name,<span class=\"string\">&quot;0000&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">Book</span>(<span class=\"keyword\">double</span> the_price=<span class=\"number\">10.0</span>,<span class=\"keyword\">char</span>* the_name=<span class=\"string\">&quot;none&quot;</span>,<span class=\"keyword\">char</span>* ISBN)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">setPrice</span>(the_price);</span><br><span class=\"line\">        <span class=\"built_in\">memcpy</span>(name,the_name,<span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"built_in\">memcpy</span>(ISBN,the_ISBN,<span class=\"number\">20</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">double</span> price;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> name[<span class=\"number\">10</span>];</span><br><span class=\"line\">    <span class=\"keyword\">char</span> ISBN[<span class=\"number\">20</span>];</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Book b0;</span><br><span class=\"line\"><span class=\"function\">Book <span class=\"title\">b1</span><span class=\"params\">(<span class=\"number\">10</span>)</span></span>;</span><br><span class=\"line\"><span class=\"function\">Book <span class=\"title\">b2</span><span class=\"params\">(<span class=\"number\">10</span>,<span class=\"string\">&quot;Apollo&quot;</span>)</span></span>;</span><br></pre></td></tr></table></figure>\n\n<p>参考：</p>\n<ol>\n<li>拷贝构造</li>\n<li>移动构造</li>\n<li>合成构造</li>\n</ol>\n<h2 id=\"继承与多态\"><a href=\"#继承与多态\" class=\"headerlink\" title=\"继承与多态\"></a>继承与多态</h2><p><strong>提问</strong>：我希望有一个科幻书，科幻书有一个别人没有的成员：科幻程度(depth)。同时有一种传记，有一个独有的值来记录传记主人公的名字(person)。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Book</span>&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">double</span> price;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> name[<span class=\"number\">10</span>];</span><br><span class=\"line\">    <span class=\"keyword\">char</span> ISBN[<span class=\"number\">20</span>];</span><br><span class=\"line\">    <span class=\"keyword\">int</span> depth;</span><br><span class=\"line\">    <span class=\"keyword\">char</span>* person;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>有公共属性，也有独有的属性(attribute)</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Fiction</span>:</span><span class=\"keyword\">public</span> Book&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"built_in\">Fiction</span>();</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">setPrice</span><span class=\"params\">(<span class=\"keyword\">double</span> value)</span></span>&#123;</span><br><span class=\"line\">    \t<span class=\"keyword\">if</span>(value&lt;<span class=\"number\">10</span>)&#123;</span><br><span class=\"line\">        \t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    \t&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        \tprice=value;</span><br><span class=\"line\">    \t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"comment\">//不用写，都继承过来了</span></span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">biography</span>:</span><span class=\"keyword\">public</span> Book&#123;</span><br><span class=\"line\">  <span class=\"comment\">//现场要求写一个  </span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>继承的方式有三种：</p>\n<blockquote>\n<p>当一个类派生自基类，该基类可以被继承为 <strong>public、protected</strong> 或 <strong>private</strong> 几种类型。继承类型是通过上面讲解的访问修饰符 access-specifier 来指定的。</p>\n<p>我们几乎不使用 <strong>protected</strong> 或 <strong>private</strong> 继承，通常使用 <strong>public</strong> 继承。当使用不同类型的继承时，遵循以下几个规则：</p>\n<ul>\n<li><strong>公有继承（public）：</strong>当一个类派生自<strong>公有</strong>基类时，基类的<strong>公有</strong>成员也是派生类的<strong>公有</strong>成员，基类的<strong>保护</strong>成员也是派生类的<strong>保护</strong>成员，基类的<strong>私有</strong>成员不能直接被派生类访问，但是可以通过调用基类的<strong>公有</strong>和<strong>保护</strong>成员来访问。</li>\n<li><strong>保护继承（protected）：</strong> 当一个类派生自<strong>保护</strong>基类时，基类的<strong>公有</strong>和<strong>保护</strong>成员将成为派生类的<strong>保护</strong>成员。</li>\n<li><strong>私有继承（private）：</strong>当一个类派生自<strong>私有</strong>基类时，基类的<strong>公有</strong>和<strong>保护</strong>成员将成为派生类的<strong>私有</strong>成员。</li>\n</ul>\n</blockquote>\n<p>现在，我希望所有书都是被分了类的（如果不知道怎么分，就分到“未知分类”里面去），我们现在不允许直接创建一个Book对象，必须要先从Book继承一个专门的分类，再创建该分类的对象。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Book</span>&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"title\">Book</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"title\">Book</span><span class=\"params\">(<span class=\"keyword\">double</span> the_price)</span></span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"title\">Book</span><span class=\"params\">(<span class=\"keyword\">double</span> the_price)</span></span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">int</span> <span class=\"title\">setPrice</span><span class=\"params\">(<span class=\"keyword\">double</span> value)</span></span>;</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">char</span> name[<span class=\"number\">10</span>];</span><br><span class=\"line\">    <span class=\"keyword\">char</span> ISBN[<span class=\"number\">20</span>];</span><br><span class=\"line\">    <span class=\"keyword\">double</span> price;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p><code>virtual</code>意味着必须由子类来实现这些函数。这叫纯虚函数，关于virtual，还有更多用法。</p>\n<h2 id=\"重载\"><a href=\"#重载\" class=\"headerlink\" title=\"重载\"></a>重载</h2><p><code>virtual</code>要求必须由子类来实现，这就是重载。重载允许同名，但必须接受不同参数。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">(<span class=\"keyword\">int</span> a)</span> </span>&#123; cout &lt;&lt; <span class=\"string\">&quot;1&quot;</span> &lt;&lt; endl; &#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">(<span class=\"keyword\">char</span> b)</span> </span>&#123; cout &lt;&lt; <span class=\"string\">&quot;2&quot;</span> &lt;&lt; endl; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">func</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"built_in\">func</span>(<span class=\"string\">&#x27;a&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>提问</strong>：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//已经有了这个函数</span></span><br><span class=\"line\"><span class=\"built_in\">Book</span>(<span class=\"keyword\">double</span> the_price,<span class=\"keyword\">char</span>* the_name)&#123;</span><br><span class=\"line\">   <span class=\"built_in\">setPrice</span>(the_price);</span><br><span class=\"line\">   <span class=\"built_in\">memcpy</span>(name,the_name,<span class=\"number\">10</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//又有了这个</span></span><br><span class=\"line\"><span class=\"built_in\">Book</span>(<span class=\"keyword\">double</span> the_price,<span class=\"keyword\">char</span>* the_ISBN)&#123;</span><br><span class=\"line\">   <span class=\"built_in\">setPrice</span>(the_price);</span><br><span class=\"line\">   <span class=\"built_in\">memcpy</span>(name,the_ISBN,<span class=\"number\">10</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">Book <span class=\"title\">b3</span><span class=\"params\">(<span class=\"number\">10</span>,<span class=\"string\">&quot;Apollo&quot;</span>)</span></span>;</span><br><span class=\"line\"><span class=\"comment\">//Apollo 会变成name还是ISBN？</span></span><br></pre></td></tr></table></figure>\n\n<p>C++编译器不允许这样的事情发生，会出现redefinition报错，编译器认为这两个是同一函数。因此，参数的类型应该有所区别。</p>\n<p>更进一步，考虑Book==Book</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">Book <span class=\"title\">a</span><span class=\"params\">(<span class=\"number\">1</span>,<span class=\"string\">&quot;apollo&quot;</span>)</span></span>;</span><br><span class=\"line\"><span class=\"function\">Book <span class=\"title\">b</span><span class=\"params\">(<span class=\"number\">10</span>,<span class=\"string\">&quot;apollo&quot;</span>)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//a.equal(b);</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(a==b)&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Book</span>&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">    <span class=\"keyword\">bool</span> <span class=\"keyword\">operator</span>==(<span class=\"keyword\">const</span> Book) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>-&gt;name == Book::name)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">      <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">char</span> name[<span class=\"number\">10</span>];</span><br><span class=\"line\">    <span class=\"keyword\">char</span> ISBN[<span class=\"number\">20</span>];</span><br><span class=\"line\">    <span class=\"keyword\">double</span> price;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\">//写一个重载+，当两本书相同时，价格相加</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"析构函数\"><a href=\"#析构函数\" class=\"headerlink\" title=\"析构函数\"></a>析构函数</h2><p>一个对象创建完成后，也要销毁，我们应当定义它如何被销毁。</p>\n<h2 id=\"两种风格的对象\"><a href=\"#两种风格的对象\" class=\"headerlink\" title=\"两种风格的对象\"></a>两种风格的对象</h2><ul>\n<li>使这个对象像个“东西”，示例如上</li>\n<li>使这个对象像个“指针”，先看看内存管理</li>\n</ul>\n<h1 id=\"内存管理\"><a href=\"#内存管理\" class=\"headerlink\" title=\"内存管理\"></a>内存管理</h1><p><strong>提问</strong>：a+b中的内存是如何分配的？</p>\n<blockquote>\n<p><strong>栈区（stack）：</strong>指那些由编译器在需要的时候分配，不需要时自动清除的变量所在的储存区，如函数执行时，函数的形参以及函数内的局部变量分配在栈区，函数运行结束后，形参和局部变量去栈（自动释放）。栈内存分配运算内置与处理器的指令集中，效率高但是分配的内存空间有限。</p>\n<p><strong>堆区（heap）：</strong>指哪些由程序员手动分配释放的储存区，如果程序员不释放这块内存，内存将一直被占用，直到程序运行结束由系统自动收回，c语言中使用malloc，free申请和释放空间。</p>\n<p><strong>静态储存区（static）：</strong>全局变量和静态变量的储存是放在一块的，其中初始化的全局变量和静态变量在一个区域，这块空间当程序运行结束后由系统释放。</p>\n<p><strong>常量储存区（const）：</strong>常量字符串就是储存在这里的，如“ABC”字符串就储存在常量区，储存在常量区的只读不可写。const修饰的全局变量也储存在常量区，const修饰的局部变量依然在栈上。</p>\n<p><strong>程序代码区：</strong>存放源程序的二进制代码。</p>\n</blockquote>\n<p><strong>提问</strong>：如何创建一个长度不定的数组</p>\n<p>错误示范：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> N = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;请输入数组的大小\\n&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;N);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> arr[N] = &#123; <span class=\"number\">0</span> &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>正确示范：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> arr[<span class=\"number\">1000</span>] = &#123; <span class=\"number\">0</span> &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> N = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;请输入数组的大小\\n&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;N);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;请输入%d个数\\n&quot;</span>, N);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; N; i++)</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;arr[i]);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"手动内存管理\"><a href=\"#手动内存管理\" class=\"headerlink\" title=\"手动内存管理\"></a>手动内存管理</h2><p>C 使用malloc 分配内存和 free释放内存。</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;stdlib.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> N = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span>* arr;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;请输入数组的大小\\n&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;N);</span><br><span class=\"line\"></span><br><span class=\"line\">    arr = (<span class=\"keyword\">int</span>*)<span class=\"built_in\">malloc</span>(<span class=\"keyword\">sizeof</span>(<span class=\"keyword\">int</span>) * N);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;请输入%d个数\\n&quot;</span>, N);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; N; i++)</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;arr[i]);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">free</span>(arr);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>C++ 使用封装好的new 和delete</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> N = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;请输入数组的大小\\n&quot;</span>);</span><br><span class=\"line\">    cin&lt;&lt;N;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> *arr = <span class=\"keyword\">new</span> <span class=\"keyword\">int</span>[N];</span><br><span class=\"line\"></span><br><span class=\"line\">    cin&lt;&lt;<span class=\"string\">&quot;请输入%d个数\\n&quot;</span>&lt;&lt;endl;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; N; i++)</span><br><span class=\"line\">        cin&lt;&lt; arr[i]);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">delete</span>[] p;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <strong>提问</strong>：为什么不是delete p?</p>\n<h2 id=\"内存泄漏\"><a href=\"#内存泄漏\" class=\"headerlink\" title=\"内存泄漏\"></a>内存泄漏</h2><p>画图</p>\n<p><em>share_ptr</em> 的原理：对指针进行计数</p>\n<h1 id=\"使用STL库\"><a href=\"#使用STL库\" class=\"headerlink\" title=\"使用STL库\"></a>使用STL库</h1><h2 id=\"String\"><a href=\"#String\" class=\"headerlink\" title=\"String\"></a>String</h2><ul>\n<li>创建string</li>\n<li>string+</li>\n<li>insert</li>\n<li>substr</li>\n</ul>\n<h2 id=\"Vector\"><a href=\"#Vector\" class=\"headerlink\" title=\"Vector\"></a>Vector</h2><ul>\n<li>创建vector</li>\n<li>size</li>\n<li>begin</li>\n<li>end</li>\n<li>resize</li>\n</ul>\n<h2 id=\"Algorithm\"><a href=\"#Algorithm\" class=\"headerlink\" title=\"Algorithm\"></a>Algorithm</h2><ul>\n<li>find</li>\n<li>rotate</li>\n<li>sort</li>\n<li>min</li>\n<li>max</li>\n</ul>\n<h2 id=\"Utility\"><a href=\"#Utility\" class=\"headerlink\" title=\"Utility\"></a>Utility</h2><ul>\n<li>swap</li>\n<li>pari</li>\n<li>tuple</li>\n</ul>\n<h1 id=\"完整示例\"><a href=\"#完整示例\" class=\"headerlink\" title=\"完整示例\"></a>完整示例</h1><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//book.h</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifndef</span> _book</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> _book</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;string&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;show.hpp&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Book</span>&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"built_in\">Book</span>()&#123;<span class=\"built_in\">init</span>();&#125;;</span><br><span class=\"line\">    <span class=\"comment\">//Book(double the_price):price(the_price)&#123;&#125;</span></span><br><span class=\"line\">    <span class=\"built_in\">Book</span>(<span class=\"keyword\">double</span> the_price);</span><br><span class=\"line\">    <span class=\"built_in\">Book</span>(std::string the_name)=<span class=\"keyword\">delete</span>;</span><br><span class=\"line\">    <span class=\"comment\">//Book(double the_price,std::string the_name);</span></span><br><span class=\"line\">    <span class=\"built_in\">Book</span>(<span class=\"keyword\">double</span> the_price,std::string the_name,std::string ISBN);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">Book</span>(Book);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">Book</span>(Book b);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">set_price</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">set_name</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">set_ISBN</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">friend</span> <span class=\"keyword\">void</span> <span class=\"title\">show_price</span><span class=\"params\">(Book)</span></span>;</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">double</span> price;</span><br><span class=\"line\">    std::string name;</span><br><span class=\"line\">    std::string ISBN;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">init</span><span class=\"params\">(<span class=\"keyword\">double</span> the_price=<span class=\"number\">0</span>,std::string the_name=<span class=\"string\">&quot;&quot;</span>,std::string ISBN=<span class=\"string\">&quot;&quot;</span>)</span></span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//book.cpp</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;book.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">Book::<span class=\"built_in\">Book</span>(<span class=\"keyword\">double</span> the_price)&#123;<span class=\"built_in\">Book</span>()&#125;</span><br><span class=\"line\"><span class=\"comment\">//Book::Book(double the_price=0,std::string the_name):Book(the_price,the_name,&quot;&quot;)&#123;&#125;</span></span><br><span class=\"line\">Book::<span class=\"built_in\">Book</span>(<span class=\"keyword\">double</span> the_price=<span class=\"number\">0</span>,std::string the_name=<span class=\"string\">&quot;&quot;</span>,std::string the_ISBN=<span class=\"string\">&quot;&quot;</span>)&#123;</span><br><span class=\"line\">    Book::<span class=\"built_in\">init</span>(the_price,the_name,the_ISBN);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Book::<span class=\"built_in\">Book</span>(Book the_book)&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">Book::init</span><span class=\"params\">(<span class=\"keyword\">double</span> the_price,std::string the_name,std::string the_ISBN)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">set_price</span>(the_price) &amp;&amp; <span class=\"built_in\">set_name</span>(the_name) &amp;&amp; <span class=\"built_in\">set_ISBN</span>(the_ISBN);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">Book::set_price</span><span class=\"params\">(<span class=\"keyword\">double</span> the_price)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(the_price&gt;=<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>-&gt;price=the_price;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//set_name 和 set_ISBN 略</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//show.hpp</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">show_price</span><span class=\"params\">(Book the_book)</span></span>&#123;</span><br><span class=\"line\">    std::cout&lt;&lt;the_book.price&lt;&lt;std::endl;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//main.cpp</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;book.hpp&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    Book b;</span><br><span class=\"line\">    b.<span class=\"built_in\">set_price</span>(<span class=\"number\">10</span>);</span><br><span class=\"line\">    <span class=\"built_in\">show_price</span>(b);</span><br><span class=\"line\">    <span class=\"function\">Book <span class=\"title\">bb</span><span class=\"params\">(b)</span></span>;</span><br><span class=\"line\">    <span class=\"comment\">//Book bb=b;</span></span><br><span class=\"line\">    <span class=\"comment\">//Book bb&#123;b&#125;;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"Apollo2D\"><a href=\"#Apollo2D\" class=\"headerlink\" title=\"Apollo2D\"></a>Apollo2D</h1><p>//这里是Agent2d中的WorldModel</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"课前提醒（给我自己的）\"><a href=\"#课前提醒（给我自己的）\" class=\"headerlink\" title=\"课前提醒（给我自己的）\"></a>课前提醒（给我自己的）</h1><ol>\n<li>打开vscode，准备源码</li>\n<li>准备好使用g++</li>\n</ol>\n<h1 id=\"多文件编程\"><a href=\"#多文件编程\" class=\"headerlink\" title=\"多文件编程\"></a>多文件编程</h1><h2 id=\"Why\"><a href=\"#Why\" class=\"headerlink\" title=\"Why\"></a>Why</h2><p>非结构化与结构化：<code>goto</code>满天飞的后果</p>\n<h2 id=\"How\"><a href=\"#How\" class=\"headerlink\" title=\"How\"></a>How</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//fun.h</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//fun.cpp</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;fun.h&quot;</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\tstd::cout&lt;&lt;<span class=\"string\">&quot;hello&quot;</span>&lt;&lt;std::endl;<span class=\"comment\">//?</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//main.cpp</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#inlcude <span class=\"meta-string\">&quot;fun.h&quot;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;hi\\n&quot;</span>);</span><br><span class=\"line\">\t<span class=\"built_in\">func</span>();</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>提问</strong>：<code>iostream</code>头文件应该放在哪？</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//fun.h</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<p><strong>提问</strong>：<code>main.cpp</code> 如何找到func()的实现？</p>\n<p>VS（IDE）的编译过程：</p>\n<ul>\n<li>预处理</li>\n<li>编译，生成中间可执行文件</li>\n<li><strong>链接</strong></li>\n<li>生成最终可执行文件</li>\n</ul>\n<hr>\n<p>演示：<a href=\"https://zhuanlan.zhihu.com/p/106781089\">https://zhuanlan.zhihu.com/p/106781089</a></p>\n<hr>\n<p>更进一步：Make</p>\n<p><strong>提问</strong>：如果把上面的<code>stdio.h</code>改成<code>iostream</code>，会怎么样</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//fun.h</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifndef</span> _fun</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> _fun</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"面对对象\"><a href=\"#面对对象\" class=\"headerlink\" title=\"面对对象\"></a>面对对象</h1><p><strong>提问</strong>：计算机是用来干啥的？为何计算机今天能为我们带来如此多好处？一个词语，两个汉字。</p>\n<ol>\n<li>面向过程：我让机器干啥就干啥</li>\n<li>面向对象：以对象为中心，把问题分解成对象</li>\n</ol>\n<p><em>举例</em>：卖书</p>\n<h2 id=\"C的对象\"><a href=\"#C的对象\" class=\"headerlink\" title=\"C的对象\"></a>C的对象</h2><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">book</span>&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">char</span> name[<span class=\"number\">10</span>];</span><br><span class=\"line\">    <span class=\"keyword\">char</span> ISBN[<span class=\"number\">20</span>];</span><br><span class=\"line\">    <span class=\"keyword\">double</span> price;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">double</span> <span class=\"title\">getPrice</span><span class=\"params\">(struct book* theBook)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> theBook-&gt;price;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">showPrice</span><span class=\"params\">(struct book* theBook)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%lf&quot;</span>,theBook-&gt;price);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>提问</strong>：考虑一另一把剑🗡</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">sword</span>&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">char</span> name[<span class=\"number\">10</span>];</span><br><span class=\"line\">    <span class=\"keyword\">double</span> price;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">double</span> <span class=\"title\">getPrice</span><span class=\"params\">(struct sword* theSword)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> theSword-&gt;price;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">showPrice</span><span class=\"params\">(struct book* theSword)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%lf&quot;</span>,theSword-&gt;price);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>C不允许同名函数，即使允许，你也不知道show了谁的price。如何解决这个问题？（其实可以同名，在后面的重载会讲到）</p>\n<p>把函数写在struct里面，让函数成为struct的“专属函数”。C不许我们这么做，但是C++可以</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Book</span>&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">char</span> name[<span class=\"number\">10</span>];</span><br><span class=\"line\">    <span class=\"keyword\">char</span> ISBN[<span class=\"number\">20</span>];</span><br><span class=\"line\">    <span class=\"keyword\">double</span> price;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">double</span> <span class=\"title\">getPrice</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    \t<span class=\"keyword\">return</span> price;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">showPrice</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    \t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%lf&quot;</span>,price);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Book</span> <span class=\"title\">theBook</span>=</span><span class=\"comment\">/*...*/</span>;</span><br><span class=\"line\">theBook.<span class=\"built_in\">showPrice</span>();</span><br></pre></td></tr></table></figure>\n\n<p><strong>提问</strong>：考虑price的合理性，如何正确的为price赋值？（price&gt;0)</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//考虑这种用法</span></span><br><span class=\"line\">theBook.price=<span class=\"number\">100</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">setPrice</span><span class=\"params\">(<span class=\"keyword\">double</span> value)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(value&lt;<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        price=value;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//还是没有解决问题，依然可以</span></span><br><span class=\"line\">theBook.price=<span class=\"number\">100</span>;</span><br></pre></td></tr></table></figure>\n\n<p>封装的必要性</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Book</span>&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">char</span> name[<span class=\"number\">10</span>];</span><br><span class=\"line\">    <span class=\"keyword\">char</span> ISBN[<span class=\"number\">20</span>];</span><br><span class=\"line\">    <span class=\"keyword\">double</span> price;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">setPrice</span><span class=\"params\">(<span class=\"keyword\">double</span> value)</span></span>&#123;</span><br><span class=\"line\">    \t<span class=\"keyword\">if</span>(value&lt;<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        \t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    \t&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        \tprice=value;</span><br><span class=\"line\">    \t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">double</span> <span class=\"title\">getPrice</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    \t<span class=\"keyword\">return</span> price;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">showPrice</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    \t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%lf&quot;</span>,price);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//无法直接修改price，必须通过公共成员函数</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"构造函数\"><a href=\"#构造函数\" class=\"headerlink\" title=\"构造函数\"></a>构造函数</h2><p>C中的<code>struct</code>如何创建对象？</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span>&#123;</span></span><br><span class=\"line\">\t<span class=\"keyword\">int</span> num;</span><br><span class=\"line\">&#125;Book;</span><br><span class=\"line\"></span><br><span class=\"line\">Book b;</span><br></pre></td></tr></table></figure>\n\n<p>考虑 <code>int a=1</code>，我们能不能<code>Book b</code>？</p>\n<p>我们可以如何创建一个对象？我们需要Constructor，构造函数。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Book</span>&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"built_in\">Book</span>()&#123;&#125;</span><br><span class=\"line\">    <span class=\"comment\">//Book(double the_price):price(the_price)&#123;&#125;</span></span><br><span class=\"line\">    <span class=\"built_in\">Book</span>(<span class=\"keyword\">double</span> the_price)&#123;<span class=\"built_in\">setPrice</span>(the_price);&#125;</span><br><span class=\"line\">    <span class=\"built_in\">Book</span>(<span class=\"keyword\">double</span> the_price,<span class=\"keyword\">char</span>* the_name)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">Book</span>(the_price,the_name,<span class=\"string\">&quot;0000&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">Book</span>(<span class=\"keyword\">double</span> the_price=<span class=\"number\">10.0</span>,<span class=\"keyword\">char</span>* the_name=<span class=\"string\">&quot;none&quot;</span>,<span class=\"keyword\">char</span>* ISBN)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">setPrice</span>(the_price);</span><br><span class=\"line\">        <span class=\"built_in\">memcpy</span>(name,the_name,<span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"built_in\">memcpy</span>(ISBN,the_ISBN,<span class=\"number\">20</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">double</span> price;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> name[<span class=\"number\">10</span>];</span><br><span class=\"line\">    <span class=\"keyword\">char</span> ISBN[<span class=\"number\">20</span>];</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Book b0;</span><br><span class=\"line\"><span class=\"function\">Book <span class=\"title\">b1</span><span class=\"params\">(<span class=\"number\">10</span>)</span></span>;</span><br><span class=\"line\"><span class=\"function\">Book <span class=\"title\">b2</span><span class=\"params\">(<span class=\"number\">10</span>,<span class=\"string\">&quot;Apollo&quot;</span>)</span></span>;</span><br></pre></td></tr></table></figure>\n\n<p>参考：</p>\n<ol>\n<li>拷贝构造</li>\n<li>移动构造</li>\n<li>合成构造</li>\n</ol>\n<h2 id=\"继承与多态\"><a href=\"#继承与多态\" class=\"headerlink\" title=\"继承与多态\"></a>继承与多态</h2><p><strong>提问</strong>：我希望有一个科幻书，科幻书有一个别人没有的成员：科幻程度(depth)。同时有一种传记，有一个独有的值来记录传记主人公的名字(person)。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Book</span>&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">double</span> price;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> name[<span class=\"number\">10</span>];</span><br><span class=\"line\">    <span class=\"keyword\">char</span> ISBN[<span class=\"number\">20</span>];</span><br><span class=\"line\">    <span class=\"keyword\">int</span> depth;</span><br><span class=\"line\">    <span class=\"keyword\">char</span>* person;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>有公共属性，也有独有的属性(attribute)</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Fiction</span>:</span><span class=\"keyword\">public</span> Book&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"built_in\">Fiction</span>();</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">setPrice</span><span class=\"params\">(<span class=\"keyword\">double</span> value)</span></span>&#123;</span><br><span class=\"line\">    \t<span class=\"keyword\">if</span>(value&lt;<span class=\"number\">10</span>)&#123;</span><br><span class=\"line\">        \t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    \t&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        \tprice=value;</span><br><span class=\"line\">    \t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"comment\">//不用写，都继承过来了</span></span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">biography</span>:</span><span class=\"keyword\">public</span> Book&#123;</span><br><span class=\"line\">  <span class=\"comment\">//现场要求写一个  </span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>继承的方式有三种：</p>\n<blockquote>\n<p>当一个类派生自基类，该基类可以被继承为 <strong>public、protected</strong> 或 <strong>private</strong> 几种类型。继承类型是通过上面讲解的访问修饰符 access-specifier 来指定的。</p>\n<p>我们几乎不使用 <strong>protected</strong> 或 <strong>private</strong> 继承，通常使用 <strong>public</strong> 继承。当使用不同类型的继承时，遵循以下几个规则：</p>\n<ul>\n<li><strong>公有继承（public）：</strong>当一个类派生自<strong>公有</strong>基类时，基类的<strong>公有</strong>成员也是派生类的<strong>公有</strong>成员，基类的<strong>保护</strong>成员也是派生类的<strong>保护</strong>成员，基类的<strong>私有</strong>成员不能直接被派生类访问，但是可以通过调用基类的<strong>公有</strong>和<strong>保护</strong>成员来访问。</li>\n<li><strong>保护继承（protected）：</strong> 当一个类派生自<strong>保护</strong>基类时，基类的<strong>公有</strong>和<strong>保护</strong>成员将成为派生类的<strong>保护</strong>成员。</li>\n<li><strong>私有继承（private）：</strong>当一个类派生自<strong>私有</strong>基类时，基类的<strong>公有</strong>和<strong>保护</strong>成员将成为派生类的<strong>私有</strong>成员。</li>\n</ul>\n</blockquote>\n<p>现在，我希望所有书都是被分了类的（如果不知道怎么分，就分到“未知分类”里面去），我们现在不允许直接创建一个Book对象，必须要先从Book继承一个专门的分类，再创建该分类的对象。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Book</span>&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"title\">Book</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"title\">Book</span><span class=\"params\">(<span class=\"keyword\">double</span> the_price)</span></span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"title\">Book</span><span class=\"params\">(<span class=\"keyword\">double</span> the_price)</span></span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"keyword\">int</span> <span class=\"title\">setPrice</span><span class=\"params\">(<span class=\"keyword\">double</span> value)</span></span>;</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">char</span> name[<span class=\"number\">10</span>];</span><br><span class=\"line\">    <span class=\"keyword\">char</span> ISBN[<span class=\"number\">20</span>];</span><br><span class=\"line\">    <span class=\"keyword\">double</span> price;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p><code>virtual</code>意味着必须由子类来实现这些函数。这叫纯虚函数，关于virtual，还有更多用法。</p>\n<h2 id=\"重载\"><a href=\"#重载\" class=\"headerlink\" title=\"重载\"></a>重载</h2><p><code>virtual</code>要求必须由子类来实现，这就是重载。重载允许同名，但必须接受不同参数。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">(<span class=\"keyword\">int</span> a)</span> </span>&#123; cout &lt;&lt; <span class=\"string\">&quot;1&quot;</span> &lt;&lt; endl; &#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">(<span class=\"keyword\">char</span> b)</span> </span>&#123; cout &lt;&lt; <span class=\"string\">&quot;2&quot;</span> &lt;&lt; endl; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">func</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"built_in\">func</span>(<span class=\"string\">&#x27;a&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>提问</strong>：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//已经有了这个函数</span></span><br><span class=\"line\"><span class=\"built_in\">Book</span>(<span class=\"keyword\">double</span> the_price,<span class=\"keyword\">char</span>* the_name)&#123;</span><br><span class=\"line\">   <span class=\"built_in\">setPrice</span>(the_price);</span><br><span class=\"line\">   <span class=\"built_in\">memcpy</span>(name,the_name,<span class=\"number\">10</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//又有了这个</span></span><br><span class=\"line\"><span class=\"built_in\">Book</span>(<span class=\"keyword\">double</span> the_price,<span class=\"keyword\">char</span>* the_ISBN)&#123;</span><br><span class=\"line\">   <span class=\"built_in\">setPrice</span>(the_price);</span><br><span class=\"line\">   <span class=\"built_in\">memcpy</span>(name,the_ISBN,<span class=\"number\">10</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">Book <span class=\"title\">b3</span><span class=\"params\">(<span class=\"number\">10</span>,<span class=\"string\">&quot;Apollo&quot;</span>)</span></span>;</span><br><span class=\"line\"><span class=\"comment\">//Apollo 会变成name还是ISBN？</span></span><br></pre></td></tr></table></figure>\n\n<p>C++编译器不允许这样的事情发生，会出现redefinition报错，编译器认为这两个是同一函数。因此，参数的类型应该有所区别。</p>\n<p>更进一步，考虑Book==Book</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">Book <span class=\"title\">a</span><span class=\"params\">(<span class=\"number\">1</span>,<span class=\"string\">&quot;apollo&quot;</span>)</span></span>;</span><br><span class=\"line\"><span class=\"function\">Book <span class=\"title\">b</span><span class=\"params\">(<span class=\"number\">10</span>,<span class=\"string\">&quot;apollo&quot;</span>)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//a.equal(b);</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(a==b)&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Book</span>&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">    <span class=\"keyword\">bool</span> <span class=\"keyword\">operator</span>==(<span class=\"keyword\">const</span> Book) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>-&gt;name == Book::name)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">      <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">char</span> name[<span class=\"number\">10</span>];</span><br><span class=\"line\">    <span class=\"keyword\">char</span> ISBN[<span class=\"number\">20</span>];</span><br><span class=\"line\">    <span class=\"keyword\">double</span> price;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\">//写一个重载+，当两本书相同时，价格相加</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"析构函数\"><a href=\"#析构函数\" class=\"headerlink\" title=\"析构函数\"></a>析构函数</h2><p>一个对象创建完成后，也要销毁，我们应当定义它如何被销毁。</p>\n<h2 id=\"两种风格的对象\"><a href=\"#两种风格的对象\" class=\"headerlink\" title=\"两种风格的对象\"></a>两种风格的对象</h2><ul>\n<li>使这个对象像个“东西”，示例如上</li>\n<li>使这个对象像个“指针”，先看看内存管理</li>\n</ul>\n<h1 id=\"内存管理\"><a href=\"#内存管理\" class=\"headerlink\" title=\"内存管理\"></a>内存管理</h1><p><strong>提问</strong>：a+b中的内存是如何分配的？</p>\n<blockquote>\n<p><strong>栈区（stack）：</strong>指那些由编译器在需要的时候分配，不需要时自动清除的变量所在的储存区，如函数执行时，函数的形参以及函数内的局部变量分配在栈区，函数运行结束后，形参和局部变量去栈（自动释放）。栈内存分配运算内置与处理器的指令集中，效率高但是分配的内存空间有限。</p>\n<p><strong>堆区（heap）：</strong>指哪些由程序员手动分配释放的储存区，如果程序员不释放这块内存，内存将一直被占用，直到程序运行结束由系统自动收回，c语言中使用malloc，free申请和释放空间。</p>\n<p><strong>静态储存区（static）：</strong>全局变量和静态变量的储存是放在一块的，其中初始化的全局变量和静态变量在一个区域，这块空间当程序运行结束后由系统释放。</p>\n<p><strong>常量储存区（const）：</strong>常量字符串就是储存在这里的，如“ABC”字符串就储存在常量区，储存在常量区的只读不可写。const修饰的全局变量也储存在常量区，const修饰的局部变量依然在栈上。</p>\n<p><strong>程序代码区：</strong>存放源程序的二进制代码。</p>\n</blockquote>\n<p><strong>提问</strong>：如何创建一个长度不定的数组</p>\n<p>错误示范：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> N = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;请输入数组的大小\\n&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;N);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> arr[N] = &#123; <span class=\"number\">0</span> &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>正确示范：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> arr[<span class=\"number\">1000</span>] = &#123; <span class=\"number\">0</span> &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> N = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;请输入数组的大小\\n&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;N);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;请输入%d个数\\n&quot;</span>, N);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; N; i++)</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;arr[i]);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"手动内存管理\"><a href=\"#手动内存管理\" class=\"headerlink\" title=\"手动内存管理\"></a>手动内存管理</h2><p>C 使用malloc 分配内存和 free释放内存。</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;stdlib.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> N = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span>* arr;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;请输入数组的大小\\n&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;N);</span><br><span class=\"line\"></span><br><span class=\"line\">    arr = (<span class=\"keyword\">int</span>*)<span class=\"built_in\">malloc</span>(<span class=\"keyword\">sizeof</span>(<span class=\"keyword\">int</span>) * N);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;请输入%d个数\\n&quot;</span>, N);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; N; i++)</span><br><span class=\"line\">        <span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;arr[i]);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">free</span>(arr);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>C++ 使用封装好的new 和delete</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">void</span>)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> N = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;请输入数组的大小\\n&quot;</span>);</span><br><span class=\"line\">    cin&lt;&lt;N;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> *arr = <span class=\"keyword\">new</span> <span class=\"keyword\">int</span>[N];</span><br><span class=\"line\"></span><br><span class=\"line\">    cin&lt;&lt;<span class=\"string\">&quot;请输入%d个数\\n&quot;</span>&lt;&lt;endl;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; N; i++)</span><br><span class=\"line\">        cin&lt;&lt; arr[i]);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">delete</span>[] p;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <strong>提问</strong>：为什么不是delete p?</p>\n<h2 id=\"内存泄漏\"><a href=\"#内存泄漏\" class=\"headerlink\" title=\"内存泄漏\"></a>内存泄漏</h2><p>画图</p>\n<p><em>share_ptr</em> 的原理：对指针进行计数</p>\n<h1 id=\"使用STL库\"><a href=\"#使用STL库\" class=\"headerlink\" title=\"使用STL库\"></a>使用STL库</h1><h2 id=\"String\"><a href=\"#String\" class=\"headerlink\" title=\"String\"></a>String</h2><ul>\n<li>创建string</li>\n<li>string+</li>\n<li>insert</li>\n<li>substr</li>\n</ul>\n<h2 id=\"Vector\"><a href=\"#Vector\" class=\"headerlink\" title=\"Vector\"></a>Vector</h2><ul>\n<li>创建vector</li>\n<li>size</li>\n<li>begin</li>\n<li>end</li>\n<li>resize</li>\n</ul>\n<h2 id=\"Algorithm\"><a href=\"#Algorithm\" class=\"headerlink\" title=\"Algorithm\"></a>Algorithm</h2><ul>\n<li>find</li>\n<li>rotate</li>\n<li>sort</li>\n<li>min</li>\n<li>max</li>\n</ul>\n<h2 id=\"Utility\"><a href=\"#Utility\" class=\"headerlink\" title=\"Utility\"></a>Utility</h2><ul>\n<li>swap</li>\n<li>pari</li>\n<li>tuple</li>\n</ul>\n<h1 id=\"完整示例\"><a href=\"#完整示例\" class=\"headerlink\" title=\"完整示例\"></a>完整示例</h1><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//book.h</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifndef</span> _book</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> _book</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;string&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;show.hpp&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Book</span>&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"built_in\">Book</span>()&#123;<span class=\"built_in\">init</span>();&#125;;</span><br><span class=\"line\">    <span class=\"comment\">//Book(double the_price):price(the_price)&#123;&#125;</span></span><br><span class=\"line\">    <span class=\"built_in\">Book</span>(<span class=\"keyword\">double</span> the_price);</span><br><span class=\"line\">    <span class=\"built_in\">Book</span>(std::string the_name)=<span class=\"keyword\">delete</span>;</span><br><span class=\"line\">    <span class=\"comment\">//Book(double the_price,std::string the_name);</span></span><br><span class=\"line\">    <span class=\"built_in\">Book</span>(<span class=\"keyword\">double</span> the_price,std::string the_name,std::string ISBN);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">Book</span>(Book);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">Book</span>(Book b);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">set_price</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">set_name</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">set_ISBN</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">friend</span> <span class=\"keyword\">void</span> <span class=\"title\">show_price</span><span class=\"params\">(Book)</span></span>;</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">double</span> price;</span><br><span class=\"line\">    std::string name;</span><br><span class=\"line\">    std::string ISBN;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">init</span><span class=\"params\">(<span class=\"keyword\">double</span> the_price=<span class=\"number\">0</span>,std::string the_name=<span class=\"string\">&quot;&quot;</span>,std::string ISBN=<span class=\"string\">&quot;&quot;</span>)</span></span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//book.cpp</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;book.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">Book::<span class=\"built_in\">Book</span>(<span class=\"keyword\">double</span> the_price)&#123;<span class=\"built_in\">Book</span>()&#125;</span><br><span class=\"line\"><span class=\"comment\">//Book::Book(double the_price=0,std::string the_name):Book(the_price,the_name,&quot;&quot;)&#123;&#125;</span></span><br><span class=\"line\">Book::<span class=\"built_in\">Book</span>(<span class=\"keyword\">double</span> the_price=<span class=\"number\">0</span>,std::string the_name=<span class=\"string\">&quot;&quot;</span>,std::string the_ISBN=<span class=\"string\">&quot;&quot;</span>)&#123;</span><br><span class=\"line\">    Book::<span class=\"built_in\">init</span>(the_price,the_name,the_ISBN);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Book::<span class=\"built_in\">Book</span>(Book the_book)&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">Book::init</span><span class=\"params\">(<span class=\"keyword\">double</span> the_price,std::string the_name,std::string the_ISBN)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">set_price</span>(the_price) &amp;&amp; <span class=\"built_in\">set_name</span>(the_name) &amp;&amp; <span class=\"built_in\">set_ISBN</span>(the_ISBN);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">Book::set_price</span><span class=\"params\">(<span class=\"keyword\">double</span> the_price)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(the_price&gt;=<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>-&gt;price=the_price;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//set_name 和 set_ISBN 略</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//show.hpp</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">show_price</span><span class=\"params\">(Book the_book)</span></span>&#123;</span><br><span class=\"line\">    std::cout&lt;&lt;the_book.price&lt;&lt;std::endl;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//main.cpp</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;book.hpp&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    Book b;</span><br><span class=\"line\">    b.<span class=\"built_in\">set_price</span>(<span class=\"number\">10</span>);</span><br><span class=\"line\">    <span class=\"built_in\">show_price</span>(b);</span><br><span class=\"line\">    <span class=\"function\">Book <span class=\"title\">bb</span><span class=\"params\">(b)</span></span>;</span><br><span class=\"line\">    <span class=\"comment\">//Book bb=b;</span></span><br><span class=\"line\">    <span class=\"comment\">//Book bb&#123;b&#125;;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"Apollo2D\"><a href=\"#Apollo2D\" class=\"headerlink\" title=\"Apollo2D\"></a>Apollo2D</h1><p>//这里是Agent2d中的WorldModel</p>\n"},{"author":"kawhicurry","title":"0xCalculator","date":"2021-11-28T09:31:31.000Z","_content":"\n# 功能\n\n1. 对十六进制数进行双目、表达式运算\n2. 对运算结果进行保存和再读取，支持自动保存和手动保存\n3. 自定义运算结果储存位置\n4. 自定义字体大小\n5. 可更换窗口风格（换肤）\n6. 自动保存设置\n\n# 任务分配\n\n1. ：ui设计与qt框架\n2. ：核心算法\n3. ：文件读写\n\n# 开源地址\n<https://github.com/kawhicurry/0xCalculator>\n\n# 开发过程\n\n## Qt框架\n\nqt文件将会以平铺的方式放置在同一工程目录下，其组织结构由`.pro`文件记录，该文件类似于makefile（可以看作是qmakefile？）。其标准目录如下：\n\n> .pro：记录文件\n>\n> /Headers：略\n>\n> /Sources：略\n>\n> /Forms：存放`.ui`文件，实际为`xml`格式，但不建议直接编辑，所有操作应当在设计模块中完成\n>\n> /Resources：存放qt标准资源（可以qt方式引用的资源）\n>\n> /Other files\n\n## UI设计\n\n直接在qt creator的设计界面中打开`设计`模块。从画面左侧拖动组件，摆放至设计框中即可。\n\n*问题*：组件散乱\n\n- 左侧组件库中有`layout`组件,将其拖动至设计框中,再向layout中添加组件，即可使所有组件呈现一定规律。\n\n>布局类型：\n>\n>垂直：略\n>\n>水平：略\n>\n>栅格（grid）：上面俩合起来\n>\n>窗口：？存疑，不是很能理解这是啥\n\n*问题*：使用layout组件后无法布局固定，启动ui界面后拖动窗口改变其大小，layout组件位置不动。\n\n- 应当首先在右侧`对象`框中选中主窗口（mainwindow）中的中间部件（centralwidget），右键选择布局，为整个中间部分设定大的布局，（注：主窗口除了中间部件还初始化了一个菜单栏（menubar）），然后在该布局中嵌套布局或组件。本方案选择了栅格布局，虽然只需垂直布局即可，但为了可拓展性，还是选择栅格。接下来在整个中间部分的栅格布局中，嵌套了一个垂直布局（用于输入和输出）和一个栅格布局（用于存放按键）。\n\n接下来在主窗口中添加所需的组件，分别为输入框、输出框、5*6个按键。然后可以对其属性进行可视化的设计，以下是对`设计`界面中一些工具的解释：\n\n> 右侧下方为属性框，显示了所选定组件的属性，每个组件都是层层继承而来，因此要注意每一层的具体属性以及继承关系。\n>\n> 右侧上方为对象框，显示了当前ui文件中所有文件属性。\n>\n> 正中央下方的框实际上有两个可编辑区域，一个为action editor，即为组件添加动作（可方便设置快捷键）。另一个为信号与槽。\n>\n> 注：信号与槽是最Qt制作ui界面中最重要的机制。\n\n创建槽函数：在信号与槽编辑框中点击加号创建信号与槽，然后选择信号的发送对象、发送信号量、槽、响应函数。此处的创建**只支持内定的槽函数**，想要自定义槽函数，需在右侧对象中找到对象，然后右键选择转到槽，接下来选择信号量之后，Qt会跳转该ui文件对应的cpp文件下，并自动创建一个该槽函数的实现（.h文件中也会自动添加声明）。接下来只需在此槽函数中编写发送信号后（触发信号发送条件），所需只需的步骤即可。\n\n> 信号量是Qt类自带的属性，某个类既有自己的属性，也有继承而来的属性。如pushButton组件继承自QAbstractButton，后者又继承自QWidget，后者又继承自QObject。对于QAbstractButton，其自带的信号有`clicked()`,`pressed()`等，对于QWidget，有`windowIconChanged`等。具体解释请参考官方文档。\n\n`设计`界面支持大量的属性设置，如字体，背景等。并且可以直接在ui界面中即时显示，但并不推荐直接做修改。\n\n一种渲染方式：Qt提供了qss来进行类似css的样式渲染，只需选中对象然后右键改变样式表，修改某个组件的样式表即可。Qss还提供了选择器的功能，因此，只需在某个较大的组件中设置样式表，并对不同的渲染对象进行选择即可。本方案一开始的办法就是在centralwidget组件中设置样式表，完成了酷炫的按键风格。需要注意的是，改变样式表的方法在Qt中是存在一定问题的，并且，**任何写死的方法都可能在以后要修改时造成麻烦**。关于样式表后面还会再进一步设定。\n\n## 模拟按键\n\n一个计算器应当提供一系列的按键，因此要在栅格布局中拖入一定数量的按键。按键分为输入按键和功能按键。\n\n- 输入按键：0123456789ABCDEF+-*/（）\n- 功能按键：<- -> DEL CE UP DOWN =\n\n对于输入按键，按下按键后应当在输入框中显示对应的输入，同时这些按键应当有对应的键盘输入。\n\n对于输出按键，左移和右移是为了移动输入框中的光标。DEL清除一个字符，CE要同时清除输入和输出框。UP和DOWN提供了查看历史功能。等号是整个计算器的核心功能，按下等号后，应当读取输入框中的算式，进行计算后将结果字符串返回至输出框中。\n\n通过在组件上右键选择 转到槽 可以快捷创建槽函数。示例如图：\n\n```c++\n//mainwindow.h\nvoid MainWindow::on_pushButton_left_bracket_clicked();\n//mainwindow.cpp\nvoid MainWindow::on_pushButton_left_bracket_clicked() {\n  ui->textBrowser_input->setFocus();\n  ui->textBrowser_input->insertPlainText(\"(\");\n}\n```\n\n手动创建几个后，就可以发现其规矩。一个槽函数的名称由`on_name_action`组成。`pushButton_left_bracket`是改按键的名称，这个名称需要在ui文件中指定，当拖动pushButton的时候，qt会按照12345依次给其一个默认名称，并且上面的默认文字都是pushButton。因此对于声明，可以用宏生成。\n\n```c++\n//mainwindwo.h\n#define clicked_func(name) void on_pushButton_##name##_clicked();\n  clicked_func(0);\n  clicked_func(1);\n  clicked_func(2);\n  clicked_func(3);\n//...\n#define triggered_func(name) void on_action##name##_triggered();\n\n  triggered_func(Author);\n  triggered_func(Save) triggered_func(Read);\n  triggered_func(History_location);\n  triggered_func(Auto_Save);\n```\n\n对于实现，部分直接输入的槽函数也可以用宏生成\n\n```cpp\n//mainwindow.cpp\n#define set_insert_func(name)                         \\\n  void MainWindow::on_pushButton_##name##_clicked() { \\\n    ui->textBrowser_input->setFocus();                \\\n    ui->textBrowser_input->insertPlainText(#name);    \\\n  }\n\nset_insert_func(0);\nset_insert_func(1);\nset_insert_func(2);\nset_insert_func(3);\nset_insert_func(4);\n```\n\n剩下的就只能自己写咯。\n\n## 输入输出框\n\nqt为用户提供了`text Browser`,`text Edit`,`Plain text edit`,`line edit`等组件作为文本框。这里选择了text Browser，目的是屏蔽直接复制粘贴输入，防止非法字符进入。结果后面发现`text Browser`是由`text Edit`继承而来，因此browser也可以提供输入功能（离谱，read Only属性。\n\n所有的输入按键都将在输入框中插入一个对应的字符。这里只需要调用`text Browser`类中自带的public function member：`insertPlainText(QString)`。\n\n*问题*：文本框中的光标只有在选中文本框时才会显示，如果使用鼠标点击按键进行输入，输入框中的光标实际仍然存在但不显示。\n\n- 为了使得光标时刻存在，这里使用了一个简单粗暴的方法，为所有按键功能加上`setFocus()`。从而保证焦点始终在输入框中。\n\n对于输出框，每次显示结果都是更新所有内容（而不是插入），因此需要`setPlainText`。\n\n## 等号\n\n等号按键是计算器最核心的按键，以下为等号按键的槽函数\n\n```c++\n//mainwindow.cpp\nvoid MainWindow::on_pushButton_equal_clicked() {\n  ui->textBrowser_input->setFocus();\n\n  Location::isRead = 0;\n\n  QString s = ui->textBrowser_input->toPlainText();\n  QString rst = parser(s);\n  ui->textBrowser_output->setPlainText(rst);\n  if (Location::autoSave) {\n    save(Location::filePath, s, rst);\n  }\n}\n```\n\n按下等号后，程序首先保证焦点仍然在输入框口上，然后讲是否正在读取历史记录按键设置为0（这讲在后面的历史记录读取中说到），然后获取输入框中的内容，交给由竞赛大佬@龚程昊编写的parser函数进行处理（这将在后面数据处理中说到），然后将parser函数返回的字符串（QString）显示到输出框中，然后在自动保存功能开启的情况下，保存至本地文件中。\n\n## 数据处理\n\n等会儿copy大佬写的东西，大致思路是使用栈和转化为前缀表达式。\n\n但大佬使用的使用的是std库，并且是作为一个单独的cpp程序书写的（方便调试）。因此，这里将源文件复制到parser文件中，并将main函数改写成接受`QString`作为参数，返回`QString`的parser()函数。这里用到了`QString::toStdString`和`QString::fromStdString`。\n\n记录几个当时测试出来的bug：\n\n1. 只写一个数后按等号，直接返回0\n2. 没有考虑负数\n3. 没有考虑溢出\n\n附上代码\n\n```cpp\n//parser.cpp\n#include \"parser.h\"\n\nusing namespace std;\n\nbool pd(char i) {\n  if ((i <= 57 && i >= 48) || (i >= 65 && i <= 70)) return 0;\n  return 1;\n}\n\nint pri(char i)  // priority\n{\n  if (i == '+' || i == '-') return 1;\n  if (i == '*' || i == '/') return 2;\n  if (i == '(') return 0;\n  if (i == ')') return -1;\n  return 255;\n}\nbool judge(char i)  //乱码\n{\n  if ((i <= 57 && i >= 48) || (i >= 65 && i <= 70) || i == '+' || i == '-' ||\n      i == '*' || i == '/' || i == '(' || i == ')') {\n    return 0;\n  }\n  return 1;\n}\n\nQString parser(QString expression) {\n  using namespace std;\n  const int N = 1007;\n  const long R = LONG_MAX;\n  char s[N], stack1[N];\n  long read[N], sta[N], stack2[N], stt[N];\n  bool f[N] = {0}, flag[N] = {0}, ff = 0, fff = 0;\n  string c, sc;\n  string str, as = expression.toStdString();\n  str = \"0+\" + as;\n  int l = str.length();\n  for (int i = 0; i < l; i++) {\n    s[i] = str[i];\n    if (judge(s[i])) {\n      ff = 1;\n    }\n    if (s[i] == '(' && (s[i + 1] == '*' || s[i + 1] == '/')) ff = 1;\n    if (s[i] == ')' && (s[i - 1] == '+' || s[i - 1] == '-' || s[i - 1] == '*' ||\n                        s[i - 1] == '/'))\n      ff = 1;\n  }\n  if (pd(s[l - 1]) && s[l - 1] != ')') ff = 1;\n  int st = 0;\n  for (int i = 0; i < l; i++)  //括号是否匹配\n  {\n    if (s[i] == '(') st++;\n    if (s[i] == ')') st--;\n  }\n  if (st != 0) ff = 1;\n  int j = 0, k = 0, m = 0;\n  while (j < l && ff == 0) {\n    if (!pd(s[j]))  //数字\n    {\n      if (s[j] <= 57 && s[j] >= 48) {\n        sta[k] = s[j] - 48;\n        j++;\n        k++;\n      } else if (s[j] >= 65 && s[j] <= 70) {\n        sta[k] = s[j] - 55;\n        j++;\n        k++;\n      }\n    } else if (pd(s[j]))  //符号\n    {\n      if (!pd(s[j - 1]) && j > 0)  //前面的数字\n      {\n        int cnt = 0;\n        char c = s[j];\n        for (int h = 0; k > 0; h++) {\n          cnt += sta[k - 1] * pow(16, h);\n          k--;\n        }\n        read[m] = cnt;\n        m++;\n        j++;\n        read[m] = c;\n        f[m] = 1;\n        m++;\n\n      } else {  //前面的符号\n        char c = s[j];\n        read[m] = c;\n        f[m] = 1;\n        m++;\n        j++;\n      }\n    }\n  }\n  if (!pd(s[l - 1]))  //数字\n  {\n    if (k > 9) {\n      return \"Detect Overflow\";\n    }\n    int cnt = 0;\n    for (int h = 0; k > 0; h++) {\n      cnt += sta[k - 1] * pow(16, h);\n      if (cnt > R) return \"Detect Overflow\";\n      k--;\n    }\n    read[m] = cnt;\n    m++;\n    j++;\n  }\n  for (int i = 0; i < m - 1; i++) {\n    if (i == 1) {\n      if (f[i] == 1 && f[i + 1] == 1 && pri(read[i]) >= 1 &&\n          pri(read[i + 1]) == 2) {\n        ff = 1;\n      }\n    } else if (f[i] == 1 && f[i + 1] == 1 && pri(read[i]) >= 1 &&\n               pri(read[i + 1]) >= 1) {\n      ff = 1;\n    }\n  }\n  int a = 0, b = 0;  //反缀表达式\n  for (int i = 0; i < m; i++) {\n    if (f[i] == 0) {\n      stack2[a] = read[i];\n      a++;\n    } else if (f[i] == 1) {\n      if (read[i] == '(') {\n        stack1[b] = '(';\n        b++;\n      } else if (pri(read[i]) == 1)  //+-\n      {\n        while (pri(stack1[b - 1]) >= 1 && b > 0) {\n          stack2[a] = stack1[b - 1];\n          flag[a] = 1;\n          b--;\n          a++;\n        }\n        stack1[b] = read[i];\n        b++;\n      } else if (pri(read[i]) == 2)  //*/\n      {\n        while (pri(stack1[b - 1]) == 2 && b > 0) {\n          stack2[a] = stack1[b - 1];\n          flag[a] = 1;\n          b--;\n          a++;\n        }\n        stack1[b] = read[i];\n        b++;\n      } else if (read[i] == ')') {\n        while (stack1[b - 1] != '(') {\n          stack2[a] = stack1[b - 1];\n          flag[a] = 1;\n          b--;\n          a++;\n        }\n        b--;\n      }\n    }\n  }\n  while (b > 0) {\n    stack2[a] = stack1[b - 1];\n    flag[a] = 1;\n    a++;\n    b--;\n  }\n  // calculation\n  int g = 0, cn = 0;\n  for (int i = 0; i < a; i++) {\n    if (!flag[i])  //数字\n    {\n      stt[g] = stack2[i];\n      g++;\n    } else if (flag[i])  //符号\n    {\n      switch (stack2[i]) {\n        case '+':\n          cn = stt[g - 2] + stt[g - 1];\n          if (cn > R) ff = 1;\n          break;\n        case '-':\n          cn = stt[g - 2] - stt[g - 1];\n          if (cn < -R) ff = 1;\n          break;\n        case '*':\n          cn = stt[g - 2] * stt[g - 1];\n          if (cn > R || cn < -R) ff = 1;\n          break;\n        case '/':\n          if (stt[g - 1] != 0) {\n            cn = stt[g - 2] / stt[g - 1];\n            break;\n          } else if (stt[g - 1] == 0) {\n            ff = 1;\n            break;\n          }\n      }\n      g -= 2;\n      stt[g] = cn;\n      g++;\n    }\n  }\n  int x;\n  int cnn = cn;\n  if (cn == 0 && !ff) {\n    //        cout<<str<<\"=\"<<cn<<endl;\n    return \"0\";\n    fff = 1;\n  }\n  while (cn != 0 && !ff)  //转十六进制\n  {\n    if (cn >= 0) {\n      x = cn % 16;\n      if (x < 10)\n        c = x + '0';\n      else\n        c = x + 'A' - 10;\n      sc = c + sc;\n      cn /= 16;\n    } else if (cn <= 0) {\n      x = cn % 16;\n      if (x > -10)\n        c = -x + '0';\n      else\n        c = -x + 'A' - 10;\n      sc = c + sc;\n      cn /= 16;\n    }\n  }\n  if (cnn < 0) {\n    sc = '-' + sc;\n  }\n  if (!ff && !fff) {\n    //        cout<<as<<\"=\";\n    //        cout<<sc<<endl;\n    if (sc == \"-80000000\") {\n      return \"Detect Overflow\";\n    }\n    return QString::fromStdString(sc);\n  }\n  return \"Formula Error\";\n}\n\n```\n\n贴代码的时候才发现大佬写了一个pd（判断）和一个judge（还是判断）。算了算了，能用就行（\n\n## 历史记录\n\n如果只是作为计算器，以上功能就已经可以算完成了。但大多数计算器都是有历史记录功能的，因此这个计算器也该有一个。\n\n这里将历史记录分为底层和顶层两部分来设计，顶层使用Qt框架，而底层使用c的基本库，从而实现更加原子化和方便的操作。\n\n顶层实现的用户接口功能：\n\n- 手动保存当前结果\n- 选择是否自动保存结果\n- 选择保存位置\n- 读取历史记录\n\n底层实现的文本的读写功能\n\n- 获取时间\n- 记录结果\n- 写入和读取\n\n### 底层设计细节\n\n保存功能被设计为，获取当前时间和本次运算的算式和结果，以新行的方式追加到某文件的结尾。保存功能的底层设计都被保存在`saving`文件下。\n\n为此底层使用std库设计了`save()`函数。该函数还调用了`getCurrentTime()`来获取当前时间。当然，这个函数也是由`main()`函数修改而来，由std框架接入了qt框架。源码如下：\n\n```cpp\n//saving.cpp\nstatic string getCurrentTime()  //输出当前时间\n{\n  time_t t = time(0);\n  char ch[64] = {0};\n  strftime(ch, sizeof(ch) - 1, \"%Y-%m-%d %H:%M:%S\", localtime(&t));\n  return ch;\n}\nbool save(QString location, QString fomula, QString data) {\n  string addr = location.toStdString();\n  fstream f;\n  f.open(addr, ios::out | ios::app);\n  f << getCurrentTime() << \" \" << fomula.toStdString() << \"=\"\n    << data.toStdString()\n    << endl;  //变量addr、以及gch的等式和输出结果变量还需加进去\n  f.close();\n  return 1;\n}\n```\n\n除了保存结果外，还需要读取结果，读取结果需要始终从最后一行开始往上读。经历了一系列讨论之后，本项目决定使用读取整个文件来获取所有的行数，并根据行数来获取内容。为此有了`CountLine()`和`readLine()`两个函数：\n\n```cpp\nint CountLines(QString filename) {\n  ifstream f;\n  int n = 0;\n  string tmp;\n  string stdfilename = filename.toStdString();\n  // ios::in 表示以只读的方式读取文件\n  f.open(stdfilename, ios::in);\n  //文件打开失败:返回0\n  if (f.fail()) {\n    return 0;\n  } else {\n    //文件存在\n    while (getline(f, tmp, '\\n')) {\n      n++;\n    }\n    f.close();\n    return n;\n  }\n}\nQString ReadLine(QString filename, int line)  //读取指定行文件\n{\n  // line行数限制 1 - lines\n  if (line > 0 && line <= CountLines(filename)) {\n    ifstream f;\n    string stdfilename = filename.toStdString();\n    f.open(stdfilename, ios::in);\n\n    vector<string> strVec;\n    //行0 - 行lines对应strvect[0] - strvect[lines]\n    while (!f.eof()) {\n      string inbuf;\n      getline(f, inbuf, '\\n');\n      strVec.push_back(inbuf);\n    }\n    return QString::fromStdString(strVec[line - 1]);\n  } else {\n    return NULL;\n  }\n}\n```\n\n读取整个文件并计算行数并不是一个效率高的方式，但在文件不大和不追求高效率的条件下，这是最好的实践方式。因为考虑这里还需要考虑到连续读取历史文件。\n\n当用户按下`UP`按键时，表示用户开始读取历史文件。用户首先查看的应该是历史文件的最后一行，当用户再次按下`UP`时，读取倒数第二行，依次类推。为了实现该功能，这里使用了一个全局变量`line`表示当前正在读取的行数，该行数被初始化为历史记录的总行数。然后再次读取将会`--line`后读取。当用户按下`DOWN`按键时，++line后读取。\n\n这里就要考虑到另一个问题，读取一定历史记录后，用户重新进行计算，然后再次查看历史记录，这样行数应当从新的历史记录最后一行开始计算。为此，这里引入了`isRead`变量，该变量初始化为`0`，表示现在未在读取。首次按下`UP`按键时，该变量置`1`，同时将`line`变量初始化为当前历史记录行数。当用户按下`UP`或`DOWN`按键时，正常修改`line`变量的值并进行读取即可。当用户按下`=`或手动保存时，需要将`isRead`置零。这样下一次按下`UP`时，将重新读取历史文件行数并为`line`赋值。\n\n```cpp\n//mainwindow.cpp\n//等号的槽函数在上面\nvoid MainWindow::on_pushButton_Up_clicked() {\n  ui->textBrowser_input->setFocus();\n  if (Location::isRead) {\n    --Location::line;\n  } else {\n    Location::line = CountLines(Location::filePath);\n    Location::isRead = 1;\n  }\n  ui->textBrowser_output->setText(ReadLine(Location::filePath, Location::line));\n}\nvoid MainWindow::on_pushButton_Down_clicked() {\n  ui->textBrowser_input->setFocus();\n  if (Location::isRead) {\n    ++Location::line;\n  }\n  ui->textBrowser_output->setText(ReadLine(Location::filePath, Location::line));\n}\n```\n\n保存和读取的路径将在`顶层设计细节`中进一步讨论。\n\n### 顶层设计细节\n\n这里在menubar中设置了一个`history location`按键，用于修改历史文件的存放位置。当按下此按键时，程序应当打开一个新的窗口，因此，需要首先在源文件中创建一个新的窗口。右键点击`项目`，选择`add new`，选择`qt设计师类`，然后会分别在三个文件夹中依次得到头文件、源文件、ui设计文件。然后需要在主窗口中设置点击`history location`按键打开新窗口。\n\n```cpp\n//mainwindow.cpp\nvoid MainWindow::on_actionHistory_location_triggered() {\n  Location *new_win = new Location();\n  new_win->show();\n}\n```\n\n**注意**：记得在`mainwindow.h`中include`location.h`，按下打开新窗口实际上就是创建一个新的Location窗口，然后展示。\n\n接下来就是在`location.ui`中修改和设计可视化窗口，此项目使用了栅格布局，在左侧设置了一个较大的`textBrowser`和较小的`lineEdit`（设为不可修改，用于给出提示），在右侧依次设置了`选择文件`，`选择文件夹`，`确定`，`取消` 四个按键。\n\n> 选择文件：调用Qt库，打开系统默认的文件选择框，设置必须选择.txt格式结尾的文件，将返回的结果输出至`textBrowser`。\n>\n> 选择文件夹：同上，但是选择的是文件夹，并且返回的是存在的文件夹的路径，将返回的结果加上`/result.txt`后输入至`textBrowser`。\n>\n> 确定：按下后，读取`textBrowser`中的路径，检查其合法性（因为一开始`textBrowser`设置了可以直接更改，因此可能会输入奇怪的路径），若不合法则在`lineEdit`中给出相应的报错（格式不合法或路径不合法）。若合法，则检查文件是否存在，不存在则创建。当一切都合理以后，将全局变量`filePath`设为文本框中的内容，并关闭`Location`窗口。\n>\n> 取消：直接关闭，不做任何修改。\n\n```cpp\n//location.cpp\nvoid Location::on_pushButton_path_clicked() {\n  QString file_name =\n      QFileDialog::getOpenFileName(NULL, \"选择txt文件\", \".\", \"*.txt\");\n  ui->textEdit->setText(file_name);\n}\n\nvoid Location::on_pushButton_dir_clicked() {\n  QString dir_name = QFileDialog::getExistingDirectory(NULL, \"选择文件夹\", \".\");\n  ui->textEdit->setText(dir_name + \"/result.txt\");\n}\n\nvoid Location::on_pushButton_cancel_clicked() { Location::close(); }\n\nvoid Location::on_pushButton_sure_clicked() {\n  QString new_path = ui->textEdit->toPlainText();\n  QFileInfo info(new_path);\n\n  if (!info.exists()) {\n    if (new_path.contains(\".txt\")) {\n      QFile f(new_path);\n      f.open(QIODevice::WriteOnly);\n      f.close();\n    } else {\n      ui->prompt->setText(\"路径或格式不合法，请重新输入\");\n    }\n  }\n  Location::filePath=new_path;\n  Location::close();\n}\n```\n\n自动保存功能被设计为主窗口中菜单栏中的一个按键，默认为开启状态，显示为`Auto Save On`，当点击该按键后，槽函数将该文本替换为`Auto Save Off`，并将全局变量`autoSave`置零。\n\n`filePath`和`autoSave`以及底层中的`isRead`和`line`都设计为一个全局变量，便于主窗口调用。\n\n```cpp\n//location.h\nclass Location : public QDialog {\n public:\n  static QString filePath;\n  static int line;\n  static bool isRead;\n  static bool autoSave;\n}\n\n//location.cpp\nQString Location::filePath = \"result.txt\";\nint Location::line = 0;\nbool Location::isRead = 0;\nbool Location::autoSave = 1;\n```\n\n在主窗口中，只有用户按下等号（并且自动保存功能开启）或手动保存（在`menubar`中设置了一个保存按键并且设置了快捷键）时，才会保存。因此只需在这些地方加入`save()`函数即可。当然，也要有对`autoSave`的判断。\n\n## 样式设定\n\n前面提到了可以在`ui`文件中直接修改样式，但这种方式并不利于后面的修改，因此我们选择直接调用函数的方式。如要为`centralWidget`设定样式，可以调用`setStyelSheet()`，后接一个QString，该字符串中直接书写qss内容。\n\n这里选择了另一种方式，使用qt的资源文件管理功能来存储单独的qss文件，然后以前缀引用的方式来调用这些文件。\n\n在`项目`中右键新建`qt resource file`，设定名称后打开管理界面，点击添加前缀`add prefix`。然后添加文件`add Files`。前缀决定了调用的方式（将会在源代码中演示）。文件可以新建一个`general file`后添加，也可以将其他方式创建的qss文件加入。\n\n引入的资源可以以`QFile`的方式引用。本项目在菜单栏中添加了一个黑色主题的选项，其槽函数如下\n\n```cpp\nvoid MainWindow::on_actionBlack_theme_triggered() {\n  globalQss = \":/Black.qss\";\n  QFile defaultQss(globalQss);\n  defaultQss.open(QFile::ReadOnly);\n  QString qssContent = defaultQss.readAll();\n  centralWidget()->setStyleSheet(qssContent);\n}\n```\n\n`/`为我设定的前缀，只需以冒号开头，加上前缀和文件，即表明在应用qt指定好的资源文件。接下来就只需打开该文件并读取其内容，然后为需要的组件设定qss样式即可。\n\n**注意**：使用qss的一些麻烦：后面我希望能设定字体的大小、样式等，但这时通过`setFont()`等函数并不起作用。原因估计是qss的优先级很高，直接设定将不起作用。这时我只能再写一个`changeStyle()`函数，通过qss样式表更新来进行样式更新\n\n```cpp\nvoid MainWindow::changeStyle(QString newStyle, QWidget *widget) {\n  QString oldStyle = widget->styleSheet();\n  oldStyle += newStyle;\n  widget->setStyleSheet(oldStyle);\n}\n```\n\n所以这里我只写了改变字体的函数。\n\n```cpp\nvoid MainWindow::on_actionLarge_font_size_triggered() {\n  changeStyle(\"*{font:30px;}\", MainWindow::centralWidget());\n}\n```\n\n## 保存设置\n\n类似于文件的保存位置，是否自动保存等功能，每次重新启动程序后都会按照程序的设定重新初始化。为了使得这些设定能被保存下来，需要使用一个文件将这些配置保存下来。恰好最近见到了许多`ini`格式文件，qt也提供了`QSetting`及配套的`ini`配置文件读写。\n\n配置文件应当在主窗口创建时被读取，在主窗口被销毁时被存入。因此只需在`mainwindow`的构造函数和析构函数中加入读写`ini`文件的步骤即可。需要注意的是，要考虑`ini`文件不存在的情况，不存在时需要使用程序的内置设定。\n\n ```cpp\n MainWindow::MainWindow(QWidget *parent)\n     : QMainWindow(parent), ui(new Ui::MainWindow) {\n   ui->setupUi(this);\n \n   this->grabKeyboard();\n \n   QSettings *iniRead = new QSettings(\"config.ini\", QSettings::IniFormat);\n   QString iniAuto = iniRead->value(\"autoSave\").toString();\n   QString iniPath = iniRead->value(\"filePath\").toString();\n   QString iniQss = iniRead->value(\"globalQss\").toString();\n   delete iniRead;\n \n   // init autoSave\n   if (!iniAuto.isEmpty() && !iniAuto.toInt()) {\n     Location::autoSave = 0;\n     ui->actionAuto_Save->setText(\"Auto Save Off\");\n   }\n \n   // init filePath\n   QFile iniPathFile(iniPath);\n   if (iniPathFile.open(QFile::WriteOnly)) {\n     Location::filePath = iniPath;\n   }\n \n   // init Qss file(theme)\n   QFile iniQssFile(iniQss);\n   QString qssContent;\n   if (iniQssFile.open(QFile::ReadOnly)) {\n     qssContent = iniQssFile.readAll();\n     globalQss = iniQss;\n   } else {\n     QFile defaultQss(\":/Black.qss\");\n     defaultQss.open(QFile::ReadOnly);\n     qssContent = defaultQss.readAll();\n   }\n   centralWidget()->setStyleSheet(qssContent);\n }\n \n MainWindow::~MainWindow() {\n   QSettings *IniWrite = new QSettings(\"config.ini\", QSettings::IniFormat);\n   IniWrite->setValue(\"autoSave\", Location::autoSave);\n   IniWrite->setValue(\"filePath\", Location::filePath);\n   IniWrite->setValue(\"globalQss\", globalQss);\n   delete IniWrite;\n \n   delete ui;\n }\n \n ```\n\n## 其他\n\n- 在主函数中为整个窗口设置了透明度，让它看起来酷炫一点点。\n- 在主函数中为窗口设定名称。\n- 在`.pro`文件中加入图标文件，使得生成的程序有图标\n\n# 感想\n\n## 收获\n\n- 不再害怕qt框架了，反而觉得它好用。\n- qt的窗口类很舒服，有清晰且层次分明的关系，有足够好用的成员函数。\n- qt的基本库也有不少可以讨论的，如QString的设计，不仅提供了基本的可变长度和操作符重载，还考虑到了和std库之间的转换。\n- qt的信号与槽机制是qt最精髓的东西之一，信号是一种非常不错的线程间通信方式，很遗憾我没有手动使用connect函数来创建信号与槽。但确实在写qt的过程中，qtcreator已经为我提供了足够的可视化信号与槽构建工具。\n- qss基本等于css\n- qt以易于制作ui界面出名，但用了之后发现，qt实际上是借鉴了很多现代浏览器（前端）的实现方式。我写的时候感觉自己像是在写js+css。对于一个web项目来说，前端工程师书写html，css，以及利用框架来写js。后端工程师则使用各种工具来构建web服务。但对于qt这样一种前后结合的一体化程序设计框架来说，前后的分离并不彻底（虽然对硬件工程师来说可能会很友好）。\n- 我还是支持“qt是一个平台而不只是一个ui框架”这种说法。qt在基本库中的内容一点也不比它在ui界面中的少。无论是基本库还是ui库，都有很多可以研究的东西。\n- 宏的自动扩展确实好用\n- qt毕竟还是封装的比较高层了，要是需要一些简单的功能，还是老老实实写原生的c和std吧。\n\n## 遗憾\n\n- 大佬说他使用了前缀表达式，求余和翻方功能不好实现，我懂的算法也不多，这两个功能没能实现。只能说算法能力有待提高了。\n","source":"_posts/0xCalculator.md","raw":"---\nauthor: kawhicurry\ntitle: 0xCalculator\ncategories: uncategorized\ndate: 2021-11-28 17:31:31\ntags: cpp\n---\n\n# 功能\n\n1. 对十六进制数进行双目、表达式运算\n2. 对运算结果进行保存和再读取，支持自动保存和手动保存\n3. 自定义运算结果储存位置\n4. 自定义字体大小\n5. 可更换窗口风格（换肤）\n6. 自动保存设置\n\n# 任务分配\n\n1. ：ui设计与qt框架\n2. ：核心算法\n3. ：文件读写\n\n# 开源地址\n<https://github.com/kawhicurry/0xCalculator>\n\n# 开发过程\n\n## Qt框架\n\nqt文件将会以平铺的方式放置在同一工程目录下，其组织结构由`.pro`文件记录，该文件类似于makefile（可以看作是qmakefile？）。其标准目录如下：\n\n> .pro：记录文件\n>\n> /Headers：略\n>\n> /Sources：略\n>\n> /Forms：存放`.ui`文件，实际为`xml`格式，但不建议直接编辑，所有操作应当在设计模块中完成\n>\n> /Resources：存放qt标准资源（可以qt方式引用的资源）\n>\n> /Other files\n\n## UI设计\n\n直接在qt creator的设计界面中打开`设计`模块。从画面左侧拖动组件，摆放至设计框中即可。\n\n*问题*：组件散乱\n\n- 左侧组件库中有`layout`组件,将其拖动至设计框中,再向layout中添加组件，即可使所有组件呈现一定规律。\n\n>布局类型：\n>\n>垂直：略\n>\n>水平：略\n>\n>栅格（grid）：上面俩合起来\n>\n>窗口：？存疑，不是很能理解这是啥\n\n*问题*：使用layout组件后无法布局固定，启动ui界面后拖动窗口改变其大小，layout组件位置不动。\n\n- 应当首先在右侧`对象`框中选中主窗口（mainwindow）中的中间部件（centralwidget），右键选择布局，为整个中间部分设定大的布局，（注：主窗口除了中间部件还初始化了一个菜单栏（menubar）），然后在该布局中嵌套布局或组件。本方案选择了栅格布局，虽然只需垂直布局即可，但为了可拓展性，还是选择栅格。接下来在整个中间部分的栅格布局中，嵌套了一个垂直布局（用于输入和输出）和一个栅格布局（用于存放按键）。\n\n接下来在主窗口中添加所需的组件，分别为输入框、输出框、5*6个按键。然后可以对其属性进行可视化的设计，以下是对`设计`界面中一些工具的解释：\n\n> 右侧下方为属性框，显示了所选定组件的属性，每个组件都是层层继承而来，因此要注意每一层的具体属性以及继承关系。\n>\n> 右侧上方为对象框，显示了当前ui文件中所有文件属性。\n>\n> 正中央下方的框实际上有两个可编辑区域，一个为action editor，即为组件添加动作（可方便设置快捷键）。另一个为信号与槽。\n>\n> 注：信号与槽是最Qt制作ui界面中最重要的机制。\n\n创建槽函数：在信号与槽编辑框中点击加号创建信号与槽，然后选择信号的发送对象、发送信号量、槽、响应函数。此处的创建**只支持内定的槽函数**，想要自定义槽函数，需在右侧对象中找到对象，然后右键选择转到槽，接下来选择信号量之后，Qt会跳转该ui文件对应的cpp文件下，并自动创建一个该槽函数的实现（.h文件中也会自动添加声明）。接下来只需在此槽函数中编写发送信号后（触发信号发送条件），所需只需的步骤即可。\n\n> 信号量是Qt类自带的属性，某个类既有自己的属性，也有继承而来的属性。如pushButton组件继承自QAbstractButton，后者又继承自QWidget，后者又继承自QObject。对于QAbstractButton，其自带的信号有`clicked()`,`pressed()`等，对于QWidget，有`windowIconChanged`等。具体解释请参考官方文档。\n\n`设计`界面支持大量的属性设置，如字体，背景等。并且可以直接在ui界面中即时显示，但并不推荐直接做修改。\n\n一种渲染方式：Qt提供了qss来进行类似css的样式渲染，只需选中对象然后右键改变样式表，修改某个组件的样式表即可。Qss还提供了选择器的功能，因此，只需在某个较大的组件中设置样式表，并对不同的渲染对象进行选择即可。本方案一开始的办法就是在centralwidget组件中设置样式表，完成了酷炫的按键风格。需要注意的是，改变样式表的方法在Qt中是存在一定问题的，并且，**任何写死的方法都可能在以后要修改时造成麻烦**。关于样式表后面还会再进一步设定。\n\n## 模拟按键\n\n一个计算器应当提供一系列的按键，因此要在栅格布局中拖入一定数量的按键。按键分为输入按键和功能按键。\n\n- 输入按键：0123456789ABCDEF+-*/（）\n- 功能按键：<- -> DEL CE UP DOWN =\n\n对于输入按键，按下按键后应当在输入框中显示对应的输入，同时这些按键应当有对应的键盘输入。\n\n对于输出按键，左移和右移是为了移动输入框中的光标。DEL清除一个字符，CE要同时清除输入和输出框。UP和DOWN提供了查看历史功能。等号是整个计算器的核心功能，按下等号后，应当读取输入框中的算式，进行计算后将结果字符串返回至输出框中。\n\n通过在组件上右键选择 转到槽 可以快捷创建槽函数。示例如图：\n\n```c++\n//mainwindow.h\nvoid MainWindow::on_pushButton_left_bracket_clicked();\n//mainwindow.cpp\nvoid MainWindow::on_pushButton_left_bracket_clicked() {\n  ui->textBrowser_input->setFocus();\n  ui->textBrowser_input->insertPlainText(\"(\");\n}\n```\n\n手动创建几个后，就可以发现其规矩。一个槽函数的名称由`on_name_action`组成。`pushButton_left_bracket`是改按键的名称，这个名称需要在ui文件中指定，当拖动pushButton的时候，qt会按照12345依次给其一个默认名称，并且上面的默认文字都是pushButton。因此对于声明，可以用宏生成。\n\n```c++\n//mainwindwo.h\n#define clicked_func(name) void on_pushButton_##name##_clicked();\n  clicked_func(0);\n  clicked_func(1);\n  clicked_func(2);\n  clicked_func(3);\n//...\n#define triggered_func(name) void on_action##name##_triggered();\n\n  triggered_func(Author);\n  triggered_func(Save) triggered_func(Read);\n  triggered_func(History_location);\n  triggered_func(Auto_Save);\n```\n\n对于实现，部分直接输入的槽函数也可以用宏生成\n\n```cpp\n//mainwindow.cpp\n#define set_insert_func(name)                         \\\n  void MainWindow::on_pushButton_##name##_clicked() { \\\n    ui->textBrowser_input->setFocus();                \\\n    ui->textBrowser_input->insertPlainText(#name);    \\\n  }\n\nset_insert_func(0);\nset_insert_func(1);\nset_insert_func(2);\nset_insert_func(3);\nset_insert_func(4);\n```\n\n剩下的就只能自己写咯。\n\n## 输入输出框\n\nqt为用户提供了`text Browser`,`text Edit`,`Plain text edit`,`line edit`等组件作为文本框。这里选择了text Browser，目的是屏蔽直接复制粘贴输入，防止非法字符进入。结果后面发现`text Browser`是由`text Edit`继承而来，因此browser也可以提供输入功能（离谱，read Only属性。\n\n所有的输入按键都将在输入框中插入一个对应的字符。这里只需要调用`text Browser`类中自带的public function member：`insertPlainText(QString)`。\n\n*问题*：文本框中的光标只有在选中文本框时才会显示，如果使用鼠标点击按键进行输入，输入框中的光标实际仍然存在但不显示。\n\n- 为了使得光标时刻存在，这里使用了一个简单粗暴的方法，为所有按键功能加上`setFocus()`。从而保证焦点始终在输入框中。\n\n对于输出框，每次显示结果都是更新所有内容（而不是插入），因此需要`setPlainText`。\n\n## 等号\n\n等号按键是计算器最核心的按键，以下为等号按键的槽函数\n\n```c++\n//mainwindow.cpp\nvoid MainWindow::on_pushButton_equal_clicked() {\n  ui->textBrowser_input->setFocus();\n\n  Location::isRead = 0;\n\n  QString s = ui->textBrowser_input->toPlainText();\n  QString rst = parser(s);\n  ui->textBrowser_output->setPlainText(rst);\n  if (Location::autoSave) {\n    save(Location::filePath, s, rst);\n  }\n}\n```\n\n按下等号后，程序首先保证焦点仍然在输入框口上，然后讲是否正在读取历史记录按键设置为0（这讲在后面的历史记录读取中说到），然后获取输入框中的内容，交给由竞赛大佬@龚程昊编写的parser函数进行处理（这将在后面数据处理中说到），然后将parser函数返回的字符串（QString）显示到输出框中，然后在自动保存功能开启的情况下，保存至本地文件中。\n\n## 数据处理\n\n等会儿copy大佬写的东西，大致思路是使用栈和转化为前缀表达式。\n\n但大佬使用的使用的是std库，并且是作为一个单独的cpp程序书写的（方便调试）。因此，这里将源文件复制到parser文件中，并将main函数改写成接受`QString`作为参数，返回`QString`的parser()函数。这里用到了`QString::toStdString`和`QString::fromStdString`。\n\n记录几个当时测试出来的bug：\n\n1. 只写一个数后按等号，直接返回0\n2. 没有考虑负数\n3. 没有考虑溢出\n\n附上代码\n\n```cpp\n//parser.cpp\n#include \"parser.h\"\n\nusing namespace std;\n\nbool pd(char i) {\n  if ((i <= 57 && i >= 48) || (i >= 65 && i <= 70)) return 0;\n  return 1;\n}\n\nint pri(char i)  // priority\n{\n  if (i == '+' || i == '-') return 1;\n  if (i == '*' || i == '/') return 2;\n  if (i == '(') return 0;\n  if (i == ')') return -1;\n  return 255;\n}\nbool judge(char i)  //乱码\n{\n  if ((i <= 57 && i >= 48) || (i >= 65 && i <= 70) || i == '+' || i == '-' ||\n      i == '*' || i == '/' || i == '(' || i == ')') {\n    return 0;\n  }\n  return 1;\n}\n\nQString parser(QString expression) {\n  using namespace std;\n  const int N = 1007;\n  const long R = LONG_MAX;\n  char s[N], stack1[N];\n  long read[N], sta[N], stack2[N], stt[N];\n  bool f[N] = {0}, flag[N] = {0}, ff = 0, fff = 0;\n  string c, sc;\n  string str, as = expression.toStdString();\n  str = \"0+\" + as;\n  int l = str.length();\n  for (int i = 0; i < l; i++) {\n    s[i] = str[i];\n    if (judge(s[i])) {\n      ff = 1;\n    }\n    if (s[i] == '(' && (s[i + 1] == '*' || s[i + 1] == '/')) ff = 1;\n    if (s[i] == ')' && (s[i - 1] == '+' || s[i - 1] == '-' || s[i - 1] == '*' ||\n                        s[i - 1] == '/'))\n      ff = 1;\n  }\n  if (pd(s[l - 1]) && s[l - 1] != ')') ff = 1;\n  int st = 0;\n  for (int i = 0; i < l; i++)  //括号是否匹配\n  {\n    if (s[i] == '(') st++;\n    if (s[i] == ')') st--;\n  }\n  if (st != 0) ff = 1;\n  int j = 0, k = 0, m = 0;\n  while (j < l && ff == 0) {\n    if (!pd(s[j]))  //数字\n    {\n      if (s[j] <= 57 && s[j] >= 48) {\n        sta[k] = s[j] - 48;\n        j++;\n        k++;\n      } else if (s[j] >= 65 && s[j] <= 70) {\n        sta[k] = s[j] - 55;\n        j++;\n        k++;\n      }\n    } else if (pd(s[j]))  //符号\n    {\n      if (!pd(s[j - 1]) && j > 0)  //前面的数字\n      {\n        int cnt = 0;\n        char c = s[j];\n        for (int h = 0; k > 0; h++) {\n          cnt += sta[k - 1] * pow(16, h);\n          k--;\n        }\n        read[m] = cnt;\n        m++;\n        j++;\n        read[m] = c;\n        f[m] = 1;\n        m++;\n\n      } else {  //前面的符号\n        char c = s[j];\n        read[m] = c;\n        f[m] = 1;\n        m++;\n        j++;\n      }\n    }\n  }\n  if (!pd(s[l - 1]))  //数字\n  {\n    if (k > 9) {\n      return \"Detect Overflow\";\n    }\n    int cnt = 0;\n    for (int h = 0; k > 0; h++) {\n      cnt += sta[k - 1] * pow(16, h);\n      if (cnt > R) return \"Detect Overflow\";\n      k--;\n    }\n    read[m] = cnt;\n    m++;\n    j++;\n  }\n  for (int i = 0; i < m - 1; i++) {\n    if (i == 1) {\n      if (f[i] == 1 && f[i + 1] == 1 && pri(read[i]) >= 1 &&\n          pri(read[i + 1]) == 2) {\n        ff = 1;\n      }\n    } else if (f[i] == 1 && f[i + 1] == 1 && pri(read[i]) >= 1 &&\n               pri(read[i + 1]) >= 1) {\n      ff = 1;\n    }\n  }\n  int a = 0, b = 0;  //反缀表达式\n  for (int i = 0; i < m; i++) {\n    if (f[i] == 0) {\n      stack2[a] = read[i];\n      a++;\n    } else if (f[i] == 1) {\n      if (read[i] == '(') {\n        stack1[b] = '(';\n        b++;\n      } else if (pri(read[i]) == 1)  //+-\n      {\n        while (pri(stack1[b - 1]) >= 1 && b > 0) {\n          stack2[a] = stack1[b - 1];\n          flag[a] = 1;\n          b--;\n          a++;\n        }\n        stack1[b] = read[i];\n        b++;\n      } else if (pri(read[i]) == 2)  //*/\n      {\n        while (pri(stack1[b - 1]) == 2 && b > 0) {\n          stack2[a] = stack1[b - 1];\n          flag[a] = 1;\n          b--;\n          a++;\n        }\n        stack1[b] = read[i];\n        b++;\n      } else if (read[i] == ')') {\n        while (stack1[b - 1] != '(') {\n          stack2[a] = stack1[b - 1];\n          flag[a] = 1;\n          b--;\n          a++;\n        }\n        b--;\n      }\n    }\n  }\n  while (b > 0) {\n    stack2[a] = stack1[b - 1];\n    flag[a] = 1;\n    a++;\n    b--;\n  }\n  // calculation\n  int g = 0, cn = 0;\n  for (int i = 0; i < a; i++) {\n    if (!flag[i])  //数字\n    {\n      stt[g] = stack2[i];\n      g++;\n    } else if (flag[i])  //符号\n    {\n      switch (stack2[i]) {\n        case '+':\n          cn = stt[g - 2] + stt[g - 1];\n          if (cn > R) ff = 1;\n          break;\n        case '-':\n          cn = stt[g - 2] - stt[g - 1];\n          if (cn < -R) ff = 1;\n          break;\n        case '*':\n          cn = stt[g - 2] * stt[g - 1];\n          if (cn > R || cn < -R) ff = 1;\n          break;\n        case '/':\n          if (stt[g - 1] != 0) {\n            cn = stt[g - 2] / stt[g - 1];\n            break;\n          } else if (stt[g - 1] == 0) {\n            ff = 1;\n            break;\n          }\n      }\n      g -= 2;\n      stt[g] = cn;\n      g++;\n    }\n  }\n  int x;\n  int cnn = cn;\n  if (cn == 0 && !ff) {\n    //        cout<<str<<\"=\"<<cn<<endl;\n    return \"0\";\n    fff = 1;\n  }\n  while (cn != 0 && !ff)  //转十六进制\n  {\n    if (cn >= 0) {\n      x = cn % 16;\n      if (x < 10)\n        c = x + '0';\n      else\n        c = x + 'A' - 10;\n      sc = c + sc;\n      cn /= 16;\n    } else if (cn <= 0) {\n      x = cn % 16;\n      if (x > -10)\n        c = -x + '0';\n      else\n        c = -x + 'A' - 10;\n      sc = c + sc;\n      cn /= 16;\n    }\n  }\n  if (cnn < 0) {\n    sc = '-' + sc;\n  }\n  if (!ff && !fff) {\n    //        cout<<as<<\"=\";\n    //        cout<<sc<<endl;\n    if (sc == \"-80000000\") {\n      return \"Detect Overflow\";\n    }\n    return QString::fromStdString(sc);\n  }\n  return \"Formula Error\";\n}\n\n```\n\n贴代码的时候才发现大佬写了一个pd（判断）和一个judge（还是判断）。算了算了，能用就行（\n\n## 历史记录\n\n如果只是作为计算器，以上功能就已经可以算完成了。但大多数计算器都是有历史记录功能的，因此这个计算器也该有一个。\n\n这里将历史记录分为底层和顶层两部分来设计，顶层使用Qt框架，而底层使用c的基本库，从而实现更加原子化和方便的操作。\n\n顶层实现的用户接口功能：\n\n- 手动保存当前结果\n- 选择是否自动保存结果\n- 选择保存位置\n- 读取历史记录\n\n底层实现的文本的读写功能\n\n- 获取时间\n- 记录结果\n- 写入和读取\n\n### 底层设计细节\n\n保存功能被设计为，获取当前时间和本次运算的算式和结果，以新行的方式追加到某文件的结尾。保存功能的底层设计都被保存在`saving`文件下。\n\n为此底层使用std库设计了`save()`函数。该函数还调用了`getCurrentTime()`来获取当前时间。当然，这个函数也是由`main()`函数修改而来，由std框架接入了qt框架。源码如下：\n\n```cpp\n//saving.cpp\nstatic string getCurrentTime()  //输出当前时间\n{\n  time_t t = time(0);\n  char ch[64] = {0};\n  strftime(ch, sizeof(ch) - 1, \"%Y-%m-%d %H:%M:%S\", localtime(&t));\n  return ch;\n}\nbool save(QString location, QString fomula, QString data) {\n  string addr = location.toStdString();\n  fstream f;\n  f.open(addr, ios::out | ios::app);\n  f << getCurrentTime() << \" \" << fomula.toStdString() << \"=\"\n    << data.toStdString()\n    << endl;  //变量addr、以及gch的等式和输出结果变量还需加进去\n  f.close();\n  return 1;\n}\n```\n\n除了保存结果外，还需要读取结果，读取结果需要始终从最后一行开始往上读。经历了一系列讨论之后，本项目决定使用读取整个文件来获取所有的行数，并根据行数来获取内容。为此有了`CountLine()`和`readLine()`两个函数：\n\n```cpp\nint CountLines(QString filename) {\n  ifstream f;\n  int n = 0;\n  string tmp;\n  string stdfilename = filename.toStdString();\n  // ios::in 表示以只读的方式读取文件\n  f.open(stdfilename, ios::in);\n  //文件打开失败:返回0\n  if (f.fail()) {\n    return 0;\n  } else {\n    //文件存在\n    while (getline(f, tmp, '\\n')) {\n      n++;\n    }\n    f.close();\n    return n;\n  }\n}\nQString ReadLine(QString filename, int line)  //读取指定行文件\n{\n  // line行数限制 1 - lines\n  if (line > 0 && line <= CountLines(filename)) {\n    ifstream f;\n    string stdfilename = filename.toStdString();\n    f.open(stdfilename, ios::in);\n\n    vector<string> strVec;\n    //行0 - 行lines对应strvect[0] - strvect[lines]\n    while (!f.eof()) {\n      string inbuf;\n      getline(f, inbuf, '\\n');\n      strVec.push_back(inbuf);\n    }\n    return QString::fromStdString(strVec[line - 1]);\n  } else {\n    return NULL;\n  }\n}\n```\n\n读取整个文件并计算行数并不是一个效率高的方式，但在文件不大和不追求高效率的条件下，这是最好的实践方式。因为考虑这里还需要考虑到连续读取历史文件。\n\n当用户按下`UP`按键时，表示用户开始读取历史文件。用户首先查看的应该是历史文件的最后一行，当用户再次按下`UP`时，读取倒数第二行，依次类推。为了实现该功能，这里使用了一个全局变量`line`表示当前正在读取的行数，该行数被初始化为历史记录的总行数。然后再次读取将会`--line`后读取。当用户按下`DOWN`按键时，++line后读取。\n\n这里就要考虑到另一个问题，读取一定历史记录后，用户重新进行计算，然后再次查看历史记录，这样行数应当从新的历史记录最后一行开始计算。为此，这里引入了`isRead`变量，该变量初始化为`0`，表示现在未在读取。首次按下`UP`按键时，该变量置`1`，同时将`line`变量初始化为当前历史记录行数。当用户按下`UP`或`DOWN`按键时，正常修改`line`变量的值并进行读取即可。当用户按下`=`或手动保存时，需要将`isRead`置零。这样下一次按下`UP`时，将重新读取历史文件行数并为`line`赋值。\n\n```cpp\n//mainwindow.cpp\n//等号的槽函数在上面\nvoid MainWindow::on_pushButton_Up_clicked() {\n  ui->textBrowser_input->setFocus();\n  if (Location::isRead) {\n    --Location::line;\n  } else {\n    Location::line = CountLines(Location::filePath);\n    Location::isRead = 1;\n  }\n  ui->textBrowser_output->setText(ReadLine(Location::filePath, Location::line));\n}\nvoid MainWindow::on_pushButton_Down_clicked() {\n  ui->textBrowser_input->setFocus();\n  if (Location::isRead) {\n    ++Location::line;\n  }\n  ui->textBrowser_output->setText(ReadLine(Location::filePath, Location::line));\n}\n```\n\n保存和读取的路径将在`顶层设计细节`中进一步讨论。\n\n### 顶层设计细节\n\n这里在menubar中设置了一个`history location`按键，用于修改历史文件的存放位置。当按下此按键时，程序应当打开一个新的窗口，因此，需要首先在源文件中创建一个新的窗口。右键点击`项目`，选择`add new`，选择`qt设计师类`，然后会分别在三个文件夹中依次得到头文件、源文件、ui设计文件。然后需要在主窗口中设置点击`history location`按键打开新窗口。\n\n```cpp\n//mainwindow.cpp\nvoid MainWindow::on_actionHistory_location_triggered() {\n  Location *new_win = new Location();\n  new_win->show();\n}\n```\n\n**注意**：记得在`mainwindow.h`中include`location.h`，按下打开新窗口实际上就是创建一个新的Location窗口，然后展示。\n\n接下来就是在`location.ui`中修改和设计可视化窗口，此项目使用了栅格布局，在左侧设置了一个较大的`textBrowser`和较小的`lineEdit`（设为不可修改，用于给出提示），在右侧依次设置了`选择文件`，`选择文件夹`，`确定`，`取消` 四个按键。\n\n> 选择文件：调用Qt库，打开系统默认的文件选择框，设置必须选择.txt格式结尾的文件，将返回的结果输出至`textBrowser`。\n>\n> 选择文件夹：同上，但是选择的是文件夹，并且返回的是存在的文件夹的路径，将返回的结果加上`/result.txt`后输入至`textBrowser`。\n>\n> 确定：按下后，读取`textBrowser`中的路径，检查其合法性（因为一开始`textBrowser`设置了可以直接更改，因此可能会输入奇怪的路径），若不合法则在`lineEdit`中给出相应的报错（格式不合法或路径不合法）。若合法，则检查文件是否存在，不存在则创建。当一切都合理以后，将全局变量`filePath`设为文本框中的内容，并关闭`Location`窗口。\n>\n> 取消：直接关闭，不做任何修改。\n\n```cpp\n//location.cpp\nvoid Location::on_pushButton_path_clicked() {\n  QString file_name =\n      QFileDialog::getOpenFileName(NULL, \"选择txt文件\", \".\", \"*.txt\");\n  ui->textEdit->setText(file_name);\n}\n\nvoid Location::on_pushButton_dir_clicked() {\n  QString dir_name = QFileDialog::getExistingDirectory(NULL, \"选择文件夹\", \".\");\n  ui->textEdit->setText(dir_name + \"/result.txt\");\n}\n\nvoid Location::on_pushButton_cancel_clicked() { Location::close(); }\n\nvoid Location::on_pushButton_sure_clicked() {\n  QString new_path = ui->textEdit->toPlainText();\n  QFileInfo info(new_path);\n\n  if (!info.exists()) {\n    if (new_path.contains(\".txt\")) {\n      QFile f(new_path);\n      f.open(QIODevice::WriteOnly);\n      f.close();\n    } else {\n      ui->prompt->setText(\"路径或格式不合法，请重新输入\");\n    }\n  }\n  Location::filePath=new_path;\n  Location::close();\n}\n```\n\n自动保存功能被设计为主窗口中菜单栏中的一个按键，默认为开启状态，显示为`Auto Save On`，当点击该按键后，槽函数将该文本替换为`Auto Save Off`，并将全局变量`autoSave`置零。\n\n`filePath`和`autoSave`以及底层中的`isRead`和`line`都设计为一个全局变量，便于主窗口调用。\n\n```cpp\n//location.h\nclass Location : public QDialog {\n public:\n  static QString filePath;\n  static int line;\n  static bool isRead;\n  static bool autoSave;\n}\n\n//location.cpp\nQString Location::filePath = \"result.txt\";\nint Location::line = 0;\nbool Location::isRead = 0;\nbool Location::autoSave = 1;\n```\n\n在主窗口中，只有用户按下等号（并且自动保存功能开启）或手动保存（在`menubar`中设置了一个保存按键并且设置了快捷键）时，才会保存。因此只需在这些地方加入`save()`函数即可。当然，也要有对`autoSave`的判断。\n\n## 样式设定\n\n前面提到了可以在`ui`文件中直接修改样式，但这种方式并不利于后面的修改，因此我们选择直接调用函数的方式。如要为`centralWidget`设定样式，可以调用`setStyelSheet()`，后接一个QString，该字符串中直接书写qss内容。\n\n这里选择了另一种方式，使用qt的资源文件管理功能来存储单独的qss文件，然后以前缀引用的方式来调用这些文件。\n\n在`项目`中右键新建`qt resource file`，设定名称后打开管理界面，点击添加前缀`add prefix`。然后添加文件`add Files`。前缀决定了调用的方式（将会在源代码中演示）。文件可以新建一个`general file`后添加，也可以将其他方式创建的qss文件加入。\n\n引入的资源可以以`QFile`的方式引用。本项目在菜单栏中添加了一个黑色主题的选项，其槽函数如下\n\n```cpp\nvoid MainWindow::on_actionBlack_theme_triggered() {\n  globalQss = \":/Black.qss\";\n  QFile defaultQss(globalQss);\n  defaultQss.open(QFile::ReadOnly);\n  QString qssContent = defaultQss.readAll();\n  centralWidget()->setStyleSheet(qssContent);\n}\n```\n\n`/`为我设定的前缀，只需以冒号开头，加上前缀和文件，即表明在应用qt指定好的资源文件。接下来就只需打开该文件并读取其内容，然后为需要的组件设定qss样式即可。\n\n**注意**：使用qss的一些麻烦：后面我希望能设定字体的大小、样式等，但这时通过`setFont()`等函数并不起作用。原因估计是qss的优先级很高，直接设定将不起作用。这时我只能再写一个`changeStyle()`函数，通过qss样式表更新来进行样式更新\n\n```cpp\nvoid MainWindow::changeStyle(QString newStyle, QWidget *widget) {\n  QString oldStyle = widget->styleSheet();\n  oldStyle += newStyle;\n  widget->setStyleSheet(oldStyle);\n}\n```\n\n所以这里我只写了改变字体的函数。\n\n```cpp\nvoid MainWindow::on_actionLarge_font_size_triggered() {\n  changeStyle(\"*{font:30px;}\", MainWindow::centralWidget());\n}\n```\n\n## 保存设置\n\n类似于文件的保存位置，是否自动保存等功能，每次重新启动程序后都会按照程序的设定重新初始化。为了使得这些设定能被保存下来，需要使用一个文件将这些配置保存下来。恰好最近见到了许多`ini`格式文件，qt也提供了`QSetting`及配套的`ini`配置文件读写。\n\n配置文件应当在主窗口创建时被读取，在主窗口被销毁时被存入。因此只需在`mainwindow`的构造函数和析构函数中加入读写`ini`文件的步骤即可。需要注意的是，要考虑`ini`文件不存在的情况，不存在时需要使用程序的内置设定。\n\n ```cpp\n MainWindow::MainWindow(QWidget *parent)\n     : QMainWindow(parent), ui(new Ui::MainWindow) {\n   ui->setupUi(this);\n \n   this->grabKeyboard();\n \n   QSettings *iniRead = new QSettings(\"config.ini\", QSettings::IniFormat);\n   QString iniAuto = iniRead->value(\"autoSave\").toString();\n   QString iniPath = iniRead->value(\"filePath\").toString();\n   QString iniQss = iniRead->value(\"globalQss\").toString();\n   delete iniRead;\n \n   // init autoSave\n   if (!iniAuto.isEmpty() && !iniAuto.toInt()) {\n     Location::autoSave = 0;\n     ui->actionAuto_Save->setText(\"Auto Save Off\");\n   }\n \n   // init filePath\n   QFile iniPathFile(iniPath);\n   if (iniPathFile.open(QFile::WriteOnly)) {\n     Location::filePath = iniPath;\n   }\n \n   // init Qss file(theme)\n   QFile iniQssFile(iniQss);\n   QString qssContent;\n   if (iniQssFile.open(QFile::ReadOnly)) {\n     qssContent = iniQssFile.readAll();\n     globalQss = iniQss;\n   } else {\n     QFile defaultQss(\":/Black.qss\");\n     defaultQss.open(QFile::ReadOnly);\n     qssContent = defaultQss.readAll();\n   }\n   centralWidget()->setStyleSheet(qssContent);\n }\n \n MainWindow::~MainWindow() {\n   QSettings *IniWrite = new QSettings(\"config.ini\", QSettings::IniFormat);\n   IniWrite->setValue(\"autoSave\", Location::autoSave);\n   IniWrite->setValue(\"filePath\", Location::filePath);\n   IniWrite->setValue(\"globalQss\", globalQss);\n   delete IniWrite;\n \n   delete ui;\n }\n \n ```\n\n## 其他\n\n- 在主函数中为整个窗口设置了透明度，让它看起来酷炫一点点。\n- 在主函数中为窗口设定名称。\n- 在`.pro`文件中加入图标文件，使得生成的程序有图标\n\n# 感想\n\n## 收获\n\n- 不再害怕qt框架了，反而觉得它好用。\n- qt的窗口类很舒服，有清晰且层次分明的关系，有足够好用的成员函数。\n- qt的基本库也有不少可以讨论的，如QString的设计，不仅提供了基本的可变长度和操作符重载，还考虑到了和std库之间的转换。\n- qt的信号与槽机制是qt最精髓的东西之一，信号是一种非常不错的线程间通信方式，很遗憾我没有手动使用connect函数来创建信号与槽。但确实在写qt的过程中，qtcreator已经为我提供了足够的可视化信号与槽构建工具。\n- qss基本等于css\n- qt以易于制作ui界面出名，但用了之后发现，qt实际上是借鉴了很多现代浏览器（前端）的实现方式。我写的时候感觉自己像是在写js+css。对于一个web项目来说，前端工程师书写html，css，以及利用框架来写js。后端工程师则使用各种工具来构建web服务。但对于qt这样一种前后结合的一体化程序设计框架来说，前后的分离并不彻底（虽然对硬件工程师来说可能会很友好）。\n- 我还是支持“qt是一个平台而不只是一个ui框架”这种说法。qt在基本库中的内容一点也不比它在ui界面中的少。无论是基本库还是ui库，都有很多可以研究的东西。\n- 宏的自动扩展确实好用\n- qt毕竟还是封装的比较高层了，要是需要一些简单的功能，还是老老实实写原生的c和std吧。\n\n## 遗憾\n\n- 大佬说他使用了前缀表达式，求余和翻方功能不好实现，我懂的算法也不多，这两个功能没能实现。只能说算法能力有待提高了。\n","slug":"0xCalculator","published":1,"updated":"2021-11-28T09:58:04.318Z","_id":"ckwj2h1mc0000xgulb1v1e0xe","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"功能\"><a href=\"#功能\" class=\"headerlink\" title=\"功能\"></a>功能</h1><ol>\n<li>对十六进制数进行双目、表达式运算</li>\n<li>对运算结果进行保存和再读取，支持自动保存和手动保存</li>\n<li>自定义运算结果储存位置</li>\n<li>自定义字体大小</li>\n<li>可更换窗口风格（换肤）</li>\n<li>自动保存设置</li>\n</ol>\n<h1 id=\"任务分配\"><a href=\"#任务分配\" class=\"headerlink\" title=\"任务分配\"></a>任务分配</h1><ol>\n<li>：ui设计与qt框架</li>\n<li>：核心算法</li>\n<li>：文件读写</li>\n</ol>\n<h1 id=\"开源地址\"><a href=\"#开源地址\" class=\"headerlink\" title=\"开源地址\"></a>开源地址</h1><p><a href=\"https://github.com/kawhicurry/0xCalculator\">https://github.com/kawhicurry/0xCalculator</a></p>\n<h1 id=\"开发过程\"><a href=\"#开发过程\" class=\"headerlink\" title=\"开发过程\"></a>开发过程</h1><h2 id=\"Qt框架\"><a href=\"#Qt框架\" class=\"headerlink\" title=\"Qt框架\"></a>Qt框架</h2><p>qt文件将会以平铺的方式放置在同一工程目录下，其组织结构由<code>.pro</code>文件记录，该文件类似于makefile（可以看作是qmakefile？）。其标准目录如下：</p>\n<blockquote>\n<p>.pro：记录文件</p>\n<p>/Headers：略</p>\n<p>/Sources：略</p>\n<p>/Forms：存放<code>.ui</code>文件，实际为<code>xml</code>格式，但不建议直接编辑，所有操作应当在设计模块中完成</p>\n<p>/Resources：存放qt标准资源（可以qt方式引用的资源）</p>\n<p>/Other files</p>\n</blockquote>\n<h2 id=\"UI设计\"><a href=\"#UI设计\" class=\"headerlink\" title=\"UI设计\"></a>UI设计</h2><p>直接在qt creator的设计界面中打开<code>设计</code>模块。从画面左侧拖动组件，摆放至设计框中即可。</p>\n<p><em>问题</em>：组件散乱</p>\n<ul>\n<li>左侧组件库中有<code>layout</code>组件,将其拖动至设计框中,再向layout中添加组件，即可使所有组件呈现一定规律。</li>\n</ul>\n<blockquote>\n<p>布局类型：</p>\n<p>垂直：略</p>\n<p>水平：略</p>\n<p>栅格（grid）：上面俩合起来</p>\n<p>窗口：？存疑，不是很能理解这是啥</p>\n</blockquote>\n<p><em>问题</em>：使用layout组件后无法布局固定，启动ui界面后拖动窗口改变其大小，layout组件位置不动。</p>\n<ul>\n<li>应当首先在右侧<code>对象</code>框中选中主窗口（mainwindow）中的中间部件（centralwidget），右键选择布局，为整个中间部分设定大的布局，（注：主窗口除了中间部件还初始化了一个菜单栏（menubar）），然后在该布局中嵌套布局或组件。本方案选择了栅格布局，虽然只需垂直布局即可，但为了可拓展性，还是选择栅格。接下来在整个中间部分的栅格布局中，嵌套了一个垂直布局（用于输入和输出）和一个栅格布局（用于存放按键）。</li>\n</ul>\n<p>接下来在主窗口中添加所需的组件，分别为输入框、输出框、5*6个按键。然后可以对其属性进行可视化的设计，以下是对<code>设计</code>界面中一些工具的解释：</p>\n<blockquote>\n<p>右侧下方为属性框，显示了所选定组件的属性，每个组件都是层层继承而来，因此要注意每一层的具体属性以及继承关系。</p>\n<p>右侧上方为对象框，显示了当前ui文件中所有文件属性。</p>\n<p>正中央下方的框实际上有两个可编辑区域，一个为action editor，即为组件添加动作（可方便设置快捷键）。另一个为信号与槽。</p>\n<p>注：信号与槽是最Qt制作ui界面中最重要的机制。</p>\n</blockquote>\n<p>创建槽函数：在信号与槽编辑框中点击加号创建信号与槽，然后选择信号的发送对象、发送信号量、槽、响应函数。此处的创建<strong>只支持内定的槽函数</strong>，想要自定义槽函数，需在右侧对象中找到对象，然后右键选择转到槽，接下来选择信号量之后，Qt会跳转该ui文件对应的cpp文件下，并自动创建一个该槽函数的实现（.h文件中也会自动添加声明）。接下来只需在此槽函数中编写发送信号后（触发信号发送条件），所需只需的步骤即可。</p>\n<blockquote>\n<p>信号量是Qt类自带的属性，某个类既有自己的属性，也有继承而来的属性。如pushButton组件继承自QAbstractButton，后者又继承自QWidget，后者又继承自QObject。对于QAbstractButton，其自带的信号有<code>clicked()</code>,<code>pressed()</code>等，对于QWidget，有<code>windowIconChanged</code>等。具体解释请参考官方文档。</p>\n</blockquote>\n<p><code>设计</code>界面支持大量的属性设置，如字体，背景等。并且可以直接在ui界面中即时显示，但并不推荐直接做修改。</p>\n<p>一种渲染方式：Qt提供了qss来进行类似css的样式渲染，只需选中对象然后右键改变样式表，修改某个组件的样式表即可。Qss还提供了选择器的功能，因此，只需在某个较大的组件中设置样式表，并对不同的渲染对象进行选择即可。本方案一开始的办法就是在centralwidget组件中设置样式表，完成了酷炫的按键风格。需要注意的是，改变样式表的方法在Qt中是存在一定问题的，并且，<strong>任何写死的方法都可能在以后要修改时造成麻烦</strong>。关于样式表后面还会再进一步设定。</p>\n<h2 id=\"模拟按键\"><a href=\"#模拟按键\" class=\"headerlink\" title=\"模拟按键\"></a>模拟按键</h2><p>一个计算器应当提供一系列的按键，因此要在栅格布局中拖入一定数量的按键。按键分为输入按键和功能按键。</p>\n<ul>\n<li>输入按键：0123456789ABCDEF+-*/（）</li>\n<li>功能按键：&lt;- -&gt; DEL CE UP DOWN =</li>\n</ul>\n<p>对于输入按键，按下按键后应当在输入框中显示对应的输入，同时这些按键应当有对应的键盘输入。</p>\n<p>对于输出按键，左移和右移是为了移动输入框中的光标。DEL清除一个字符，CE要同时清除输入和输出框。UP和DOWN提供了查看历史功能。等号是整个计算器的核心功能，按下等号后，应当读取输入框中的算式，进行计算后将结果字符串返回至输出框中。</p>\n<p>通过在组件上右键选择 转到槽 可以快捷创建槽函数。示例如图：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//mainwindow.h</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MainWindow::on_pushButton_left_bracket_clicked</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"><span class=\"comment\">//mainwindow.cpp</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MainWindow::on_pushButton_left_bracket_clicked</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  ui-&gt;textBrowser_input-&gt;<span class=\"built_in\">setFocus</span>();</span><br><span class=\"line\">  ui-&gt;textBrowser_input-&gt;<span class=\"built_in\">insertPlainText</span>(<span class=\"string\">&quot;(&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>手动创建几个后，就可以发现其规矩。一个槽函数的名称由<code>on_name_action</code>组成。<code>pushButton_left_bracket</code>是改按键的名称，这个名称需要在ui文件中指定，当拖动pushButton的时候，qt会按照12345依次给其一个默认名称，并且上面的默认文字都是pushButton。因此对于声明，可以用宏生成。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//mainwindwo.h</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clicked_func(name) void on_pushButton_##name##_clicked();</span></span><br><span class=\"line\">  <span class=\"built_in\">clicked_func</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">  <span class=\"built_in\">clicked_func</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"built_in\">clicked_func</span>(<span class=\"number\">2</span>);</span><br><span class=\"line\">  <span class=\"built_in\">clicked_func</span>(<span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"comment\">//...</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> triggered_func(name) void on_action##name##_triggered();</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">triggered_func</span>(Author);</span><br><span class=\"line\">  <span class=\"built_in\">triggered_func</span>(Save) <span class=\"built_in\">triggered_func</span>(Read);</span><br><span class=\"line\">  <span class=\"built_in\">triggered_func</span>(History_location);</span><br><span class=\"line\">  <span class=\"built_in\">triggered_func</span>(Auto_Save);</span><br></pre></td></tr></table></figure>\n\n<p>对于实现，部分直接输入的槽函数也可以用宏生成</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//mainwindow.cpp</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> set_insert_func(name)                         \\</span></span><br><span class=\"line\"><span class=\"meta\">  void MainWindow::on_pushButton_##name##_clicked() &#123; \\</span></span><br><span class=\"line\"><span class=\"meta\">    ui-&gt;textBrowser_input-&gt;setFocus();                \\</span></span><br><span class=\"line\"><span class=\"meta\">    ui-&gt;textBrowser_input-&gt;insertPlainText(#name);    \\</span></span><br><span class=\"line\"><span class=\"meta\">  &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">set_insert_func</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"built_in\">set_insert_func</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"built_in\">set_insert_func</span>(<span class=\"number\">2</span>);</span><br><span class=\"line\"><span class=\"built_in\">set_insert_func</span>(<span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"built_in\">set_insert_func</span>(<span class=\"number\">4</span>);</span><br></pre></td></tr></table></figure>\n\n<p>剩下的就只能自己写咯。</p>\n<h2 id=\"输入输出框\"><a href=\"#输入输出框\" class=\"headerlink\" title=\"输入输出框\"></a>输入输出框</h2><p>qt为用户提供了<code>text Browser</code>,<code>text Edit</code>,<code>Plain text edit</code>,<code>line edit</code>等组件作为文本框。这里选择了text Browser，目的是屏蔽直接复制粘贴输入，防止非法字符进入。结果后面发现<code>text Browser</code>是由<code>text Edit</code>继承而来，因此browser也可以提供输入功能（离谱，read Only属性。</p>\n<p>所有的输入按键都将在输入框中插入一个对应的字符。这里只需要调用<code>text Browser</code>类中自带的public function member：<code>insertPlainText(QString)</code>。</p>\n<p><em>问题</em>：文本框中的光标只有在选中文本框时才会显示，如果使用鼠标点击按键进行输入，输入框中的光标实际仍然存在但不显示。</p>\n<ul>\n<li>为了使得光标时刻存在，这里使用了一个简单粗暴的方法，为所有按键功能加上<code>setFocus()</code>。从而保证焦点始终在输入框中。</li>\n</ul>\n<p>对于输出框，每次显示结果都是更新所有内容（而不是插入），因此需要<code>setPlainText</code>。</p>\n<h2 id=\"等号\"><a href=\"#等号\" class=\"headerlink\" title=\"等号\"></a>等号</h2><p>等号按键是计算器最核心的按键，以下为等号按键的槽函数</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//mainwindow.cpp</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MainWindow::on_pushButton_equal_clicked</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  ui-&gt;textBrowser_input-&gt;<span class=\"built_in\">setFocus</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">  Location::isRead = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  QString s = ui-&gt;textBrowser_input-&gt;<span class=\"built_in\">toPlainText</span>();</span><br><span class=\"line\">  QString rst = <span class=\"built_in\">parser</span>(s);</span><br><span class=\"line\">  ui-&gt;textBrowser_output-&gt;<span class=\"built_in\">setPlainText</span>(rst);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (Location::autoSave) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">save</span>(Location::filePath, s, rst);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>按下等号后，程序首先保证焦点仍然在输入框口上，然后讲是否正在读取历史记录按键设置为0（这讲在后面的历史记录读取中说到），然后获取输入框中的内容，交给由竞赛大佬@龚程昊编写的parser函数进行处理（这将在后面数据处理中说到），然后将parser函数返回的字符串（QString）显示到输出框中，然后在自动保存功能开启的情况下，保存至本地文件中。</p>\n<h2 id=\"数据处理\"><a href=\"#数据处理\" class=\"headerlink\" title=\"数据处理\"></a>数据处理</h2><p>等会儿copy大佬写的东西，大致思路是使用栈和转化为前缀表达式。</p>\n<p>但大佬使用的使用的是std库，并且是作为一个单独的cpp程序书写的（方便调试）。因此，这里将源文件复制到parser文件中，并将main函数改写成接受<code>QString</code>作为参数，返回<code>QString</code>的parser()函数。这里用到了<code>QString::toStdString</code>和<code>QString::fromStdString</code>。</p>\n<p>记录几个当时测试出来的bug：</p>\n<ol>\n<li>只写一个数后按等号，直接返回0</li>\n<li>没有考虑负数</li>\n<li>没有考虑溢出</li>\n</ol>\n<p>附上代码</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//parser.cpp</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;parser.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">pd</span><span class=\"params\">(<span class=\"keyword\">char</span> i)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> ((i &lt;= <span class=\"number\">57</span> &amp;&amp; i &gt;= <span class=\"number\">48</span>) || (i &gt;= <span class=\"number\">65</span> &amp;&amp; i &lt;= <span class=\"number\">70</span>)) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">pri</span><span class=\"params\">(<span class=\"keyword\">char</span> i)</span>  <span class=\"comment\">// priority</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (i == <span class=\"string\">&#x27;+&#x27;</span> || i == <span class=\"string\">&#x27;-&#x27;</span>) <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (i == <span class=\"string\">&#x27;*&#x27;</span> || i == <span class=\"string\">&#x27;/&#x27;</span>) <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (i == <span class=\"string\">&#x27;(&#x27;</span>) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (i == <span class=\"string\">&#x27;)&#x27;</span>) <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">255</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">judge</span><span class=\"params\">(<span class=\"keyword\">char</span> i)</span>  <span class=\"comment\">//乱码</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> ((i &lt;= <span class=\"number\">57</span> &amp;&amp; i &gt;= <span class=\"number\">48</span>) || (i &gt;= <span class=\"number\">65</span> &amp;&amp; i &lt;= <span class=\"number\">70</span>) || i == <span class=\"string\">&#x27;+&#x27;</span> || i == <span class=\"string\">&#x27;-&#x27;</span> ||</span><br><span class=\"line\">      i == <span class=\"string\">&#x27;*&#x27;</span> || i == <span class=\"string\">&#x27;/&#x27;</span> || i == <span class=\"string\">&#x27;(&#x27;</span> || i == <span class=\"string\">&#x27;)&#x27;</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">QString <span class=\"title\">parser</span><span class=\"params\">(QString expression)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> <span class=\"keyword\">int</span> N = <span class=\"number\">1007</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> <span class=\"keyword\">long</span> R = LONG_MAX;</span><br><span class=\"line\">  <span class=\"keyword\">char</span> s[N], stack1[N];</span><br><span class=\"line\">  <span class=\"keyword\">long</span> read[N], sta[N], stack2[N], stt[N];</span><br><span class=\"line\">  <span class=\"keyword\">bool</span> f[N] = &#123;<span class=\"number\">0</span>&#125;, flag[N] = &#123;<span class=\"number\">0</span>&#125;, ff = <span class=\"number\">0</span>, fff = <span class=\"number\">0</span>;</span><br><span class=\"line\">  string c, sc;</span><br><span class=\"line\">  string str, as = expression.<span class=\"built_in\">toStdString</span>();</span><br><span class=\"line\">  str = <span class=\"string\">&quot;0+&quot;</span> + as;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> l = str.<span class=\"built_in\">length</span>();</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; l; i++) &#123;</span><br><span class=\"line\">    s[i] = str[i];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">judge</span>(s[i])) &#123;</span><br><span class=\"line\">      ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (s[i] == <span class=\"string\">&#x27;(&#x27;</span> &amp;&amp; (s[i + <span class=\"number\">1</span>] == <span class=\"string\">&#x27;*&#x27;</span> || s[i + <span class=\"number\">1</span>] == <span class=\"string\">&#x27;/&#x27;</span>)) ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (s[i] == <span class=\"string\">&#x27;)&#x27;</span> &amp;&amp; (s[i - <span class=\"number\">1</span>] == <span class=\"string\">&#x27;+&#x27;</span> || s[i - <span class=\"number\">1</span>] == <span class=\"string\">&#x27;-&#x27;</span> || s[i - <span class=\"number\">1</span>] == <span class=\"string\">&#x27;*&#x27;</span> ||</span><br><span class=\"line\">                        s[i - <span class=\"number\">1</span>] == <span class=\"string\">&#x27;/&#x27;</span>))</span><br><span class=\"line\">      ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">pd</span>(s[l - <span class=\"number\">1</span>]) &amp;&amp; s[l - <span class=\"number\">1</span>] != <span class=\"string\">&#x27;)&#x27;</span>) ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> st = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; l; i++)  <span class=\"comment\">//括号是否匹配</span></span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (s[i] == <span class=\"string\">&#x27;(&#x27;</span>) st++;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (s[i] == <span class=\"string\">&#x27;)&#x27;</span>) st--;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (st != <span class=\"number\">0</span>) ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> j = <span class=\"number\">0</span>, k = <span class=\"number\">0</span>, m = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">while</span> (j &lt; l &amp;&amp; ff == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"built_in\">pd</span>(s[j]))  <span class=\"comment\">//数字</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (s[j] &lt;= <span class=\"number\">57</span> &amp;&amp; s[j] &gt;= <span class=\"number\">48</span>) &#123;</span><br><span class=\"line\">        sta[k] = s[j] - <span class=\"number\">48</span>;</span><br><span class=\"line\">        j++;</span><br><span class=\"line\">        k++;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (s[j] &gt;= <span class=\"number\">65</span> &amp;&amp; s[j] &lt;= <span class=\"number\">70</span>) &#123;</span><br><span class=\"line\">        sta[k] = s[j] - <span class=\"number\">55</span>;</span><br><span class=\"line\">        j++;</span><br><span class=\"line\">        k++;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">pd</span>(s[j]))  <span class=\"comment\">//符号</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!<span class=\"built_in\">pd</span>(s[j - <span class=\"number\">1</span>]) &amp;&amp; j &gt; <span class=\"number\">0</span>)  <span class=\"comment\">//前面的数字</span></span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> cnt = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">char</span> c = s[j];</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> h = <span class=\"number\">0</span>; k &gt; <span class=\"number\">0</span>; h++) &#123;</span><br><span class=\"line\">          cnt += sta[k - <span class=\"number\">1</span>] * <span class=\"built_in\">pow</span>(<span class=\"number\">16</span>, h);</span><br><span class=\"line\">          k--;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        read[m] = cnt;</span><br><span class=\"line\">        m++;</span><br><span class=\"line\">        j++;</span><br><span class=\"line\">        read[m] = c;</span><br><span class=\"line\">        f[m] = <span class=\"number\">1</span>;</span><br><span class=\"line\">        m++;</span><br><span class=\"line\"></span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;  <span class=\"comment\">//前面的符号</span></span><br><span class=\"line\">        <span class=\"keyword\">char</span> c = s[j];</span><br><span class=\"line\">        read[m] = c;</span><br><span class=\"line\">        f[m] = <span class=\"number\">1</span>;</span><br><span class=\"line\">        m++;</span><br><span class=\"line\">        j++;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!<span class=\"built_in\">pd</span>(s[l - <span class=\"number\">1</span>]))  <span class=\"comment\">//数字</span></span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (k &gt; <span class=\"number\">9</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&quot;Detect Overflow&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> cnt = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> h = <span class=\"number\">0</span>; k &gt; <span class=\"number\">0</span>; h++) &#123;</span><br><span class=\"line\">      cnt += sta[k - <span class=\"number\">1</span>] * <span class=\"built_in\">pow</span>(<span class=\"number\">16</span>, h);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (cnt &gt; R) <span class=\"keyword\">return</span> <span class=\"string\">&quot;Detect Overflow&quot;</span>;</span><br><span class=\"line\">      k--;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    read[m] = cnt;</span><br><span class=\"line\">    m++;</span><br><span class=\"line\">    j++;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; m - <span class=\"number\">1</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (i == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (f[i] == <span class=\"number\">1</span> &amp;&amp; f[i + <span class=\"number\">1</span>] == <span class=\"number\">1</span> &amp;&amp; <span class=\"built_in\">pri</span>(read[i]) &gt;= <span class=\"number\">1</span> &amp;&amp;</span><br><span class=\"line\">          <span class=\"built_in\">pri</span>(read[i + <span class=\"number\">1</span>]) == <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f[i] == <span class=\"number\">1</span> &amp;&amp; f[i + <span class=\"number\">1</span>] == <span class=\"number\">1</span> &amp;&amp; <span class=\"built_in\">pri</span>(read[i]) &gt;= <span class=\"number\">1</span> &amp;&amp;</span><br><span class=\"line\">               <span class=\"built_in\">pri</span>(read[i + <span class=\"number\">1</span>]) &gt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> a = <span class=\"number\">0</span>, b = <span class=\"number\">0</span>;  <span class=\"comment\">//反缀表达式</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; m; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (f[i] == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      stack2[a] = read[i];</span><br><span class=\"line\">      a++;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f[i] == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (read[i] == <span class=\"string\">&#x27;(&#x27;</span>) &#123;</span><br><span class=\"line\">        stack1[b] = <span class=\"string\">&#x27;(&#x27;</span>;</span><br><span class=\"line\">        b++;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">pri</span>(read[i]) == <span class=\"number\">1</span>)  <span class=\"comment\">//+-</span></span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"built_in\">pri</span>(stack1[b - <span class=\"number\">1</span>]) &gt;= <span class=\"number\">1</span> &amp;&amp; b &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          stack2[a] = stack1[b - <span class=\"number\">1</span>];</span><br><span class=\"line\">          flag[a] = <span class=\"number\">1</span>;</span><br><span class=\"line\">          b--;</span><br><span class=\"line\">          a++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        stack1[b] = read[i];</span><br><span class=\"line\">        b++;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">pri</span>(read[i]) == <span class=\"number\">2</span>)  <span class=\"comment\">//*/</span></span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"built_in\">pri</span>(stack1[b - <span class=\"number\">1</span>]) == <span class=\"number\">2</span> &amp;&amp; b &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          stack2[a] = stack1[b - <span class=\"number\">1</span>];</span><br><span class=\"line\">          flag[a] = <span class=\"number\">1</span>;</span><br><span class=\"line\">          b--;</span><br><span class=\"line\">          a++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        stack1[b] = read[i];</span><br><span class=\"line\">        b++;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (read[i] == <span class=\"string\">&#x27;)&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (stack1[b - <span class=\"number\">1</span>] != <span class=\"string\">&#x27;(&#x27;</span>) &#123;</span><br><span class=\"line\">          stack2[a] = stack1[b - <span class=\"number\">1</span>];</span><br><span class=\"line\">          flag[a] = <span class=\"number\">1</span>;</span><br><span class=\"line\">          b--;</span><br><span class=\"line\">          a++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        b--;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">while</span> (b &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    stack2[a] = stack1[b - <span class=\"number\">1</span>];</span><br><span class=\"line\">    flag[a] = <span class=\"number\">1</span>;</span><br><span class=\"line\">    a++;</span><br><span class=\"line\">    b--;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// calculation</span></span><br><span class=\"line\">  <span class=\"keyword\">int</span> g = <span class=\"number\">0</span>, cn = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; a; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!flag[i])  <span class=\"comment\">//数字</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      stt[g] = stack2[i];</span><br><span class=\"line\">      g++;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (flag[i])  <span class=\"comment\">//符号</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"built_in\"><span class=\"keyword\">switch</span></span> (stack2[i]) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&#x27;+&#x27;</span>:</span><br><span class=\"line\">          cn = stt[g - <span class=\"number\">2</span>] + stt[g - <span class=\"number\">1</span>];</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (cn &gt; R) ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&#x27;-&#x27;</span>:</span><br><span class=\"line\">          cn = stt[g - <span class=\"number\">2</span>] - stt[g - <span class=\"number\">1</span>];</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (cn &lt; -R) ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&#x27;*&#x27;</span>:</span><br><span class=\"line\">          cn = stt[g - <span class=\"number\">2</span>] * stt[g - <span class=\"number\">1</span>];</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (cn &gt; R || cn &lt; -R) ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&#x27;/&#x27;</span>:</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (stt[g - <span class=\"number\">1</span>] != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            cn = stt[g - <span class=\"number\">2</span>] / stt[g - <span class=\"number\">1</span>];</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (stt[g - <span class=\"number\">1</span>] == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      g -= <span class=\"number\">2</span>;</span><br><span class=\"line\">      stt[g] = cn;</span><br><span class=\"line\">      g++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> x;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> cnn = cn;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (cn == <span class=\"number\">0</span> &amp;&amp; !ff) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//        cout&lt;&lt;str&lt;&lt;&quot;=&quot;&lt;&lt;cn&lt;&lt;endl;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;0&quot;</span>;</span><br><span class=\"line\">    fff = <span class=\"number\">1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">while</span> (cn != <span class=\"number\">0</span> &amp;&amp; !ff)  <span class=\"comment\">//转十六进制</span></span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cn &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      x = cn % <span class=\"number\">16</span>;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (x &lt; <span class=\"number\">10</span>)</span><br><span class=\"line\">        c = x + <span class=\"string\">&#x27;0&#x27;</span>;</span><br><span class=\"line\">      <span class=\"keyword\">else</span></span><br><span class=\"line\">        c = x + <span class=\"string\">&#x27;A&#x27;</span> - <span class=\"number\">10</span>;</span><br><span class=\"line\">      sc = c + sc;</span><br><span class=\"line\">      cn /= <span class=\"number\">16</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (cn &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      x = cn % <span class=\"number\">16</span>;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (x &gt; <span class=\"number\">-10</span>)</span><br><span class=\"line\">        c = -x + <span class=\"string\">&#x27;0&#x27;</span>;</span><br><span class=\"line\">      <span class=\"keyword\">else</span></span><br><span class=\"line\">        c = -x + <span class=\"string\">&#x27;A&#x27;</span> - <span class=\"number\">10</span>;</span><br><span class=\"line\">      sc = c + sc;</span><br><span class=\"line\">      cn /= <span class=\"number\">16</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (cnn &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    sc = <span class=\"string\">&#x27;-&#x27;</span> + sc;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!ff &amp;&amp; !fff) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//        cout&lt;&lt;as&lt;&lt;&quot;=&quot;;</span></span><br><span class=\"line\">    <span class=\"comment\">//        cout&lt;&lt;sc&lt;&lt;endl;</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (sc == <span class=\"string\">&quot;-80000000&quot;</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&quot;Detect Overflow&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> QString::<span class=\"built_in\">fromStdString</span>(sc);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&quot;Formula Error&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>贴代码的时候才发现大佬写了一个pd（判断）和一个judge（还是判断）。算了算了，能用就行（</p>\n<h2 id=\"历史记录\"><a href=\"#历史记录\" class=\"headerlink\" title=\"历史记录\"></a>历史记录</h2><p>如果只是作为计算器，以上功能就已经可以算完成了。但大多数计算器都是有历史记录功能的，因此这个计算器也该有一个。</p>\n<p>这里将历史记录分为底层和顶层两部分来设计，顶层使用Qt框架，而底层使用c的基本库，从而实现更加原子化和方便的操作。</p>\n<p>顶层实现的用户接口功能：</p>\n<ul>\n<li>手动保存当前结果</li>\n<li>选择是否自动保存结果</li>\n<li>选择保存位置</li>\n<li>读取历史记录</li>\n</ul>\n<p>底层实现的文本的读写功能</p>\n<ul>\n<li>获取时间</li>\n<li>记录结果</li>\n<li>写入和读取</li>\n</ul>\n<h3 id=\"底层设计细节\"><a href=\"#底层设计细节\" class=\"headerlink\" title=\"底层设计细节\"></a>底层设计细节</h3><p>保存功能被设计为，获取当前时间和本次运算的算式和结果，以新行的方式追加到某文件的结尾。保存功能的底层设计都被保存在<code>saving</code>文件下。</p>\n<p>为此底层使用std库设计了<code>save()</code>函数。该函数还调用了<code>getCurrentTime()</code>来获取当前时间。当然，这个函数也是由<code>main()</code>函数修改而来，由std框架接入了qt框架。源码如下：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//saving.cpp</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> string <span class=\"title\">getCurrentTime</span><span class=\"params\">()</span>  <span class=\"comment\">//输出当前时间</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">time_t</span> t = <span class=\"built_in\">time</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">  <span class=\"keyword\">char</span> ch[<span class=\"number\">64</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">  <span class=\"built_in\">strftime</span>(ch, <span class=\"built_in\"><span class=\"keyword\">sizeof</span></span>(ch) - <span class=\"number\">1</span>, <span class=\"string\">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, <span class=\"built_in\">localtime</span>(&amp;t));</span><br><span class=\"line\">  <span class=\"keyword\">return</span> ch;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">save</span><span class=\"params\">(QString location, QString fomula, QString data)</span> </span>&#123;</span><br><span class=\"line\">  string addr = location.<span class=\"built_in\">toStdString</span>();</span><br><span class=\"line\">  fstream f;</span><br><span class=\"line\">  f.<span class=\"built_in\">open</span>(addr, ios::out | ios::app);</span><br><span class=\"line\">  f &lt;&lt; <span class=\"built_in\">getCurrentTime</span>() &lt;&lt; <span class=\"string\">&quot; &quot;</span> &lt;&lt; fomula.<span class=\"built_in\">toStdString</span>() &lt;&lt; <span class=\"string\">&quot;=&quot;</span></span><br><span class=\"line\">    &lt;&lt; data.<span class=\"built_in\">toStdString</span>()</span><br><span class=\"line\">    &lt;&lt; endl;  <span class=\"comment\">//变量addr、以及gch的等式和输出结果变量还需加进去</span></span><br><span class=\"line\">  f.<span class=\"built_in\">close</span>();</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>除了保存结果外，还需要读取结果，读取结果需要始终从最后一行开始往上读。经历了一系列讨论之后，本项目决定使用读取整个文件来获取所有的行数，并根据行数来获取内容。为此有了<code>CountLine()</code>和<code>readLine()</code>两个函数：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">CountLines</span><span class=\"params\">(QString filename)</span> </span>&#123;</span><br><span class=\"line\">  ifstream f;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> n = <span class=\"number\">0</span>;</span><br><span class=\"line\">  string tmp;</span><br><span class=\"line\">  string stdfilename = filename.<span class=\"built_in\">toStdString</span>();</span><br><span class=\"line\">  <span class=\"comment\">// ios::in 表示以只读的方式读取文件</span></span><br><span class=\"line\">  f.<span class=\"built_in\">open</span>(stdfilename, ios::in);</span><br><span class=\"line\">  <span class=\"comment\">//文件打开失败:返回0</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (f.<span class=\"built_in\">fail</span>()) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//文件存在</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"built_in\">getline</span>(f, tmp, <span class=\"string\">&#x27;\\n&#x27;</span>)) &#123;</span><br><span class=\"line\">      n++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    f.<span class=\"built_in\">close</span>();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> n;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\">QString <span class=\"title\">ReadLine</span><span class=\"params\">(QString filename, <span class=\"keyword\">int</span> line)</span>  <span class=\"comment\">//读取指定行文件</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// line行数限制 1 - lines</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (line &gt; <span class=\"number\">0</span> &amp;&amp; line &lt;= <span class=\"built_in\">CountLines</span>(filename)) &#123;</span><br><span class=\"line\">    ifstream f;</span><br><span class=\"line\">    string stdfilename = filename.<span class=\"built_in\">toStdString</span>();</span><br><span class=\"line\">    f.<span class=\"built_in\">open</span>(stdfilename, ios::in);</span><br><span class=\"line\"></span><br><span class=\"line\">    vector&lt;string&gt; strVec;</span><br><span class=\"line\">    <span class=\"comment\">//行0 - 行lines对应strvect[0] - strvect[lines]</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!f.<span class=\"built_in\">eof</span>()) &#123;</span><br><span class=\"line\">      string inbuf;</span><br><span class=\"line\">      <span class=\"built_in\">getline</span>(f, inbuf, <span class=\"string\">&#x27;\\n&#x27;</span>);</span><br><span class=\"line\">      strVec.<span class=\"built_in\">push_back</span>(inbuf);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> QString::<span class=\"built_in\">fromStdString</span>(strVec[line - <span class=\"number\">1</span>]);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>读取整个文件并计算行数并不是一个效率高的方式，但在文件不大和不追求高效率的条件下，这是最好的实践方式。因为考虑这里还需要考虑到连续读取历史文件。</p>\n<p>当用户按下<code>UP</code>按键时，表示用户开始读取历史文件。用户首先查看的应该是历史文件的最后一行，当用户再次按下<code>UP</code>时，读取倒数第二行，依次类推。为了实现该功能，这里使用了一个全局变量<code>line</code>表示当前正在读取的行数，该行数被初始化为历史记录的总行数。然后再次读取将会<code>--line</code>后读取。当用户按下<code>DOWN</code>按键时，++line后读取。</p>\n<p>这里就要考虑到另一个问题，读取一定历史记录后，用户重新进行计算，然后再次查看历史记录，这样行数应当从新的历史记录最后一行开始计算。为此，这里引入了<code>isRead</code>变量，该变量初始化为<code>0</code>，表示现在未在读取。首次按下<code>UP</code>按键时，该变量置<code>1</code>，同时将<code>line</code>变量初始化为当前历史记录行数。当用户按下<code>UP</code>或<code>DOWN</code>按键时，正常修改<code>line</code>变量的值并进行读取即可。当用户按下<code>=</code>或手动保存时，需要将<code>isRead</code>置零。这样下一次按下<code>UP</code>时，将重新读取历史文件行数并为<code>line</code>赋值。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//mainwindow.cpp</span></span><br><span class=\"line\"><span class=\"comment\">//等号的槽函数在上面</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MainWindow::on_pushButton_Up_clicked</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  ui-&gt;textBrowser_input-&gt;<span class=\"built_in\">setFocus</span>();</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (Location::isRead) &#123;</span><br><span class=\"line\">    --Location::line;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    Location::line = <span class=\"built_in\">CountLines</span>(Location::filePath);</span><br><span class=\"line\">    Location::isRead = <span class=\"number\">1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  ui-&gt;textBrowser_output-&gt;<span class=\"built_in\">setText</span>(<span class=\"built_in\">ReadLine</span>(Location::filePath, Location::line));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MainWindow::on_pushButton_Down_clicked</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  ui-&gt;textBrowser_input-&gt;<span class=\"built_in\">setFocus</span>();</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (Location::isRead) &#123;</span><br><span class=\"line\">    ++Location::line;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  ui-&gt;textBrowser_output-&gt;<span class=\"built_in\">setText</span>(<span class=\"built_in\">ReadLine</span>(Location::filePath, Location::line));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>保存和读取的路径将在<code>顶层设计细节</code>中进一步讨论。</p>\n<h3 id=\"顶层设计细节\"><a href=\"#顶层设计细节\" class=\"headerlink\" title=\"顶层设计细节\"></a>顶层设计细节</h3><p>这里在menubar中设置了一个<code>history location</code>按键，用于修改历史文件的存放位置。当按下此按键时，程序应当打开一个新的窗口，因此，需要首先在源文件中创建一个新的窗口。右键点击<code>项目</code>，选择<code>add new</code>，选择<code>qt设计师类</code>，然后会分别在三个文件夹中依次得到头文件、源文件、ui设计文件。然后需要在主窗口中设置点击<code>history location</code>按键打开新窗口。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//mainwindow.cpp</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MainWindow::on_actionHistory_location_triggered</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  Location *new_win = <span class=\"keyword\">new</span> <span class=\"built_in\">Location</span>();</span><br><span class=\"line\">  new_win-&gt;<span class=\"built_in\">show</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>注意</strong>：记得在<code>mainwindow.h</code>中include<code>location.h</code>，按下打开新窗口实际上就是创建一个新的Location窗口，然后展示。</p>\n<p>接下来就是在<code>location.ui</code>中修改和设计可视化窗口，此项目使用了栅格布局，在左侧设置了一个较大的<code>textBrowser</code>和较小的<code>lineEdit</code>（设为不可修改，用于给出提示），在右侧依次设置了<code>选择文件</code>，<code>选择文件夹</code>，<code>确定</code>，<code>取消</code> 四个按键。</p>\n<blockquote>\n<p>选择文件：调用Qt库，打开系统默认的文件选择框，设置必须选择.txt格式结尾的文件，将返回的结果输出至<code>textBrowser</code>。</p>\n<p>选择文件夹：同上，但是选择的是文件夹，并且返回的是存在的文件夹的路径，将返回的结果加上<code>/result.txt</code>后输入至<code>textBrowser</code>。</p>\n<p>确定：按下后，读取<code>textBrowser</code>中的路径，检查其合法性（因为一开始<code>textBrowser</code>设置了可以直接更改，因此可能会输入奇怪的路径），若不合法则在<code>lineEdit</code>中给出相应的报错（格式不合法或路径不合法）。若合法，则检查文件是否存在，不存在则创建。当一切都合理以后，将全局变量<code>filePath</code>设为文本框中的内容，并关闭<code>Location</code>窗口。</p>\n<p>取消：直接关闭，不做任何修改。</p>\n</blockquote>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//location.cpp</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Location::on_pushButton_path_clicked</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  QString file_name =</span><br><span class=\"line\">      QFileDialog::<span class=\"built_in\">getOpenFileName</span>(<span class=\"literal\">NULL</span>, <span class=\"string\">&quot;选择txt文件&quot;</span>, <span class=\"string\">&quot;.&quot;</span>, <span class=\"string\">&quot;*.txt&quot;</span>);</span><br><span class=\"line\">  ui-&gt;textEdit-&gt;<span class=\"built_in\">setText</span>(file_name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Location::on_pushButton_dir_clicked</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  QString dir_name = QFileDialog::<span class=\"built_in\">getExistingDirectory</span>(<span class=\"literal\">NULL</span>, <span class=\"string\">&quot;选择文件夹&quot;</span>, <span class=\"string\">&quot;.&quot;</span>);</span><br><span class=\"line\">  ui-&gt;textEdit-&gt;<span class=\"built_in\">setText</span>(dir_name + <span class=\"string\">&quot;/result.txt&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Location::on_pushButton_cancel_clicked</span><span class=\"params\">()</span> </span>&#123; Location::<span class=\"built_in\">close</span>(); &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Location::on_pushButton_sure_clicked</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  QString new_path = ui-&gt;textEdit-&gt;<span class=\"built_in\">toPlainText</span>();</span><br><span class=\"line\">  <span class=\"function\">QFileInfo <span class=\"title\">info</span><span class=\"params\">(new_path)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!info.<span class=\"built_in\">exists</span>()) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (new_path.<span class=\"built_in\">contains</span>(<span class=\"string\">&quot;.txt&quot;</span>)) &#123;</span><br><span class=\"line\">      <span class=\"function\">QFile <span class=\"title\">f</span><span class=\"params\">(new_path)</span></span>;</span><br><span class=\"line\">      f.<span class=\"built_in\">open</span>(QIODevice::WriteOnly);</span><br><span class=\"line\">      f.<span class=\"built_in\">close</span>();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      ui-&gt;prompt-&gt;<span class=\"built_in\">setText</span>(<span class=\"string\">&quot;路径或格式不合法，请重新输入&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  Location::filePath=new_path;</span><br><span class=\"line\">  Location::<span class=\"built_in\">close</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>自动保存功能被设计为主窗口中菜单栏中的一个按键，默认为开启状态，显示为<code>Auto Save On</code>，当点击该按键后，槽函数将该文本替换为<code>Auto Save Off</code>，并将全局变量<code>autoSave</code>置零。</p>\n<p><code>filePath</code>和<code>autoSave</code>以及底层中的<code>isRead</code>和<code>line</code>都设计为一个全局变量，便于主窗口调用。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//location.h</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Location</span> :</span> <span class=\"keyword\">public</span> QDialog &#123;</span><br><span class=\"line\"> <span class=\"keyword\">public</span>:</span><br><span class=\"line\">  <span class=\"keyword\">static</span> QString filePath;</span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> line;</span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"keyword\">bool</span> isRead;</span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"keyword\">bool</span> autoSave;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//location.cpp</span></span><br><span class=\"line\">QString Location::filePath = <span class=\"string\">&quot;result.txt&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> Location::line = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">bool</span> Location::isRead = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">bool</span> Location::autoSave = <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n\n<p>在主窗口中，只有用户按下等号（并且自动保存功能开启）或手动保存（在<code>menubar</code>中设置了一个保存按键并且设置了快捷键）时，才会保存。因此只需在这些地方加入<code>save()</code>函数即可。当然，也要有对<code>autoSave</code>的判断。</p>\n<h2 id=\"样式设定\"><a href=\"#样式设定\" class=\"headerlink\" title=\"样式设定\"></a>样式设定</h2><p>前面提到了可以在<code>ui</code>文件中直接修改样式，但这种方式并不利于后面的修改，因此我们选择直接调用函数的方式。如要为<code>centralWidget</code>设定样式，可以调用<code>setStyelSheet()</code>，后接一个QString，该字符串中直接书写qss内容。</p>\n<p>这里选择了另一种方式，使用qt的资源文件管理功能来存储单独的qss文件，然后以前缀引用的方式来调用这些文件。</p>\n<p>在<code>项目</code>中右键新建<code>qt resource file</code>，设定名称后打开管理界面，点击添加前缀<code>add prefix</code>。然后添加文件<code>add Files</code>。前缀决定了调用的方式（将会在源代码中演示）。文件可以新建一个<code>general file</code>后添加，也可以将其他方式创建的qss文件加入。</p>\n<p>引入的资源可以以<code>QFile</code>的方式引用。本项目在菜单栏中添加了一个黑色主题的选项，其槽函数如下</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MainWindow::on_actionBlack_theme_triggered</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  globalQss = <span class=\"string\">&quot;:/Black.qss&quot;</span>;</span><br><span class=\"line\">  <span class=\"function\">QFile <span class=\"title\">defaultQss</span><span class=\"params\">(globalQss)</span></span>;</span><br><span class=\"line\">  defaultQss.<span class=\"built_in\">open</span>(QFile::ReadOnly);</span><br><span class=\"line\">  QString qssContent = defaultQss.<span class=\"built_in\">readAll</span>();</span><br><span class=\"line\">  <span class=\"built_in\">centralWidget</span>()-&gt;<span class=\"built_in\">setStyleSheet</span>(qssContent);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>/</code>为我设定的前缀，只需以冒号开头，加上前缀和文件，即表明在应用qt指定好的资源文件。接下来就只需打开该文件并读取其内容，然后为需要的组件设定qss样式即可。</p>\n<p><strong>注意</strong>：使用qss的一些麻烦：后面我希望能设定字体的大小、样式等，但这时通过<code>setFont()</code>等函数并不起作用。原因估计是qss的优先级很高，直接设定将不起作用。这时我只能再写一个<code>changeStyle()</code>函数，通过qss样式表更新来进行样式更新</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MainWindow::changeStyle</span><span class=\"params\">(QString newStyle, QWidget *widget)</span> </span>&#123;</span><br><span class=\"line\">  QString oldStyle = widget-&gt;<span class=\"built_in\">styleSheet</span>();</span><br><span class=\"line\">  oldStyle += newStyle;</span><br><span class=\"line\">  widget-&gt;<span class=\"built_in\">setStyleSheet</span>(oldStyle);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>所以这里我只写了改变字体的函数。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MainWindow::on_actionLarge_font_size_triggered</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">changeStyle</span>(<span class=\"string\">&quot;*&#123;font:30px;&#125;&quot;</span>, MainWindow::<span class=\"built_in\">centralWidget</span>());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"保存设置\"><a href=\"#保存设置\" class=\"headerlink\" title=\"保存设置\"></a>保存设置</h2><p>类似于文件的保存位置，是否自动保存等功能，每次重新启动程序后都会按照程序的设定重新初始化。为了使得这些设定能被保存下来，需要使用一个文件将这些配置保存下来。恰好最近见到了许多<code>ini</code>格式文件，qt也提供了<code>QSetting</code>及配套的<code>ini</code>配置文件读写。</p>\n<p>配置文件应当在主窗口创建时被读取，在主窗口被销毁时被存入。因此只需在<code>mainwindow</code>的构造函数和析构函数中加入读写<code>ini</code>文件的步骤即可。需要注意的是，要考虑<code>ini</code>文件不存在的情况，不存在时需要使用程序的内置设定。</p>\n <figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MainWindow::<span class=\"built_in\">MainWindow</span>(QWidget *parent)</span><br><span class=\"line\">    : <span class=\"built_in\">QMainWindow</span>(parent), <span class=\"built_in\">ui</span>(<span class=\"keyword\">new</span> Ui::MainWindow) &#123;</span><br><span class=\"line\">  ui-&gt;<span class=\"built_in\">setupUi</span>(<span class=\"keyword\">this</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>-&gt;<span class=\"built_in\">grabKeyboard</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">  QSettings *iniRead = <span class=\"keyword\">new</span> <span class=\"built_in\">QSettings</span>(<span class=\"string\">&quot;config.ini&quot;</span>, QSettings::IniFormat);</span><br><span class=\"line\">  QString iniAuto = iniRead-&gt;<span class=\"built_in\">value</span>(<span class=\"string\">&quot;autoSave&quot;</span>).<span class=\"built_in\">toString</span>();</span><br><span class=\"line\">  QString iniPath = iniRead-&gt;<span class=\"built_in\">value</span>(<span class=\"string\">&quot;filePath&quot;</span>).<span class=\"built_in\">toString</span>();</span><br><span class=\"line\">  QString iniQss = iniRead-&gt;<span class=\"built_in\">value</span>(<span class=\"string\">&quot;globalQss&quot;</span>).<span class=\"built_in\">toString</span>();</span><br><span class=\"line\">  <span class=\"keyword\">delete</span> iniRead;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// init autoSave</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!iniAuto.<span class=\"built_in\">isEmpty</span>() &amp;&amp; !iniAuto.<span class=\"built_in\">toInt</span>()) &#123;</span><br><span class=\"line\">    Location::autoSave = <span class=\"number\">0</span>;</span><br><span class=\"line\">    ui-&gt;actionAuto_Save-&gt;<span class=\"built_in\">setText</span>(<span class=\"string\">&quot;Auto Save Off&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// init filePath</span></span><br><span class=\"line\">  <span class=\"function\">QFile <span class=\"title\">iniPathFile</span><span class=\"params\">(iniPath)</span></span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (iniPathFile.<span class=\"built_in\">open</span>(QFile::WriteOnly)) &#123;</span><br><span class=\"line\">    Location::filePath = iniPath;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// init Qss file(theme)</span></span><br><span class=\"line\">  <span class=\"function\">QFile <span class=\"title\">iniQssFile</span><span class=\"params\">(iniQss)</span></span>;</span><br><span class=\"line\">  QString qssContent;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (iniQssFile.<span class=\"built_in\">open</span>(QFile::ReadOnly)) &#123;</span><br><span class=\"line\">    qssContent = iniQssFile.<span class=\"built_in\">readAll</span>();</span><br><span class=\"line\">    globalQss = iniQss;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    QFile <span class=\"built_in\">defaultQss</span>(<span class=\"string\">&quot;:/Black.qss&quot;</span>);</span><br><span class=\"line\">    defaultQss.<span class=\"built_in\">open</span>(QFile::ReadOnly);</span><br><span class=\"line\">    qssContent = defaultQss.<span class=\"built_in\">readAll</span>();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"built_in\">centralWidget</span>()-&gt;<span class=\"built_in\">setStyleSheet</span>(qssContent);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">MainWindow::~<span class=\"built_in\">MainWindow</span>() &#123;</span><br><span class=\"line\">  QSettings *IniWrite = <span class=\"keyword\">new</span> <span class=\"built_in\">QSettings</span>(<span class=\"string\">&quot;config.ini&quot;</span>, QSettings::IniFormat);</span><br><span class=\"line\">  IniWrite-&gt;<span class=\"built_in\">setValue</span>(<span class=\"string\">&quot;autoSave&quot;</span>, Location::autoSave);</span><br><span class=\"line\">  IniWrite-&gt;<span class=\"built_in\">setValue</span>(<span class=\"string\">&quot;filePath&quot;</span>, Location::filePath);</span><br><span class=\"line\">  IniWrite-&gt;<span class=\"built_in\">setValue</span>(<span class=\"string\">&quot;globalQss&quot;</span>, globalQss);</span><br><span class=\"line\">  <span class=\"keyword\">delete</span> IniWrite;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">delete</span> ui;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h2><ul>\n<li>在主函数中为整个窗口设置了透明度，让它看起来酷炫一点点。</li>\n<li>在主函数中为窗口设定名称。</li>\n<li>在<code>.pro</code>文件中加入图标文件，使得生成的程序有图标</li>\n</ul>\n<h1 id=\"感想\"><a href=\"#感想\" class=\"headerlink\" title=\"感想\"></a>感想</h1><h2 id=\"收获\"><a href=\"#收获\" class=\"headerlink\" title=\"收获\"></a>收获</h2><ul>\n<li>不再害怕qt框架了，反而觉得它好用。</li>\n<li>qt的窗口类很舒服，有清晰且层次分明的关系，有足够好用的成员函数。</li>\n<li>qt的基本库也有不少可以讨论的，如QString的设计，不仅提供了基本的可变长度和操作符重载，还考虑到了和std库之间的转换。</li>\n<li>qt的信号与槽机制是qt最精髓的东西之一，信号是一种非常不错的线程间通信方式，很遗憾我没有手动使用connect函数来创建信号与槽。但确实在写qt的过程中，qtcreator已经为我提供了足够的可视化信号与槽构建工具。</li>\n<li>qss基本等于css</li>\n<li>qt以易于制作ui界面出名，但用了之后发现，qt实际上是借鉴了很多现代浏览器（前端）的实现方式。我写的时候感觉自己像是在写js+css。对于一个web项目来说，前端工程师书写html，css，以及利用框架来写js。后端工程师则使用各种工具来构建web服务。但对于qt这样一种前后结合的一体化程序设计框架来说，前后的分离并不彻底（虽然对硬件工程师来说可能会很友好）。</li>\n<li>我还是支持“qt是一个平台而不只是一个ui框架”这种说法。qt在基本库中的内容一点也不比它在ui界面中的少。无论是基本库还是ui库，都有很多可以研究的东西。</li>\n<li>宏的自动扩展确实好用</li>\n<li>qt毕竟还是封装的比较高层了，要是需要一些简单的功能，还是老老实实写原生的c和std吧。</li>\n</ul>\n<h2 id=\"遗憾\"><a href=\"#遗憾\" class=\"headerlink\" title=\"遗憾\"></a>遗憾</h2><ul>\n<li>大佬说他使用了前缀表达式，求余和翻方功能不好实现，我懂的算法也不多，这两个功能没能实现。只能说算法能力有待提高了。</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"功能\"><a href=\"#功能\" class=\"headerlink\" title=\"功能\"></a>功能</h1><ol>\n<li>对十六进制数进行双目、表达式运算</li>\n<li>对运算结果进行保存和再读取，支持自动保存和手动保存</li>\n<li>自定义运算结果储存位置</li>\n<li>自定义字体大小</li>\n<li>可更换窗口风格（换肤）</li>\n<li>自动保存设置</li>\n</ol>\n<h1 id=\"任务分配\"><a href=\"#任务分配\" class=\"headerlink\" title=\"任务分配\"></a>任务分配</h1><ol>\n<li>：ui设计与qt框架</li>\n<li>：核心算法</li>\n<li>：文件读写</li>\n</ol>\n<h1 id=\"开源地址\"><a href=\"#开源地址\" class=\"headerlink\" title=\"开源地址\"></a>开源地址</h1><p><a href=\"https://github.com/kawhicurry/0xCalculator\">https://github.com/kawhicurry/0xCalculator</a></p>\n<h1 id=\"开发过程\"><a href=\"#开发过程\" class=\"headerlink\" title=\"开发过程\"></a>开发过程</h1><h2 id=\"Qt框架\"><a href=\"#Qt框架\" class=\"headerlink\" title=\"Qt框架\"></a>Qt框架</h2><p>qt文件将会以平铺的方式放置在同一工程目录下，其组织结构由<code>.pro</code>文件记录，该文件类似于makefile（可以看作是qmakefile？）。其标准目录如下：</p>\n<blockquote>\n<p>.pro：记录文件</p>\n<p>/Headers：略</p>\n<p>/Sources：略</p>\n<p>/Forms：存放<code>.ui</code>文件，实际为<code>xml</code>格式，但不建议直接编辑，所有操作应当在设计模块中完成</p>\n<p>/Resources：存放qt标准资源（可以qt方式引用的资源）</p>\n<p>/Other files</p>\n</blockquote>\n<h2 id=\"UI设计\"><a href=\"#UI设计\" class=\"headerlink\" title=\"UI设计\"></a>UI设计</h2><p>直接在qt creator的设计界面中打开<code>设计</code>模块。从画面左侧拖动组件，摆放至设计框中即可。</p>\n<p><em>问题</em>：组件散乱</p>\n<ul>\n<li>左侧组件库中有<code>layout</code>组件,将其拖动至设计框中,再向layout中添加组件，即可使所有组件呈现一定规律。</li>\n</ul>\n<blockquote>\n<p>布局类型：</p>\n<p>垂直：略</p>\n<p>水平：略</p>\n<p>栅格（grid）：上面俩合起来</p>\n<p>窗口：？存疑，不是很能理解这是啥</p>\n</blockquote>\n<p><em>问题</em>：使用layout组件后无法布局固定，启动ui界面后拖动窗口改变其大小，layout组件位置不动。</p>\n<ul>\n<li>应当首先在右侧<code>对象</code>框中选中主窗口（mainwindow）中的中间部件（centralwidget），右键选择布局，为整个中间部分设定大的布局，（注：主窗口除了中间部件还初始化了一个菜单栏（menubar）），然后在该布局中嵌套布局或组件。本方案选择了栅格布局，虽然只需垂直布局即可，但为了可拓展性，还是选择栅格。接下来在整个中间部分的栅格布局中，嵌套了一个垂直布局（用于输入和输出）和一个栅格布局（用于存放按键）。</li>\n</ul>\n<p>接下来在主窗口中添加所需的组件，分别为输入框、输出框、5*6个按键。然后可以对其属性进行可视化的设计，以下是对<code>设计</code>界面中一些工具的解释：</p>\n<blockquote>\n<p>右侧下方为属性框，显示了所选定组件的属性，每个组件都是层层继承而来，因此要注意每一层的具体属性以及继承关系。</p>\n<p>右侧上方为对象框，显示了当前ui文件中所有文件属性。</p>\n<p>正中央下方的框实际上有两个可编辑区域，一个为action editor，即为组件添加动作（可方便设置快捷键）。另一个为信号与槽。</p>\n<p>注：信号与槽是最Qt制作ui界面中最重要的机制。</p>\n</blockquote>\n<p>创建槽函数：在信号与槽编辑框中点击加号创建信号与槽，然后选择信号的发送对象、发送信号量、槽、响应函数。此处的创建<strong>只支持内定的槽函数</strong>，想要自定义槽函数，需在右侧对象中找到对象，然后右键选择转到槽，接下来选择信号量之后，Qt会跳转该ui文件对应的cpp文件下，并自动创建一个该槽函数的实现（.h文件中也会自动添加声明）。接下来只需在此槽函数中编写发送信号后（触发信号发送条件），所需只需的步骤即可。</p>\n<blockquote>\n<p>信号量是Qt类自带的属性，某个类既有自己的属性，也有继承而来的属性。如pushButton组件继承自QAbstractButton，后者又继承自QWidget，后者又继承自QObject。对于QAbstractButton，其自带的信号有<code>clicked()</code>,<code>pressed()</code>等，对于QWidget，有<code>windowIconChanged</code>等。具体解释请参考官方文档。</p>\n</blockquote>\n<p><code>设计</code>界面支持大量的属性设置，如字体，背景等。并且可以直接在ui界面中即时显示，但并不推荐直接做修改。</p>\n<p>一种渲染方式：Qt提供了qss来进行类似css的样式渲染，只需选中对象然后右键改变样式表，修改某个组件的样式表即可。Qss还提供了选择器的功能，因此，只需在某个较大的组件中设置样式表，并对不同的渲染对象进行选择即可。本方案一开始的办法就是在centralwidget组件中设置样式表，完成了酷炫的按键风格。需要注意的是，改变样式表的方法在Qt中是存在一定问题的，并且，<strong>任何写死的方法都可能在以后要修改时造成麻烦</strong>。关于样式表后面还会再进一步设定。</p>\n<h2 id=\"模拟按键\"><a href=\"#模拟按键\" class=\"headerlink\" title=\"模拟按键\"></a>模拟按键</h2><p>一个计算器应当提供一系列的按键，因此要在栅格布局中拖入一定数量的按键。按键分为输入按键和功能按键。</p>\n<ul>\n<li>输入按键：0123456789ABCDEF+-*/（）</li>\n<li>功能按键：&lt;- -&gt; DEL CE UP DOWN =</li>\n</ul>\n<p>对于输入按键，按下按键后应当在输入框中显示对应的输入，同时这些按键应当有对应的键盘输入。</p>\n<p>对于输出按键，左移和右移是为了移动输入框中的光标。DEL清除一个字符，CE要同时清除输入和输出框。UP和DOWN提供了查看历史功能。等号是整个计算器的核心功能，按下等号后，应当读取输入框中的算式，进行计算后将结果字符串返回至输出框中。</p>\n<p>通过在组件上右键选择 转到槽 可以快捷创建槽函数。示例如图：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//mainwindow.h</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MainWindow::on_pushButton_left_bracket_clicked</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"><span class=\"comment\">//mainwindow.cpp</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MainWindow::on_pushButton_left_bracket_clicked</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  ui-&gt;textBrowser_input-&gt;<span class=\"built_in\">setFocus</span>();</span><br><span class=\"line\">  ui-&gt;textBrowser_input-&gt;<span class=\"built_in\">insertPlainText</span>(<span class=\"string\">&quot;(&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>手动创建几个后，就可以发现其规矩。一个槽函数的名称由<code>on_name_action</code>组成。<code>pushButton_left_bracket</code>是改按键的名称，这个名称需要在ui文件中指定，当拖动pushButton的时候，qt会按照12345依次给其一个默认名称，并且上面的默认文字都是pushButton。因此对于声明，可以用宏生成。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//mainwindwo.h</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> clicked_func(name) void on_pushButton_##name##_clicked();</span></span><br><span class=\"line\">  <span class=\"built_in\">clicked_func</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">  <span class=\"built_in\">clicked_func</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"built_in\">clicked_func</span>(<span class=\"number\">2</span>);</span><br><span class=\"line\">  <span class=\"built_in\">clicked_func</span>(<span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"comment\">//...</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> triggered_func(name) void on_action##name##_triggered();</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">triggered_func</span>(Author);</span><br><span class=\"line\">  <span class=\"built_in\">triggered_func</span>(Save) <span class=\"built_in\">triggered_func</span>(Read);</span><br><span class=\"line\">  <span class=\"built_in\">triggered_func</span>(History_location);</span><br><span class=\"line\">  <span class=\"built_in\">triggered_func</span>(Auto_Save);</span><br></pre></td></tr></table></figure>\n\n<p>对于实现，部分直接输入的槽函数也可以用宏生成</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//mainwindow.cpp</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> set_insert_func(name)                         \\</span></span><br><span class=\"line\"><span class=\"meta\">  void MainWindow::on_pushButton_##name##_clicked() &#123; \\</span></span><br><span class=\"line\"><span class=\"meta\">    ui-&gt;textBrowser_input-&gt;setFocus();                \\</span></span><br><span class=\"line\"><span class=\"meta\">    ui-&gt;textBrowser_input-&gt;insertPlainText(#name);    \\</span></span><br><span class=\"line\"><span class=\"meta\">  &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">set_insert_func</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"built_in\">set_insert_func</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"built_in\">set_insert_func</span>(<span class=\"number\">2</span>);</span><br><span class=\"line\"><span class=\"built_in\">set_insert_func</span>(<span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"built_in\">set_insert_func</span>(<span class=\"number\">4</span>);</span><br></pre></td></tr></table></figure>\n\n<p>剩下的就只能自己写咯。</p>\n<h2 id=\"输入输出框\"><a href=\"#输入输出框\" class=\"headerlink\" title=\"输入输出框\"></a>输入输出框</h2><p>qt为用户提供了<code>text Browser</code>,<code>text Edit</code>,<code>Plain text edit</code>,<code>line edit</code>等组件作为文本框。这里选择了text Browser，目的是屏蔽直接复制粘贴输入，防止非法字符进入。结果后面发现<code>text Browser</code>是由<code>text Edit</code>继承而来，因此browser也可以提供输入功能（离谱，read Only属性。</p>\n<p>所有的输入按键都将在输入框中插入一个对应的字符。这里只需要调用<code>text Browser</code>类中自带的public function member：<code>insertPlainText(QString)</code>。</p>\n<p><em>问题</em>：文本框中的光标只有在选中文本框时才会显示，如果使用鼠标点击按键进行输入，输入框中的光标实际仍然存在但不显示。</p>\n<ul>\n<li>为了使得光标时刻存在，这里使用了一个简单粗暴的方法，为所有按键功能加上<code>setFocus()</code>。从而保证焦点始终在输入框中。</li>\n</ul>\n<p>对于输出框，每次显示结果都是更新所有内容（而不是插入），因此需要<code>setPlainText</code>。</p>\n<h2 id=\"等号\"><a href=\"#等号\" class=\"headerlink\" title=\"等号\"></a>等号</h2><p>等号按键是计算器最核心的按键，以下为等号按键的槽函数</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//mainwindow.cpp</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MainWindow::on_pushButton_equal_clicked</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  ui-&gt;textBrowser_input-&gt;<span class=\"built_in\">setFocus</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">  Location::isRead = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  QString s = ui-&gt;textBrowser_input-&gt;<span class=\"built_in\">toPlainText</span>();</span><br><span class=\"line\">  QString rst = <span class=\"built_in\">parser</span>(s);</span><br><span class=\"line\">  ui-&gt;textBrowser_output-&gt;<span class=\"built_in\">setPlainText</span>(rst);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (Location::autoSave) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">save</span>(Location::filePath, s, rst);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>按下等号后，程序首先保证焦点仍然在输入框口上，然后讲是否正在读取历史记录按键设置为0（这讲在后面的历史记录读取中说到），然后获取输入框中的内容，交给由竞赛大佬@龚程昊编写的parser函数进行处理（这将在后面数据处理中说到），然后将parser函数返回的字符串（QString）显示到输出框中，然后在自动保存功能开启的情况下，保存至本地文件中。</p>\n<h2 id=\"数据处理\"><a href=\"#数据处理\" class=\"headerlink\" title=\"数据处理\"></a>数据处理</h2><p>等会儿copy大佬写的东西，大致思路是使用栈和转化为前缀表达式。</p>\n<p>但大佬使用的使用的是std库，并且是作为一个单独的cpp程序书写的（方便调试）。因此，这里将源文件复制到parser文件中，并将main函数改写成接受<code>QString</code>作为参数，返回<code>QString</code>的parser()函数。这里用到了<code>QString::toStdString</code>和<code>QString::fromStdString</code>。</p>\n<p>记录几个当时测试出来的bug：</p>\n<ol>\n<li>只写一个数后按等号，直接返回0</li>\n<li>没有考虑负数</li>\n<li>没有考虑溢出</li>\n</ol>\n<p>附上代码</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//parser.cpp</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;parser.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">pd</span><span class=\"params\">(<span class=\"keyword\">char</span> i)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> ((i &lt;= <span class=\"number\">57</span> &amp;&amp; i &gt;= <span class=\"number\">48</span>) || (i &gt;= <span class=\"number\">65</span> &amp;&amp; i &lt;= <span class=\"number\">70</span>)) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">pri</span><span class=\"params\">(<span class=\"keyword\">char</span> i)</span>  <span class=\"comment\">// priority</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (i == <span class=\"string\">&#x27;+&#x27;</span> || i == <span class=\"string\">&#x27;-&#x27;</span>) <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (i == <span class=\"string\">&#x27;*&#x27;</span> || i == <span class=\"string\">&#x27;/&#x27;</span>) <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (i == <span class=\"string\">&#x27;(&#x27;</span>) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (i == <span class=\"string\">&#x27;)&#x27;</span>) <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">255</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">judge</span><span class=\"params\">(<span class=\"keyword\">char</span> i)</span>  <span class=\"comment\">//乱码</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> ((i &lt;= <span class=\"number\">57</span> &amp;&amp; i &gt;= <span class=\"number\">48</span>) || (i &gt;= <span class=\"number\">65</span> &amp;&amp; i &lt;= <span class=\"number\">70</span>) || i == <span class=\"string\">&#x27;+&#x27;</span> || i == <span class=\"string\">&#x27;-&#x27;</span> ||</span><br><span class=\"line\">      i == <span class=\"string\">&#x27;*&#x27;</span> || i == <span class=\"string\">&#x27;/&#x27;</span> || i == <span class=\"string\">&#x27;(&#x27;</span> || i == <span class=\"string\">&#x27;)&#x27;</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">QString <span class=\"title\">parser</span><span class=\"params\">(QString expression)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> <span class=\"keyword\">int</span> N = <span class=\"number\">1007</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> <span class=\"keyword\">long</span> R = LONG_MAX;</span><br><span class=\"line\">  <span class=\"keyword\">char</span> s[N], stack1[N];</span><br><span class=\"line\">  <span class=\"keyword\">long</span> read[N], sta[N], stack2[N], stt[N];</span><br><span class=\"line\">  <span class=\"keyword\">bool</span> f[N] = &#123;<span class=\"number\">0</span>&#125;, flag[N] = &#123;<span class=\"number\">0</span>&#125;, ff = <span class=\"number\">0</span>, fff = <span class=\"number\">0</span>;</span><br><span class=\"line\">  string c, sc;</span><br><span class=\"line\">  string str, as = expression.<span class=\"built_in\">toStdString</span>();</span><br><span class=\"line\">  str = <span class=\"string\">&quot;0+&quot;</span> + as;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> l = str.<span class=\"built_in\">length</span>();</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; l; i++) &#123;</span><br><span class=\"line\">    s[i] = str[i];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">judge</span>(s[i])) &#123;</span><br><span class=\"line\">      ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (s[i] == <span class=\"string\">&#x27;(&#x27;</span> &amp;&amp; (s[i + <span class=\"number\">1</span>] == <span class=\"string\">&#x27;*&#x27;</span> || s[i + <span class=\"number\">1</span>] == <span class=\"string\">&#x27;/&#x27;</span>)) ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (s[i] == <span class=\"string\">&#x27;)&#x27;</span> &amp;&amp; (s[i - <span class=\"number\">1</span>] == <span class=\"string\">&#x27;+&#x27;</span> || s[i - <span class=\"number\">1</span>] == <span class=\"string\">&#x27;-&#x27;</span> || s[i - <span class=\"number\">1</span>] == <span class=\"string\">&#x27;*&#x27;</span> ||</span><br><span class=\"line\">                        s[i - <span class=\"number\">1</span>] == <span class=\"string\">&#x27;/&#x27;</span>))</span><br><span class=\"line\">      ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">pd</span>(s[l - <span class=\"number\">1</span>]) &amp;&amp; s[l - <span class=\"number\">1</span>] != <span class=\"string\">&#x27;)&#x27;</span>) ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> st = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; l; i++)  <span class=\"comment\">//括号是否匹配</span></span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (s[i] == <span class=\"string\">&#x27;(&#x27;</span>) st++;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (s[i] == <span class=\"string\">&#x27;)&#x27;</span>) st--;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (st != <span class=\"number\">0</span>) ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> j = <span class=\"number\">0</span>, k = <span class=\"number\">0</span>, m = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">while</span> (j &lt; l &amp;&amp; ff == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"built_in\">pd</span>(s[j]))  <span class=\"comment\">//数字</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (s[j] &lt;= <span class=\"number\">57</span> &amp;&amp; s[j] &gt;= <span class=\"number\">48</span>) &#123;</span><br><span class=\"line\">        sta[k] = s[j] - <span class=\"number\">48</span>;</span><br><span class=\"line\">        j++;</span><br><span class=\"line\">        k++;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (s[j] &gt;= <span class=\"number\">65</span> &amp;&amp; s[j] &lt;= <span class=\"number\">70</span>) &#123;</span><br><span class=\"line\">        sta[k] = s[j] - <span class=\"number\">55</span>;</span><br><span class=\"line\">        j++;</span><br><span class=\"line\">        k++;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">pd</span>(s[j]))  <span class=\"comment\">//符号</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!<span class=\"built_in\">pd</span>(s[j - <span class=\"number\">1</span>]) &amp;&amp; j &gt; <span class=\"number\">0</span>)  <span class=\"comment\">//前面的数字</span></span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> cnt = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">char</span> c = s[j];</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> h = <span class=\"number\">0</span>; k &gt; <span class=\"number\">0</span>; h++) &#123;</span><br><span class=\"line\">          cnt += sta[k - <span class=\"number\">1</span>] * <span class=\"built_in\">pow</span>(<span class=\"number\">16</span>, h);</span><br><span class=\"line\">          k--;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        read[m] = cnt;</span><br><span class=\"line\">        m++;</span><br><span class=\"line\">        j++;</span><br><span class=\"line\">        read[m] = c;</span><br><span class=\"line\">        f[m] = <span class=\"number\">1</span>;</span><br><span class=\"line\">        m++;</span><br><span class=\"line\"></span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;  <span class=\"comment\">//前面的符号</span></span><br><span class=\"line\">        <span class=\"keyword\">char</span> c = s[j];</span><br><span class=\"line\">        read[m] = c;</span><br><span class=\"line\">        f[m] = <span class=\"number\">1</span>;</span><br><span class=\"line\">        m++;</span><br><span class=\"line\">        j++;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!<span class=\"built_in\">pd</span>(s[l - <span class=\"number\">1</span>]))  <span class=\"comment\">//数字</span></span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (k &gt; <span class=\"number\">9</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&quot;Detect Overflow&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> cnt = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> h = <span class=\"number\">0</span>; k &gt; <span class=\"number\">0</span>; h++) &#123;</span><br><span class=\"line\">      cnt += sta[k - <span class=\"number\">1</span>] * <span class=\"built_in\">pow</span>(<span class=\"number\">16</span>, h);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (cnt &gt; R) <span class=\"keyword\">return</span> <span class=\"string\">&quot;Detect Overflow&quot;</span>;</span><br><span class=\"line\">      k--;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    read[m] = cnt;</span><br><span class=\"line\">    m++;</span><br><span class=\"line\">    j++;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; m - <span class=\"number\">1</span>; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (i == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (f[i] == <span class=\"number\">1</span> &amp;&amp; f[i + <span class=\"number\">1</span>] == <span class=\"number\">1</span> &amp;&amp; <span class=\"built_in\">pri</span>(read[i]) &gt;= <span class=\"number\">1</span> &amp;&amp;</span><br><span class=\"line\">          <span class=\"built_in\">pri</span>(read[i + <span class=\"number\">1</span>]) == <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f[i] == <span class=\"number\">1</span> &amp;&amp; f[i + <span class=\"number\">1</span>] == <span class=\"number\">1</span> &amp;&amp; <span class=\"built_in\">pri</span>(read[i]) &gt;= <span class=\"number\">1</span> &amp;&amp;</span><br><span class=\"line\">               <span class=\"built_in\">pri</span>(read[i + <span class=\"number\">1</span>]) &gt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> a = <span class=\"number\">0</span>, b = <span class=\"number\">0</span>;  <span class=\"comment\">//反缀表达式</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; m; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (f[i] == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      stack2[a] = read[i];</span><br><span class=\"line\">      a++;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (f[i] == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (read[i] == <span class=\"string\">&#x27;(&#x27;</span>) &#123;</span><br><span class=\"line\">        stack1[b] = <span class=\"string\">&#x27;(&#x27;</span>;</span><br><span class=\"line\">        b++;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">pri</span>(read[i]) == <span class=\"number\">1</span>)  <span class=\"comment\">//+-</span></span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"built_in\">pri</span>(stack1[b - <span class=\"number\">1</span>]) &gt;= <span class=\"number\">1</span> &amp;&amp; b &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          stack2[a] = stack1[b - <span class=\"number\">1</span>];</span><br><span class=\"line\">          flag[a] = <span class=\"number\">1</span>;</span><br><span class=\"line\">          b--;</span><br><span class=\"line\">          a++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        stack1[b] = read[i];</span><br><span class=\"line\">        b++;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">pri</span>(read[i]) == <span class=\"number\">2</span>)  <span class=\"comment\">//*/</span></span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"built_in\">pri</span>(stack1[b - <span class=\"number\">1</span>]) == <span class=\"number\">2</span> &amp;&amp; b &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          stack2[a] = stack1[b - <span class=\"number\">1</span>];</span><br><span class=\"line\">          flag[a] = <span class=\"number\">1</span>;</span><br><span class=\"line\">          b--;</span><br><span class=\"line\">          a++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        stack1[b] = read[i];</span><br><span class=\"line\">        b++;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (read[i] == <span class=\"string\">&#x27;)&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (stack1[b - <span class=\"number\">1</span>] != <span class=\"string\">&#x27;(&#x27;</span>) &#123;</span><br><span class=\"line\">          stack2[a] = stack1[b - <span class=\"number\">1</span>];</span><br><span class=\"line\">          flag[a] = <span class=\"number\">1</span>;</span><br><span class=\"line\">          b--;</span><br><span class=\"line\">          a++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        b--;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">while</span> (b &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    stack2[a] = stack1[b - <span class=\"number\">1</span>];</span><br><span class=\"line\">    flag[a] = <span class=\"number\">1</span>;</span><br><span class=\"line\">    a++;</span><br><span class=\"line\">    b--;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// calculation</span></span><br><span class=\"line\">  <span class=\"keyword\">int</span> g = <span class=\"number\">0</span>, cn = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; a; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!flag[i])  <span class=\"comment\">//数字</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      stt[g] = stack2[i];</span><br><span class=\"line\">      g++;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (flag[i])  <span class=\"comment\">//符号</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"built_in\"><span class=\"keyword\">switch</span></span> (stack2[i]) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&#x27;+&#x27;</span>:</span><br><span class=\"line\">          cn = stt[g - <span class=\"number\">2</span>] + stt[g - <span class=\"number\">1</span>];</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (cn &gt; R) ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&#x27;-&#x27;</span>:</span><br><span class=\"line\">          cn = stt[g - <span class=\"number\">2</span>] - stt[g - <span class=\"number\">1</span>];</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (cn &lt; -R) ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&#x27;*&#x27;</span>:</span><br><span class=\"line\">          cn = stt[g - <span class=\"number\">2</span>] * stt[g - <span class=\"number\">1</span>];</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (cn &gt; R || cn &lt; -R) ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&#x27;/&#x27;</span>:</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (stt[g - <span class=\"number\">1</span>] != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            cn = stt[g - <span class=\"number\">2</span>] / stt[g - <span class=\"number\">1</span>];</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (stt[g - <span class=\"number\">1</span>] == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            ff = <span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      g -= <span class=\"number\">2</span>;</span><br><span class=\"line\">      stt[g] = cn;</span><br><span class=\"line\">      g++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> x;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> cnn = cn;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (cn == <span class=\"number\">0</span> &amp;&amp; !ff) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//        cout&lt;&lt;str&lt;&lt;&quot;=&quot;&lt;&lt;cn&lt;&lt;endl;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;0&quot;</span>;</span><br><span class=\"line\">    fff = <span class=\"number\">1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">while</span> (cn != <span class=\"number\">0</span> &amp;&amp; !ff)  <span class=\"comment\">//转十六进制</span></span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cn &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      x = cn % <span class=\"number\">16</span>;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (x &lt; <span class=\"number\">10</span>)</span><br><span class=\"line\">        c = x + <span class=\"string\">&#x27;0&#x27;</span>;</span><br><span class=\"line\">      <span class=\"keyword\">else</span></span><br><span class=\"line\">        c = x + <span class=\"string\">&#x27;A&#x27;</span> - <span class=\"number\">10</span>;</span><br><span class=\"line\">      sc = c + sc;</span><br><span class=\"line\">      cn /= <span class=\"number\">16</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (cn &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      x = cn % <span class=\"number\">16</span>;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (x &gt; <span class=\"number\">-10</span>)</span><br><span class=\"line\">        c = -x + <span class=\"string\">&#x27;0&#x27;</span>;</span><br><span class=\"line\">      <span class=\"keyword\">else</span></span><br><span class=\"line\">        c = -x + <span class=\"string\">&#x27;A&#x27;</span> - <span class=\"number\">10</span>;</span><br><span class=\"line\">      sc = c + sc;</span><br><span class=\"line\">      cn /= <span class=\"number\">16</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (cnn &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    sc = <span class=\"string\">&#x27;-&#x27;</span> + sc;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!ff &amp;&amp; !fff) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//        cout&lt;&lt;as&lt;&lt;&quot;=&quot;;</span></span><br><span class=\"line\">    <span class=\"comment\">//        cout&lt;&lt;sc&lt;&lt;endl;</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (sc == <span class=\"string\">&quot;-80000000&quot;</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">&quot;Detect Overflow&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> QString::<span class=\"built_in\">fromStdString</span>(sc);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&quot;Formula Error&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>贴代码的时候才发现大佬写了一个pd（判断）和一个judge（还是判断）。算了算了，能用就行（</p>\n<h2 id=\"历史记录\"><a href=\"#历史记录\" class=\"headerlink\" title=\"历史记录\"></a>历史记录</h2><p>如果只是作为计算器，以上功能就已经可以算完成了。但大多数计算器都是有历史记录功能的，因此这个计算器也该有一个。</p>\n<p>这里将历史记录分为底层和顶层两部分来设计，顶层使用Qt框架，而底层使用c的基本库，从而实现更加原子化和方便的操作。</p>\n<p>顶层实现的用户接口功能：</p>\n<ul>\n<li>手动保存当前结果</li>\n<li>选择是否自动保存结果</li>\n<li>选择保存位置</li>\n<li>读取历史记录</li>\n</ul>\n<p>底层实现的文本的读写功能</p>\n<ul>\n<li>获取时间</li>\n<li>记录结果</li>\n<li>写入和读取</li>\n</ul>\n<h3 id=\"底层设计细节\"><a href=\"#底层设计细节\" class=\"headerlink\" title=\"底层设计细节\"></a>底层设计细节</h3><p>保存功能被设计为，获取当前时间和本次运算的算式和结果，以新行的方式追加到某文件的结尾。保存功能的底层设计都被保存在<code>saving</code>文件下。</p>\n<p>为此底层使用std库设计了<code>save()</code>函数。该函数还调用了<code>getCurrentTime()</code>来获取当前时间。当然，这个函数也是由<code>main()</code>函数修改而来，由std框架接入了qt框架。源码如下：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//saving.cpp</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> string <span class=\"title\">getCurrentTime</span><span class=\"params\">()</span>  <span class=\"comment\">//输出当前时间</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">time_t</span> t = <span class=\"built_in\">time</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">  <span class=\"keyword\">char</span> ch[<span class=\"number\">64</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">  <span class=\"built_in\">strftime</span>(ch, <span class=\"built_in\"><span class=\"keyword\">sizeof</span></span>(ch) - <span class=\"number\">1</span>, <span class=\"string\">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, <span class=\"built_in\">localtime</span>(&amp;t));</span><br><span class=\"line\">  <span class=\"keyword\">return</span> ch;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">save</span><span class=\"params\">(QString location, QString fomula, QString data)</span> </span>&#123;</span><br><span class=\"line\">  string addr = location.<span class=\"built_in\">toStdString</span>();</span><br><span class=\"line\">  fstream f;</span><br><span class=\"line\">  f.<span class=\"built_in\">open</span>(addr, ios::out | ios::app);</span><br><span class=\"line\">  f &lt;&lt; <span class=\"built_in\">getCurrentTime</span>() &lt;&lt; <span class=\"string\">&quot; &quot;</span> &lt;&lt; fomula.<span class=\"built_in\">toStdString</span>() &lt;&lt; <span class=\"string\">&quot;=&quot;</span></span><br><span class=\"line\">    &lt;&lt; data.<span class=\"built_in\">toStdString</span>()</span><br><span class=\"line\">    &lt;&lt; endl;  <span class=\"comment\">//变量addr、以及gch的等式和输出结果变量还需加进去</span></span><br><span class=\"line\">  f.<span class=\"built_in\">close</span>();</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>除了保存结果外，还需要读取结果，读取结果需要始终从最后一行开始往上读。经历了一系列讨论之后，本项目决定使用读取整个文件来获取所有的行数，并根据行数来获取内容。为此有了<code>CountLine()</code>和<code>readLine()</code>两个函数：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">CountLines</span><span class=\"params\">(QString filename)</span> </span>&#123;</span><br><span class=\"line\">  ifstream f;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> n = <span class=\"number\">0</span>;</span><br><span class=\"line\">  string tmp;</span><br><span class=\"line\">  string stdfilename = filename.<span class=\"built_in\">toStdString</span>();</span><br><span class=\"line\">  <span class=\"comment\">// ios::in 表示以只读的方式读取文件</span></span><br><span class=\"line\">  f.<span class=\"built_in\">open</span>(stdfilename, ios::in);</span><br><span class=\"line\">  <span class=\"comment\">//文件打开失败:返回0</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (f.<span class=\"built_in\">fail</span>()) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//文件存在</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"built_in\">getline</span>(f, tmp, <span class=\"string\">&#x27;\\n&#x27;</span>)) &#123;</span><br><span class=\"line\">      n++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    f.<span class=\"built_in\">close</span>();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> n;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\">QString <span class=\"title\">ReadLine</span><span class=\"params\">(QString filename, <span class=\"keyword\">int</span> line)</span>  <span class=\"comment\">//读取指定行文件</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// line行数限制 1 - lines</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (line &gt; <span class=\"number\">0</span> &amp;&amp; line &lt;= <span class=\"built_in\">CountLines</span>(filename)) &#123;</span><br><span class=\"line\">    ifstream f;</span><br><span class=\"line\">    string stdfilename = filename.<span class=\"built_in\">toStdString</span>();</span><br><span class=\"line\">    f.<span class=\"built_in\">open</span>(stdfilename, ios::in);</span><br><span class=\"line\"></span><br><span class=\"line\">    vector&lt;string&gt; strVec;</span><br><span class=\"line\">    <span class=\"comment\">//行0 - 行lines对应strvect[0] - strvect[lines]</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (!f.<span class=\"built_in\">eof</span>()) &#123;</span><br><span class=\"line\">      string inbuf;</span><br><span class=\"line\">      <span class=\"built_in\">getline</span>(f, inbuf, <span class=\"string\">&#x27;\\n&#x27;</span>);</span><br><span class=\"line\">      strVec.<span class=\"built_in\">push_back</span>(inbuf);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> QString::<span class=\"built_in\">fromStdString</span>(strVec[line - <span class=\"number\">1</span>]);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>读取整个文件并计算行数并不是一个效率高的方式，但在文件不大和不追求高效率的条件下，这是最好的实践方式。因为考虑这里还需要考虑到连续读取历史文件。</p>\n<p>当用户按下<code>UP</code>按键时，表示用户开始读取历史文件。用户首先查看的应该是历史文件的最后一行，当用户再次按下<code>UP</code>时，读取倒数第二行，依次类推。为了实现该功能，这里使用了一个全局变量<code>line</code>表示当前正在读取的行数，该行数被初始化为历史记录的总行数。然后再次读取将会<code>--line</code>后读取。当用户按下<code>DOWN</code>按键时，++line后读取。</p>\n<p>这里就要考虑到另一个问题，读取一定历史记录后，用户重新进行计算，然后再次查看历史记录，这样行数应当从新的历史记录最后一行开始计算。为此，这里引入了<code>isRead</code>变量，该变量初始化为<code>0</code>，表示现在未在读取。首次按下<code>UP</code>按键时，该变量置<code>1</code>，同时将<code>line</code>变量初始化为当前历史记录行数。当用户按下<code>UP</code>或<code>DOWN</code>按键时，正常修改<code>line</code>变量的值并进行读取即可。当用户按下<code>=</code>或手动保存时，需要将<code>isRead</code>置零。这样下一次按下<code>UP</code>时，将重新读取历史文件行数并为<code>line</code>赋值。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//mainwindow.cpp</span></span><br><span class=\"line\"><span class=\"comment\">//等号的槽函数在上面</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MainWindow::on_pushButton_Up_clicked</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  ui-&gt;textBrowser_input-&gt;<span class=\"built_in\">setFocus</span>();</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (Location::isRead) &#123;</span><br><span class=\"line\">    --Location::line;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    Location::line = <span class=\"built_in\">CountLines</span>(Location::filePath);</span><br><span class=\"line\">    Location::isRead = <span class=\"number\">1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  ui-&gt;textBrowser_output-&gt;<span class=\"built_in\">setText</span>(<span class=\"built_in\">ReadLine</span>(Location::filePath, Location::line));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MainWindow::on_pushButton_Down_clicked</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  ui-&gt;textBrowser_input-&gt;<span class=\"built_in\">setFocus</span>();</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (Location::isRead) &#123;</span><br><span class=\"line\">    ++Location::line;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  ui-&gt;textBrowser_output-&gt;<span class=\"built_in\">setText</span>(<span class=\"built_in\">ReadLine</span>(Location::filePath, Location::line));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>保存和读取的路径将在<code>顶层设计细节</code>中进一步讨论。</p>\n<h3 id=\"顶层设计细节\"><a href=\"#顶层设计细节\" class=\"headerlink\" title=\"顶层设计细节\"></a>顶层设计细节</h3><p>这里在menubar中设置了一个<code>history location</code>按键，用于修改历史文件的存放位置。当按下此按键时，程序应当打开一个新的窗口，因此，需要首先在源文件中创建一个新的窗口。右键点击<code>项目</code>，选择<code>add new</code>，选择<code>qt设计师类</code>，然后会分别在三个文件夹中依次得到头文件、源文件、ui设计文件。然后需要在主窗口中设置点击<code>history location</code>按键打开新窗口。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//mainwindow.cpp</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MainWindow::on_actionHistory_location_triggered</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  Location *new_win = <span class=\"keyword\">new</span> <span class=\"built_in\">Location</span>();</span><br><span class=\"line\">  new_win-&gt;<span class=\"built_in\">show</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>注意</strong>：记得在<code>mainwindow.h</code>中include<code>location.h</code>，按下打开新窗口实际上就是创建一个新的Location窗口，然后展示。</p>\n<p>接下来就是在<code>location.ui</code>中修改和设计可视化窗口，此项目使用了栅格布局，在左侧设置了一个较大的<code>textBrowser</code>和较小的<code>lineEdit</code>（设为不可修改，用于给出提示），在右侧依次设置了<code>选择文件</code>，<code>选择文件夹</code>，<code>确定</code>，<code>取消</code> 四个按键。</p>\n<blockquote>\n<p>选择文件：调用Qt库，打开系统默认的文件选择框，设置必须选择.txt格式结尾的文件，将返回的结果输出至<code>textBrowser</code>。</p>\n<p>选择文件夹：同上，但是选择的是文件夹，并且返回的是存在的文件夹的路径，将返回的结果加上<code>/result.txt</code>后输入至<code>textBrowser</code>。</p>\n<p>确定：按下后，读取<code>textBrowser</code>中的路径，检查其合法性（因为一开始<code>textBrowser</code>设置了可以直接更改，因此可能会输入奇怪的路径），若不合法则在<code>lineEdit</code>中给出相应的报错（格式不合法或路径不合法）。若合法，则检查文件是否存在，不存在则创建。当一切都合理以后，将全局变量<code>filePath</code>设为文本框中的内容，并关闭<code>Location</code>窗口。</p>\n<p>取消：直接关闭，不做任何修改。</p>\n</blockquote>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//location.cpp</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Location::on_pushButton_path_clicked</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  QString file_name =</span><br><span class=\"line\">      QFileDialog::<span class=\"built_in\">getOpenFileName</span>(<span class=\"literal\">NULL</span>, <span class=\"string\">&quot;选择txt文件&quot;</span>, <span class=\"string\">&quot;.&quot;</span>, <span class=\"string\">&quot;*.txt&quot;</span>);</span><br><span class=\"line\">  ui-&gt;textEdit-&gt;<span class=\"built_in\">setText</span>(file_name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Location::on_pushButton_dir_clicked</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  QString dir_name = QFileDialog::<span class=\"built_in\">getExistingDirectory</span>(<span class=\"literal\">NULL</span>, <span class=\"string\">&quot;选择文件夹&quot;</span>, <span class=\"string\">&quot;.&quot;</span>);</span><br><span class=\"line\">  ui-&gt;textEdit-&gt;<span class=\"built_in\">setText</span>(dir_name + <span class=\"string\">&quot;/result.txt&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Location::on_pushButton_cancel_clicked</span><span class=\"params\">()</span> </span>&#123; Location::<span class=\"built_in\">close</span>(); &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Location::on_pushButton_sure_clicked</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  QString new_path = ui-&gt;textEdit-&gt;<span class=\"built_in\">toPlainText</span>();</span><br><span class=\"line\">  <span class=\"function\">QFileInfo <span class=\"title\">info</span><span class=\"params\">(new_path)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!info.<span class=\"built_in\">exists</span>()) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (new_path.<span class=\"built_in\">contains</span>(<span class=\"string\">&quot;.txt&quot;</span>)) &#123;</span><br><span class=\"line\">      <span class=\"function\">QFile <span class=\"title\">f</span><span class=\"params\">(new_path)</span></span>;</span><br><span class=\"line\">      f.<span class=\"built_in\">open</span>(QIODevice::WriteOnly);</span><br><span class=\"line\">      f.<span class=\"built_in\">close</span>();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      ui-&gt;prompt-&gt;<span class=\"built_in\">setText</span>(<span class=\"string\">&quot;路径或格式不合法，请重新输入&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  Location::filePath=new_path;</span><br><span class=\"line\">  Location::<span class=\"built_in\">close</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>自动保存功能被设计为主窗口中菜单栏中的一个按键，默认为开启状态，显示为<code>Auto Save On</code>，当点击该按键后，槽函数将该文本替换为<code>Auto Save Off</code>，并将全局变量<code>autoSave</code>置零。</p>\n<p><code>filePath</code>和<code>autoSave</code>以及底层中的<code>isRead</code>和<code>line</code>都设计为一个全局变量，便于主窗口调用。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//location.h</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Location</span> :</span> <span class=\"keyword\">public</span> QDialog &#123;</span><br><span class=\"line\"> <span class=\"keyword\">public</span>:</span><br><span class=\"line\">  <span class=\"keyword\">static</span> QString filePath;</span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> line;</span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"keyword\">bool</span> isRead;</span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"keyword\">bool</span> autoSave;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//location.cpp</span></span><br><span class=\"line\">QString Location::filePath = <span class=\"string\">&quot;result.txt&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> Location::line = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">bool</span> Location::isRead = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">bool</span> Location::autoSave = <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n\n<p>在主窗口中，只有用户按下等号（并且自动保存功能开启）或手动保存（在<code>menubar</code>中设置了一个保存按键并且设置了快捷键）时，才会保存。因此只需在这些地方加入<code>save()</code>函数即可。当然，也要有对<code>autoSave</code>的判断。</p>\n<h2 id=\"样式设定\"><a href=\"#样式设定\" class=\"headerlink\" title=\"样式设定\"></a>样式设定</h2><p>前面提到了可以在<code>ui</code>文件中直接修改样式，但这种方式并不利于后面的修改，因此我们选择直接调用函数的方式。如要为<code>centralWidget</code>设定样式，可以调用<code>setStyelSheet()</code>，后接一个QString，该字符串中直接书写qss内容。</p>\n<p>这里选择了另一种方式，使用qt的资源文件管理功能来存储单独的qss文件，然后以前缀引用的方式来调用这些文件。</p>\n<p>在<code>项目</code>中右键新建<code>qt resource file</code>，设定名称后打开管理界面，点击添加前缀<code>add prefix</code>。然后添加文件<code>add Files</code>。前缀决定了调用的方式（将会在源代码中演示）。文件可以新建一个<code>general file</code>后添加，也可以将其他方式创建的qss文件加入。</p>\n<p>引入的资源可以以<code>QFile</code>的方式引用。本项目在菜单栏中添加了一个黑色主题的选项，其槽函数如下</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MainWindow::on_actionBlack_theme_triggered</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  globalQss = <span class=\"string\">&quot;:/Black.qss&quot;</span>;</span><br><span class=\"line\">  <span class=\"function\">QFile <span class=\"title\">defaultQss</span><span class=\"params\">(globalQss)</span></span>;</span><br><span class=\"line\">  defaultQss.<span class=\"built_in\">open</span>(QFile::ReadOnly);</span><br><span class=\"line\">  QString qssContent = defaultQss.<span class=\"built_in\">readAll</span>();</span><br><span class=\"line\">  <span class=\"built_in\">centralWidget</span>()-&gt;<span class=\"built_in\">setStyleSheet</span>(qssContent);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>/</code>为我设定的前缀，只需以冒号开头，加上前缀和文件，即表明在应用qt指定好的资源文件。接下来就只需打开该文件并读取其内容，然后为需要的组件设定qss样式即可。</p>\n<p><strong>注意</strong>：使用qss的一些麻烦：后面我希望能设定字体的大小、样式等，但这时通过<code>setFont()</code>等函数并不起作用。原因估计是qss的优先级很高，直接设定将不起作用。这时我只能再写一个<code>changeStyle()</code>函数，通过qss样式表更新来进行样式更新</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MainWindow::changeStyle</span><span class=\"params\">(QString newStyle, QWidget *widget)</span> </span>&#123;</span><br><span class=\"line\">  QString oldStyle = widget-&gt;<span class=\"built_in\">styleSheet</span>();</span><br><span class=\"line\">  oldStyle += newStyle;</span><br><span class=\"line\">  widget-&gt;<span class=\"built_in\">setStyleSheet</span>(oldStyle);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>所以这里我只写了改变字体的函数。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">MainWindow::on_actionLarge_font_size_triggered</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">changeStyle</span>(<span class=\"string\">&quot;*&#123;font:30px;&#125;&quot;</span>, MainWindow::<span class=\"built_in\">centralWidget</span>());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"保存设置\"><a href=\"#保存设置\" class=\"headerlink\" title=\"保存设置\"></a>保存设置</h2><p>类似于文件的保存位置，是否自动保存等功能，每次重新启动程序后都会按照程序的设定重新初始化。为了使得这些设定能被保存下来，需要使用一个文件将这些配置保存下来。恰好最近见到了许多<code>ini</code>格式文件，qt也提供了<code>QSetting</code>及配套的<code>ini</code>配置文件读写。</p>\n<p>配置文件应当在主窗口创建时被读取，在主窗口被销毁时被存入。因此只需在<code>mainwindow</code>的构造函数和析构函数中加入读写<code>ini</code>文件的步骤即可。需要注意的是，要考虑<code>ini</code>文件不存在的情况，不存在时需要使用程序的内置设定。</p>\n <figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MainWindow::<span class=\"built_in\">MainWindow</span>(QWidget *parent)</span><br><span class=\"line\">    : <span class=\"built_in\">QMainWindow</span>(parent), <span class=\"built_in\">ui</span>(<span class=\"keyword\">new</span> Ui::MainWindow) &#123;</span><br><span class=\"line\">  ui-&gt;<span class=\"built_in\">setupUi</span>(<span class=\"keyword\">this</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>-&gt;<span class=\"built_in\">grabKeyboard</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">  QSettings *iniRead = <span class=\"keyword\">new</span> <span class=\"built_in\">QSettings</span>(<span class=\"string\">&quot;config.ini&quot;</span>, QSettings::IniFormat);</span><br><span class=\"line\">  QString iniAuto = iniRead-&gt;<span class=\"built_in\">value</span>(<span class=\"string\">&quot;autoSave&quot;</span>).<span class=\"built_in\">toString</span>();</span><br><span class=\"line\">  QString iniPath = iniRead-&gt;<span class=\"built_in\">value</span>(<span class=\"string\">&quot;filePath&quot;</span>).<span class=\"built_in\">toString</span>();</span><br><span class=\"line\">  QString iniQss = iniRead-&gt;<span class=\"built_in\">value</span>(<span class=\"string\">&quot;globalQss&quot;</span>).<span class=\"built_in\">toString</span>();</span><br><span class=\"line\">  <span class=\"keyword\">delete</span> iniRead;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// init autoSave</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!iniAuto.<span class=\"built_in\">isEmpty</span>() &amp;&amp; !iniAuto.<span class=\"built_in\">toInt</span>()) &#123;</span><br><span class=\"line\">    Location::autoSave = <span class=\"number\">0</span>;</span><br><span class=\"line\">    ui-&gt;actionAuto_Save-&gt;<span class=\"built_in\">setText</span>(<span class=\"string\">&quot;Auto Save Off&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// init filePath</span></span><br><span class=\"line\">  <span class=\"function\">QFile <span class=\"title\">iniPathFile</span><span class=\"params\">(iniPath)</span></span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (iniPathFile.<span class=\"built_in\">open</span>(QFile::WriteOnly)) &#123;</span><br><span class=\"line\">    Location::filePath = iniPath;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// init Qss file(theme)</span></span><br><span class=\"line\">  <span class=\"function\">QFile <span class=\"title\">iniQssFile</span><span class=\"params\">(iniQss)</span></span>;</span><br><span class=\"line\">  QString qssContent;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (iniQssFile.<span class=\"built_in\">open</span>(QFile::ReadOnly)) &#123;</span><br><span class=\"line\">    qssContent = iniQssFile.<span class=\"built_in\">readAll</span>();</span><br><span class=\"line\">    globalQss = iniQss;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    QFile <span class=\"built_in\">defaultQss</span>(<span class=\"string\">&quot;:/Black.qss&quot;</span>);</span><br><span class=\"line\">    defaultQss.<span class=\"built_in\">open</span>(QFile::ReadOnly);</span><br><span class=\"line\">    qssContent = defaultQss.<span class=\"built_in\">readAll</span>();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"built_in\">centralWidget</span>()-&gt;<span class=\"built_in\">setStyleSheet</span>(qssContent);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">MainWindow::~<span class=\"built_in\">MainWindow</span>() &#123;</span><br><span class=\"line\">  QSettings *IniWrite = <span class=\"keyword\">new</span> <span class=\"built_in\">QSettings</span>(<span class=\"string\">&quot;config.ini&quot;</span>, QSettings::IniFormat);</span><br><span class=\"line\">  IniWrite-&gt;<span class=\"built_in\">setValue</span>(<span class=\"string\">&quot;autoSave&quot;</span>, Location::autoSave);</span><br><span class=\"line\">  IniWrite-&gt;<span class=\"built_in\">setValue</span>(<span class=\"string\">&quot;filePath&quot;</span>, Location::filePath);</span><br><span class=\"line\">  IniWrite-&gt;<span class=\"built_in\">setValue</span>(<span class=\"string\">&quot;globalQss&quot;</span>, globalQss);</span><br><span class=\"line\">  <span class=\"keyword\">delete</span> IniWrite;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">delete</span> ui;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h2><ul>\n<li>在主函数中为整个窗口设置了透明度，让它看起来酷炫一点点。</li>\n<li>在主函数中为窗口设定名称。</li>\n<li>在<code>.pro</code>文件中加入图标文件，使得生成的程序有图标</li>\n</ul>\n<h1 id=\"感想\"><a href=\"#感想\" class=\"headerlink\" title=\"感想\"></a>感想</h1><h2 id=\"收获\"><a href=\"#收获\" class=\"headerlink\" title=\"收获\"></a>收获</h2><ul>\n<li>不再害怕qt框架了，反而觉得它好用。</li>\n<li>qt的窗口类很舒服，有清晰且层次分明的关系，有足够好用的成员函数。</li>\n<li>qt的基本库也有不少可以讨论的，如QString的设计，不仅提供了基本的可变长度和操作符重载，还考虑到了和std库之间的转换。</li>\n<li>qt的信号与槽机制是qt最精髓的东西之一，信号是一种非常不错的线程间通信方式，很遗憾我没有手动使用connect函数来创建信号与槽。但确实在写qt的过程中，qtcreator已经为我提供了足够的可视化信号与槽构建工具。</li>\n<li>qss基本等于css</li>\n<li>qt以易于制作ui界面出名，但用了之后发现，qt实际上是借鉴了很多现代浏览器（前端）的实现方式。我写的时候感觉自己像是在写js+css。对于一个web项目来说，前端工程师书写html，css，以及利用框架来写js。后端工程师则使用各种工具来构建web服务。但对于qt这样一种前后结合的一体化程序设计框架来说，前后的分离并不彻底（虽然对硬件工程师来说可能会很友好）。</li>\n<li>我还是支持“qt是一个平台而不只是一个ui框架”这种说法。qt在基本库中的内容一点也不比它在ui界面中的少。无论是基本库还是ui库，都有很多可以研究的东西。</li>\n<li>宏的自动扩展确实好用</li>\n<li>qt毕竟还是封装的比较高层了，要是需要一些简单的功能，还是老老实实写原生的c和std吧。</li>\n</ul>\n<h2 id=\"遗憾\"><a href=\"#遗憾\" class=\"headerlink\" title=\"遗憾\"></a>遗憾</h2><ul>\n<li>大佬说他使用了前缀表达式，求余和翻方功能不好实现，我懂的算法也不多，这两个功能没能实现。只能说算法能力有待提高了。</li>\n</ul>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"ckv9h3bhl0005e0ul6ox31j9y","category_id":"ckv9h3bhm0007e0ul1maa6qdr","_id":"ckv9h3bhn0008e0ul6304chk1"},{"post_id":"ckvp97s0y0000a4ul9ha3c995","category_id":"ckvp97s130001a4ulg84g3g0u","_id":"ckvp97s170004a4ule6rm1p69"},{"post_id":"ckvthffej0000bkul3r911bwx","category_id":"ckvthffer0001bkulfdvge9xx","_id":"ckvthffev0004bkulbp2xbptg"},{"post_id":"ckvxyic780001e0ul55zv0y4y","category_id":"ckvyl7w510000ooula7ke7209","_id":"ckvyl7w550002ooulheb8cxfw"},{"post_id":"ckw25zgeq000120ula1of9cfe","category_id":"ckvxyic7a0002e0ulf852d98u","_id":"ckw25zgev000320ul7opk97xo"},{"post_id":"ckw95hxhp00005gul4yis9mv2","category_id":"ckvxyic7a0002e0ulf852d98u","_id":"ckw95hxhu00015gul1m1dfchr"},{"post_id":"ckwj2h1mc0000xgulb1v1e0xe","category_id":"ckvxyic7a0002e0ulf852d98u","_id":"ckwj2h1mi0002xgul24ky9kco"}],"PostTag":[{"post_id":"ckv9h3bh40000e0ula1dfa3j2","tag_id":"ckv9h3bhf0002e0uldnucf393","_id":"ckv9h3bhm0006e0ulgz9fakho"},{"post_id":"ckvp97s0y0000a4ul9ha3c995","tag_id":"ckvp97s150002a4ul0zja98oj","_id":"ckvp97s160003a4ul2xuvhakb"},{"post_id":"ckvthffej0000bkul3r911bwx","tag_id":"ckvthffeu0002bkul4ujf39rr","_id":"ckvthffev0003bkul9236gv23"},{"post_id":"ckvxyic780001e0ul55zv0y4y","tag_id":"ckvthffeu0002bkul4ujf39rr","_id":"ckvyl7w550001ooul40i59t23"},{"post_id":"ckw25zgeq000120ula1of9cfe","tag_id":"ckw25zges000220ul9rg2bweh","_id":"ckw25zgew000420ul6d3c49xx"},{"post_id":"ckwj2h1mc0000xgulb1v1e0xe","tag_id":"ckwj1nvdl0001d0ulc8ay9a6w","_id":"ckwj2h1mi0001xgulc8kxgovg"}],"Tag":[{"name":"Daily","_id":"ckv9h3bhf0002e0uldnucf393"},{"name":"C","_id":"ckvp97s150002a4ul0zja98oj"},{"name":"git","_id":"ckvthffeu0002bkul4ujf39rr"},{"name":"cloud","_id":"ckvxyic7e0003e0ulgecebgrq"},{"name":"auto","_id":"ckw25zges000220ul9rg2bweh"},{"name":"cpp","_id":"ckwj1nvdl0001d0ulc8ay9a6w"}]}}